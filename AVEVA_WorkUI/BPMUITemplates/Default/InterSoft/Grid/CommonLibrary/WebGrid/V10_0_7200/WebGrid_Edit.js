function wgActiveCell(b,c,a){this.element=a;this.tblName=c;this.gridId=b;if(a){this.cellIndex=a.cellIndex}this.rowElement=null;this.rowChanged=false;this.ToCellObject=function(){var d=wgGetGridById(this.gridId);var f=d.Tables[this.tblName];var e=f.ToRowObject(this.rowElement);if(e!=null){return e.GetCell(WG50Engine.GetColumnNameByCell(f,this.element))}};this.GetColSetRowElement=function(){var d=wgGetGridById(this.gridId);var e=d.Tables[this.tblName];if(e.IsUseColumnSet){return wgGetColumnSetRow(this.element)}return null};this.GetColSetRowsElement=function(){var d=wgGetGridById(this.gridId);var e=d.Tables[this.tblName];if(e.IsUseColumnSet){return wgGetColumnSetRows(this.element)}return null};return this}function wgSetLastAEC(d){var c=WG50Engine.GetTable(d);var b=ISGetObject(c.gridId);var e=b.Tables[c.tblName];if(e.LastAECIndex!=-1){if(d.cells.length>e.LastAECIndex){var a=d.cells[e.LastAECIndex];if(a.type=="Cell"||a.type=="FilterColumn"){WGEditEngine.HighlightEditCell(a)}else{WGEditEngine.ProcessInitialEdit(d)}}}else{WGEditEngine.ProcessInitialEdit(d)}}function wgGetFirstEditableCell(g){if(wgIsColumnSetRow(g)){return wgGetCSFirstEditableCell(g)}var d=WG50Engine.GetTable(g);var c=ISGetObject(d.gridId);var h=c.Tables[d.tblName];var a=h.GetElement(WG40.COLHEADER,WG40.HTMLTABLE,g).cells;var f=-1;for(var e=0;e<a.length;e++){WG50Engine.EmulateAttributes(a[e]);if(a[e].type=="Column"){var b=h.Columns.GetNamedItem(a[e].colName);if(WG50Engine.IsCellEditable(b,g.cells[e],e)){f=e;break}}}return f}function wgGetNextEditableRow(a,c){var b=wgGetNextVisibleRow(a,c);if(b){while(!(b&&b.element&&!b.element.noEdit)){if(b==null){return null}b=wgGetNextVisibleRow(a,b.element)}}return b}function wgGetPrevEditableRow(a,c){var b=wgGetPrevVisibleRow(a,c);if(b){while(!(b&&b.element&&!b.element.noEdit)){b=wgGetPrevVisibleRow(a,b.element)}}return b}function wgGetNextEditableCell(b,a){var n=b.parentElement;if(!n){n=a}var o=false;if(wgIsColumnSetRow(n)){var f=wgGetCSNextEditableCell(b,n);if(f&&f.rowElement){if(f.rowElement.type!="GroupHeader"&&f.rowElement.type!="GroupTotalRow"){return f}else{o=true}}}var h=WG50Engine.GetTable(n);var g=ISGetObject(h.gridId);var p=g.Tables[h.tblName];var d=p.GetElement(WG40.COLHEADER,WG40.HTMLTABLE,n).cells;var m=-1;var k=new wgActiveCell(h.gridId,h.tblName);var c=b.cellIndex;if(IS.ie&&p.IsRootTable&&g.FreezePaneActive&&(wgIsFilterRow(n)||wgIsNewRow(n))){c=WG50Engine.GetRealCellIndex(b)}if(!o){for(var j=c+1;j<d.length;j++){WG50Engine.EmulateAttributes(d[j]);if(d[j].type=="Column"){var e=p.GetColumn(d[j].colName);if(WG50Engine.IsCellEditable(e,n.cells[j],j)){m=j;break}}}}if(m==-1){var l=wgGetNextEditableRow(h,n);if(l&&l.element&&p.Get("AllowEdit")=="Yes"){k.rowChanged=true;k.rowElement=l.element;if(l.element.type=="Record"||l.element.type=="NewRow"){m=wgGetFirstEditableCell(l.element);if(typeof(m)=="object"){k.element=m}else{if(m==-1){m=p.LastAECIndex}if(m>=l.element.cells.length){m=l.element.cells.length-1}k.element=l.element.cells[m]}k.cellIndex=k.element.cellIndex}else{m=0;k.element=null;k.cellIndex=null}}}else{k.rowElement=n;k.element=n.cells[m];k.cellIndex=k.element.cellIndex}if(m==-1){k.element=b;k.rowElement=n;k.cellIndex=k.element.cellIndex}return k}function wgGetPrevEditableCell(b,a){var n=b.parentElement;if(!n){n=a}if(wgIsColumnSetRow(n)){var f=wgGetCSPrevEditableCell(b,n);if(f&&f.rowElement){if(f.rowElement.type!="GroupHeader"){return f}}}var h=WG50Engine.GetTable(n);var g=ISGetObject(h.gridId);var o=g.Tables[h.tblName];var d=o.GetElement(WG40.COLHEADER,WG40.HTMLTABLE,n).cells;var l=-1;var k=new wgActiveCell(h.gridId,h.tblName);var c=b.cellIndex;if(IS.ie&&o.IsRootTable&&g.FreezePaneActive&&(wgIsFilterRow(n)||wgIsNewRow(n))){c=WG50Engine.GetRealCellIndex(b)}for(var j=c-1;j>=0;j--){WG50Engine.EmulateAttributes(d[j]);if(d[j].type=="Column"){var e=o.Columns.GetNamedItem(d[j].colName);if(WG50Engine.IsCellEditable(e,n.cells[j],j)){l=j;break}}}if(l==-1){var m=wgGetPrevEditableRow(h,n);if(m&&m.element&&o.Get("AllowEdit")=="Yes"){k.rowChanged=true;k.rowElement=m.element;if(m.element.type=="Record"||m.element.type=="NewRow"){if(m.element.type=="NewRow"){k.element=wgGetFirstEditableCell(m.element)}else{k.element=wgGetLastEditableCell(m.element)}if(k.element){l=k.element.cellIndex}else{l=o.LastAECIndex;k.element=m.element.cells[l]}k.cellIndex=l}else{l=0;k.element=null;k.cellIndex=null}}}else{k.rowElement=n;k.element=n.cells[l];k.cellIndex=k.element.cellIndex}if(l==-1){k.element=b;k.rowElement=n;k.cellIndex=k.element.cellIndex}return k}function wgGetLastEditableCell(g){if(wgIsColumnSetRow(g)){return wgGetCSLastEditableCell(g)}var d=WG50Engine.GetTable(g);var c=ISGetObject(d.gridId);var h=c.Tables[d.tblName];var a=h.GetElement(WG40.COLHEADER,WG40.HTMLTABLE,g).cells;var f=-1;for(var e=a.length-1;e>=0;e--){WG50Engine.EmulateAttributes(a[e]);if(a[e].type=="Column"){var b=h.Columns.GetNamedItem(a[e].colName);if(b.EditType!="NoEdit"&&(e<g.cells.length&&g.cells[e].noEdit!="True")){f=e;break}}}if(f!=-1){return g.cells[f]}else{return null}}function wgActiveCellValid(a,b){if(a.ActiveEditCell){if(wgIsSameRow(a.ActiveEditCell.element.parentElement,b)){return true}}return false}function wgIsRowEditable(b){if(!b){return false}if(wgIsColumnSetRow(b)){var a=wgGetColumnSetRow(b);if(a.rowState=="Deleted"){return false}return a.noEdit!="True"}else{if(b.rowState=="Deleted"){return false}return b.noEdit!="True"}}function wgGetUnMask(h,c,f,i,k){var d=c.DataType;var j;var a=false;if(k){j=k}else{a=true;j=f.innerText}if(!d){return j}if(f&&wgIsFilterRow(f.parentElement)){return j}var g=c.DataFormatString;var b=new ISClientData(null,d,g);h.ValEngine.CheckType(b);var l=b.Type;var e=c.EditType;if(l=="number"&&e=="TextBox"){if(a&&f.cellValue){j=f.cellValue}b.NewValue=j.toString();return h.ValEngine.UnMask(b,h.CultureInfo)}else{if(e=="Checkbox"){return f.childNodes[0].checked}else{if(f.cellValue&&!i){return f.cellValue}else{return j}}}}function wgGetMask(i,g,l,b,a,j){var c;var k;if(g){c=g.cellElement;k=i.Tables[g.tblName]}else{c=a;k=b}if(wgIsFilterRow(c.parentElement)){return l}var e=k.GetColumn(wgGetColNameByCell(c));if(!e){return}var f=e.DataType;if(!f){return l}var h=e.DataFormatString;var d=new ISClientData(null,f,h);i.ValEngine.CheckType(d);var m=d.Type;if((m=="number"||m=="datetime")&&typeof(l)!="undefined"){d.NewValue=l;if(m=="datetime"&&h==""){d.Format="G"}if(m=="number"&&h==""){d.Format="g"}i.ValEngine.Validate(d,i.CultureInfo);if(d.IsValid){if(!j){return d.FormattedValue}else{return[true,d.FormattedValue]}}else{if(typeof(c.oldCellValue)!="undefined"){d.NewValue=c.oldCellValue;if(d.NewValue==" "){d.NewValue=""}if(!j){return i.ValEngine.Mask(d,i.CultureInfo)}else{return[false,i.ValEngine.Mask(d,i.CultureInfo),c.oldCellValue]}}else{return""}}}else{return l}}function wgEditObj(c,d,b,e,a){this.element=b;this.type=e;this.gridId=c;this.tblName=d;this.cellElement=a;this.ToCellObject=function(){return wgGetCellByElement(this.cellElement)};return this}function wgDispObjGeneric(g,d,f,a,b,h,e,c){WGEditEngine.DisplayObjectGeneric(g,d,f,a,b,h,e,c)}function wgIsRowMarkedEdit(b){if(b.parentElement==null){return false}var a=wgGetRootRow(b);return a.markedEdit}function wgIsRowDirty(d){var e=new Array();if(wgIsColumnSetRow(d)){e=wgGetColumnSetRows(d)}else{e[0]=d}for(var a=0;a<e.length;a++){var c=e[a];for(var b=0;b<c.cells.length;b++){if(c.cells[b].cellModified){return true}}}return false}function wgAddNewRow(a){WG50Engine.ExecuteFlyPostback(a.Grid.Id,"AddRow",a)}function wgUpdateRow(a){WG50Engine.ExecuteFlyPostback(a.Grid.Id,"UpdateRow",a)}function wgDeleteRow(a){WG50Engine.ExecuteFlyPostback(a.Grid.Id,"DeleteRow",a)}function wgHighlightEditCell(a,b,c){WGEditEngine.HighlightEditCell(a,b,c)}function wgActivateEditMode(a){a.ActivateEditMode()}var WGEditEngine={ProcessInitialEdit:function(b){if(wgIsColumnSetRow(b)){WGCSEngine.ProcessInitialEdit(b);return}var a=wgGetFirstEditableCell(b);if(a!=-1){WGEditEngine.HighlightEditCell(b.cells[a])}},ClearEditCell:function(a){var d=a.parentElement;if(!d){return}var c=WG50Engine.GetTable(d);var b=ISGetObject(c.gridId);if(!b.ActiveEditCell){return}WGEditEngine.HighlightEditCell(b.ActiveEditCell.element,"Clear",a);b.ExitEdit();b.ActiveEditCell=null},HighlightEditCell:function(cell,mode,newcell){var row=cell.parentElement;if(!row){return}var hTbl=WG50Engine.GetTable(row);if(!hTbl){return}var grid=ISGetObject(hTbl.gridId);var table=grid.Tables[hTbl.tblName];var highlightType=grid.LayoutSettings.RowHighlightType;if(grid.ActiveEditCell&&grid.ActiveEditCell.element==cell&&mode!="Clear"&&mode!="Redraw"){return}if(!table.IsUseColumnSet&&((cell.type!="Cell"&&cell.type!="FilterColumn")||(grid.Tables[hTbl.tblName].IsRootTable&&cell.style.display!="none"&&cell.cellIndex==row.cells.length-1))){return}if(mode!="Clear"){cell.selStyle=cell.runtimeStyle.cssText;if(mode!="Nodraw"){var _grid=grid;with(cell.runtimeStyle){var ls=borderLeft;var ts=borderTop;var rs=borderRight;var bs=borderBottom;cssText=_grid.GetEditFocusStyle();if(IS.moz){rs=cell.style.borderRight}if(IS.moz&&rs==""){rs="0px"}if(highlightType=="EntireRow"){borderLeft=ls;borderTop=ts;borderRight=rs;borderBottom=bs}}}if(mode!="Redraw"){var realCellIndex=cell.cellIndex;if(grid.ActiveEditCell&&grid.ActiveEditCell.element!=cell){WGEditEngine.HighlightEditCell(grid.ActiveEditCell.element,"Clear",cell)}if(grid.FreezePaneActive&&table.IsRootTable&&(wgIsFilterRow(row)||wgIsNewRow(row))){realCellIndex=WG50Engine.GetRealCellIndex(cell)}grid.ActiveEditCell=new wgActiveCell(hTbl.gridId,hTbl.tblName,cell);grid.ActiveEditCell.rowElement=row;grid.Tables[hTbl.tblName].LastAECIndex=realCellIndex;grid.ResetStatus();if(grid.LayoutSettings.VerboseEditingInformation&&!grid.IsInProgress){WGEditEngine.DisplayEditInfoText(grid.Tables[hTbl.tblName],cell)}}WGEventEngine.EnsureCellVisible(grid,cell)}else{if(cell&&wgIsSameRow(row,newcell.parentElement)){var isVisible=null;if(!IS.ie){if(cell.currentStyle.display=="none"||cell.style.display=="none"){isVisible==false}else{isVisible=true}}cell.runtimeStyle.cssText=cell.selStyle;if(!IS.ie){if(isVisible){cell.style.display=""}else{cell.style.display="none"}}}}},DisplayEditInfoText:function(h,b){var f=b.parentElement;var e=h.ToRowObject(f);var a=e.GetCell(wgGetColNameByCell(b));var c=a.Column;var d=c.Table.Grid;if(c.EditType=="NoEdit"){var g=d.GetString("CommonText/ReadOnlyCell");if(c.EditInfoText!=""){g+=" "+c.EditInfoText}d.SetStatus1(g);d.SetStatusIcon("ReadOnly")}else{d.SetIdle();if(f.rowState=="Deleted"){d.SetStatus1("","","CommonText/DeletedRowNoEdit");d.SetStatusIcon("ReadOnly")}else{if(c.EditInfoText!=""){d.SetStatus1(c.EditInfoText)}else{if(b.cellModified){d.SetStatus1("","","CommonText/ModifiedCell")}else{d.SetStatus1("","ready","CommonText/Ready")}}if(c.EditInfoImage!=""){d.SetStatusIcon(c.EditInfoImage,true)}if(b.cellModified){d.SetStatusIcon("Edit")}}}},InitializeNewRow:function(d,f){if(wgIsColumnSetRow(f)){WGCSEngine.InitNewRow(d,f);return}if(f.type=="NewRow"){var a=f.cells;var h=d.Tables[WG50Engine.GetTableNameByRow(f)];var c=null;if(!h.IsRootTable){var g=h.GetSubTableById(WG50Engine.GetTable(f).subId);c=ISXml.CreateXmlDocument();ISXml.LoadXml(c,g.RelNames)}if(f.rowValidated){f.rowValidated=false}for(var e=0;e<a.length;e++){if(a[e].type=="Cell"){var b=wgGetColNameByCell(a[e]);if(b){WGEditEngine.InitNewCell(d,h,b,a[e],c)}}}c=null}},SetNewRowInfoText:function(d){var c;if(d&&d.type!="NewRow"){return}var a=d.cells;for(var b=0;b<a.length;b++){if(a[b].type=="NewRowInfoCell"){c=a[b];break}}if(d.type=="NewRow"&&c){c.innerText=d.infoText}},InitNewCell:function(h,l,c,a,d){if(l){var b=l.Columns.GetNamedItem(c);var f=b.DefaultValue;var g=b.EditType;var e=b.DefaultText;var i=false;if(e==null){e=""}if(f==""){f=" "}if(e!=""||f!=" "){i=true}if(d){var m=d.selectSingleNode("//DataColumn[@name='"+(b.ParentKeyName?b.ParentKeyName:c)+"']");if(m){f=ISXml.DecodeString(m.text)}}if(h.LayoutSettings.AllowBatchUpdate){if(b.IsAutoIncrement){e="(Auto)"}else{if(!l.IsRootTable){var j=l.Parent.Columns.GetNamedItem(c);if(j!=null&&j.IsAutoIncrement){e="(Auto)"}}}}if(g=="Checkbox"){a.innerHTML="<input type=checkbox class='DefChkBox' "+(f.toLowerCase()=="true"?"checked":"")+">";if(f.toLowerCase()=="true"){a.cellValue=true}else{a.cellValue=false}}else{if(g=="DropdownList"||g=="WebComboNET"){if(f!=" "){if(e==""){e=f}a.cellValue=f;a.innerText=e}else{a.innerText=f;a.cellValue=f}}else{if(e!=""){a.innerText=e}else{a.innerText=f}if(IS.moz&&f==" "){a.innerHTML="&nbsp;"}a.cellValue=f;if(IS.IsXHTMLDocType()){a.style.whiteSpace="nowrap"}}}a.cellModified=false;if(!h.LayoutSettings.MarkDefaultValuesAsDirty){i=false}if(i){var k=a.parentElement;if(!wgIsRowMarkedEdit(k)){k.markedEdit=true;setTimeout(function(){WGEditEngine.MarkEdit(h)},50)}a.cellModified=true}}else{a.innerText=" "}},CheckBoxClicked:function(d,a){if(d.tagName=="INPUT"&&d.type=="checkbox"&&!d.editHandler){if(!a){return}var f=a.parentElement;if(!f||f.tagName!="TR"){return}var c=WG50Engine.GetTable(f);if(!c||(c&&!c.gridId)){return}var b=ISGetObject(c.gridId);var e=b.Tables[c.tblName];if((f.type=="NewRow"&&e.Get("AllowAddNew")=="Yes")||(wgIsRecordRow(f)&&e.Get("AllowEdit")=="Yes")){if(f.noEdit){return}if(!a.oldCellValue){a.oldCellValue=d.checked}WGEditEngine.InitCheckBoxEditHandler(b,d)}}},ActivateEditMode:function(f,h){var a=f.ActiveEditCell;var j=false;var l=null;var e=null;var d="";var c=null;var k=null;if(f.IsPreviewMode){alert("Not supported in Preview mode!");return}if(!f.Enabled){return}if(a&&a.element){e=a.element;l=f.Tables[a.tblName];c=l.Columns.GetNamedItem(wgGetColNameByCell(e));if(f.LastSelObj){k=f.LastSelObj.GetRowElement()}else{k=e.parentElement}if(!c){return}if(e.noEdit=="True"||!WG50Engine.IsCellEditable(c,e)||!wgIsRowEditable(k)){return false}d=c.EditType;if(wgIsFilterRow(k)){if(c.FilterEditType!="SameAsEditType"){d=c.FilterEditType}}else{if(wgIsNewRow(k)){if(c.NewRowEditType!="SameAsEditType"){d=c.NewRowEditType}}}if(f.LastEditObj){var j=f.ExitEditMode();if(!j){return false}}if(!wgIsRowDirty(k)){if(k.rowValidated){k.rowValidated=false}if(!ISEvent.Raise(f.LayoutSettings.ClientSideEvents.OnBeginRowEditing,f.Name,l.ToRowObject(k))){return}}var g=false;var i=false;switch(d){case"CalendarDropdown":g=true;i=true;case"CalendarCombo":g=true;case"TextBox":j=WGEditEngine.TextboxEditHandler(a,c,"",h,g,i);break;case"WebComboNET":j=WGEditEngine.WebComboEditHandler(a,c,"",h);break;case"Checkbox":j=WGEditEngine.CheckboxEditHandler(a,c,"",h);break;case"DropdownList":j=WGEditEngine.DropDownEditHandler(a,c,"",h);break;case"MultilineTextbox":j=WGEditEngine.TBMLEditHandler(a,c,"",h);break;case"ResizableTextbox":j=WG5EditEngine.RTBEditHandler(a,c,"",h);break;case"Custom":var b=f.CustomEditors[c.CustomEditorName];j=b.EnterEditMode(a,c,"",h);j=true;break}}if(j){f.IsInEditMode=true;if(e.parentElement.type=="NewRow"||wgIsFilterRow(e.parentElement)){l.IsAdding=true;e.oldText=e.innerText;if(e.cellValue){e.oldCellValue=e.cellValue}}else{l.IsEditing=true;if(!e.oldText){if(d=="MultilineTextbox"){e.oldText=e.innerHTML}else{e.oldText=e.innerText;if(c.ColumnType=="ImageAndText"&&e.oldText&&e.oldText.substring(0,1)==" "){e.oldText=e.oldText.substring(1)}}}if(!e.oldCellValue){var m=wgGetUnMask(f,c,e);if(typeof(m)!="undefined"){e.oldCellValue=m}}}f.LastEditObj=new wgEditObj(f.Name,l.Id,j,d,e);if(!ISEvent.Raise(f.LayoutSettings.ClientSideEvents.OnEnterEditMode,f.Name,l.Id,f.LastEditObj)){return}setTimeout(function(){WGEditEngine.EnsureEditFocus(f)},100)}return j},ExitEdit:function(g,j,e,f){var c=g.ActiveEditCell;var d=g.LastEditObj;var k=false;var i=true;var m;var l=true;if(!c){return true}if(j==-1){if(d&&d.cellElement){m=d.cellElement.parentElement}if(!m){m=c.rowElement}if(m){var n=m.type;var p=g.Tables[c.tblName];if(n=="NewRow"){WGEditEngine.InitializeNewRow(g,m)}else{if(!ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnCancelRowEditing,g.Name,p.ToRowObject(m))){return}WGEditEngine.CancelChanges(m)}WGEventEngine.SelectRow(m,g.GetCurSelImage())}}else{if(d&&d.cellElement){m=d.cellElement.parentElement;i=WGEditEngine.ExitEditMode(d)}if(i){if(!m){m=c.rowElement}i=(wgIsRowMarkedEdit(m)&&wgIsRowDirty(m));if(!i){k=true}}if(i){var h=g.LayoutSettings.NewRowLostFocusAction;var b=g.LayoutSettings.RowLostFocusAction;var n=m.type;var a=false;var p=g.Tables[c.tblName];if(!ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnEndRowEditing,g.Name,p.ToRowObject(m))){return}g.IsExitingEdit=true;if(n=="NewRow"){if(j!=0){if(h=="AlwaysPrompt"){l=a=confirm(g.GetString("MessageBoxText/AddNewRow"))}else{if(h=="AlwaysUpdate"){a=true}}}else{a=true}if(a){k=WGEditEngine.ValidateRow(g,m);if(k){WGEditEngine.DefaultAddRow(g,e,j=="0")}}else{k=true}}else{if(wgIsRecordRow(m)){if(j!=0){if(b=="AlwaysPrompt"){l=a=confirm(g.GetString("MessageBoxText/UpdateRow"))}else{if(b=="AlwaysUpdate"){a=true}}}else{a=true}if(a){k=WGEditEngine.ValidateRow(g,m);if(k){WGEditEngine.DefaultUpdateRow(g)}}else{WGEditEngine.CancelChanges(m);k=true}}else{if(wgIsFilterRow(m)){if(j==0){var o=c.element;var p=g.Tables[c.tblName];if(ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnColumnFilter,g.Id,p)){WGUIEngine.ProcessFilteredColumns(p);WGEventEngine.SelectRow(o.parentElement,g.GetCurSelImage());WGEditEngine.AcceptChanges(m);WG50Engine.ExecuteFlyPostback(g.Name,"ColumnFilter",p.Id)}}else{if(d){WGEditEngine.ExitEditMode(d,true)}WGEditEngine.CancelChanges(m);k=true}}}}g.IsExitingEdit=false}}return[k,l,a]},EnsureEditFocus:function(b){var a=b.LastEditObj;if(a){if(a.type=="TextBox"||(a.element!=null&&a.element.tagName=="INPUT")){if(IS.safari&&!IS.edge){a.element.select()}else{a.element.focus()}if(IS.chrome&&a.element.readOnly){a.element.focus()}}else{if(a.type=="WebComboNET"){if(IS.safari&&!IS.edge){a.element.TextObj.select()}else{a.element.TextObj.focus()}}}}},EnsureWebComboElementExist:function(c,a){var b=a.FrameObj;if(!b.parentElement){c.FrameObj.insertAdjacentElement("beforeEnd",a.FrameObj)}},DisplayObjectGeneric:function(grid,edit,el,adjLeft,adjTop,ignoreSize,editType,calDD){var fX=posLib2.getLeftAbs(grid.FrameObj);var fY=posLib2.getTopAbs(grid.FrameObj);var highlightType=grid.LayoutSettings.RowHighlightType;var _top;var _left;var _width;var _height;var _grid=grid;with(edit.style){if(ignoreSize){if(wgIsFilterRow(el.parentElement)){adjLeft-=20}}var brd=parseInt(_grid.FrameObj.currentStyle.borderWidth);if(_grid.FrameObj.style.position=="absolute"){brd=0}if(isNaN(brd)){brd=0}if(IS.opera||IS.w3c){brd=0}if(!_grid.FrameObj.contains(edit)){fX=0;fY=0}_left=ISPosLib.getLeft(el)+(adjLeft?adjLeft:0)-fX+_grid.EditCtlLeftAdj+brd;_top=ISPosLib.getTop(el)+(adjTop?adjTop:0)-fY+_grid.EditCtlTopAdj+brd;var parentEl=_grid.FrameObj.parentElement;var useSpecialBorder=false;if(highlightType=="BackgroundOnly"&&(edit.tagName=="INPUT"||edit.tagName=="TEXTAREA"||editType=="WebComboNET"||editType=="WebInputNET"||editType=="ResizableTextbox")){useSpecialBorder=true}if(_grid.PosRelativeTo!=null){parentEl=_grid.PosRelativeTo}if(useSpecialBorder){var _borderWidth=parseFloat(edit.currentStyle.borderLeftWidth);if(isNaN(_borderWidth)){_borderWidth=0}if(_borderWidth>0){_left=_left-_borderWidth;_top=_top-_borderWidth-1;if(IS.ie){_left-=1}else{if(IS.moz){_left-=2}}}}if(!_grid.LayoutSettings.UseRelativePositioning){if(parentEl&&(parentEl.tagName=="DIV"&&parentEl.currentStyle.hasLayout&&parentEl.currentStyle.position!="absolute")||(_grid.PosRelativeTo)){var pl=ISPosLib.getLeft(parentEl);var pt=ISPosLib.getTop(parentEl);_left=_left-pl;_top=_top-pt}}else{if(IS.ie){_left=_left-posLib2.getLeftAbs(_grid.FrameObj,_grid);_top=_top-posLib2.getTopAbs(_grid.FrameObj,_grid)}else{if(IS.safari){_top=_top-(el.offsetTop-el.parentElement.offsetTop)+ISPosLib.getScrollTop(document)}}}if(editType=="DropdownList"){var newTop=_top;top="0px";visibility="hidden";setTimeout(function(){edit.style.top=newTop+"px";edit.style.visibility="visible";if(edit.style.display!="none"){edit.focus()}},1)}var isRTL=_grid.IsRightToLeft();var adjHeight=0;position="absolute";if(edit.tagName!="TEXTAREA"){overflow="hidden"}if(!ignoreSize){if(edit.tagName!="SELECT"){adjHeight=2}_width=el.offsetWidth-(adjLeft?(adjLeft*2):0)-(calDD&&_grid.BuiltInDropDown?16:0);_height=el.offsetHeight-adjHeight;if(IS.ie&&IS.GetIEVersion()==7&&IS.IsXHTMLDocType()){_height-=2}if(wgIsFilterRow(el.parentElement)&&parseInt(_width)>36){var rightPadding=parseInt(el.currentStyle.paddingRight);if(!rightPadding){rightPadding=0}_width-=20+rightPadding;if(el.currentStyle.textAlign=="right"&&(IS.ie10||IS.moz||IS.safari||IS.chrome||IS.opera)){_width+=5;if(!IS.ie10){_height-=1}}if(isRTL){_left+=20}}if(useSpecialBorder){var _borderWidth=parseFloat(edit.currentStyle.borderLeftWidth);if(isNaN(_borderWidth)){_borderWidth=0}if(_borderWidth>0){if(IS.ie&&IS.GetIEVersion()==7&&IS.IsXHTMLDocType()){_width-=1}else{_width+=(_borderWidth*2)+1;_height+=(_borderWidth*2)+1}}}else{if(IS.moz&&adjTop==1){_height-=1}}}display="";if(typeof(_top)!="undefined"){top=_top+"px"}if(typeof(_left)!="undefined"){left=_left+"px"}if(typeof(_width)!="undefined"){width=_width+"px"}if(typeof(_height)!="undefined"){height=_height+"px"}edit.origLeft=posLeft;edit.origTop=posTop;if(zIndex==0){zIndex=199}}},DropDownEditHandler:function(a,b,h,g){var c=b.Name;var d=document.getElementById(a.gridId+"_"+a.tblName+"_"+c);var f=ISGetObject(a.gridId);var e=a.element;if(d){d.className="grid-editor-dropdown";if(!f.UseCssFramework){if(f.DefaultStyleMode=="Elegant"){d.style.fontFamily="Segoe UI, Tahoma";d.style.fontSize="9pt"}else{d.style.fontFamily="Verdana";d.style.fontSize="8pt"}}if(f.BindingOperationMode=="ClientBinding"&&f.IsClientBinding("ClientService")){var i=b.ValueList;if(i!=null&&i.IsValid()&&!i.DataRetrieved){d.desiredValue=e.cellValue;WG50Engine.ExecuteFlyPostback(f.Id,"ClientService_Select",b.ValueList,"ValueList")}}wgDispObjGeneric(f,d,e,0,0,null,"DropdownList");if(!d.KBHandlerInit){if(IS.moz){d.attachEvent("onkeyup",function(){WGEditEngine.EditControlKeyUp(f,d)})}d.attachEvent("onkeydown",function(){WGEditEngine.EditControlKeyboardHandler(f)});d.attachEvent("onchange",function(){WGEditEngine.DropDownChanged(f,d)});d.KBHandlerInit=true}d.value=e.cellValue;if(g){d.isDirty=true}else{d.isDirty=false}if(d.style.visibility=="visible"){d.focus()}}return d},EditControlKeyUp:function(b,a){WGEditEngine.DropDownChanged(b,a)},DropDownChanged:function(c,b){WGEditEngine.MarkEdit(c);b.isDirty=true;var a=b.parentElement;a.cellModified=true;a.cellValue=b.value},GetWebComboClientID:function(b,d){var a=ISGetObject(b);for(var c=0;c<a.WebCombos.length;c++){var e=a.WebCombos[c];if(e.Id.indexOf(d)>-1){return e.Id}}return""},WebCombo30EditHandler:function(ac,col,mode,isDirty){var wcID=WGEditEngine.GetWebComboClientID(ac.gridId,col.WebComboID);var wc=ISGetObject(wcID);if(wc){var wcFrame=wc.FrameObj;var el=ac.element;var isAdd=el.parentElement.type=="NewRow";var grid=ISGetObject(ac.gridId);var table=grid.Tables[ac.tblName];var _isDirty=isDirty;var _grid=grid;WG50Engine.EmulateAttributes(el);wgDispObjGeneric(grid,wcFrame,el,(WGEditEngine.IsElegantDefaultStyle(grid,wc)?1:0),1,null,"WebComboNET");wc.DoResize();wc.SetFocus();wc.Grid=grid;with(wc.TextObj){if(!_grid.UseCssFramework){style.paddingLeft="1px";style.paddingTop="1px"}value=(WG50Engine.IsWhitespace(el.innerText)?"":el.innerText);if((col.ColumnType=="Custom"||col.ColumnType=="Image")&&value==""){value=el.cellValue}if(col.ColumnType=="ImageAndText"&&value.substring(0,1)==" "){value=value.substring(1)}if(_isDirty){wc.TextObj.isDirty=true}else{wc.TextObj.isDirty=false}if(!wc.KBHandlerInit){attachEvent("onkeydown",function(){WGEditEngine.EditControlKeyboardHandler(_grid)});attachEvent("onselectstart",function(){event.cancelBubble=true});attachEvent("onpaste",function(){WGEditEngine.EditControlPasteHandler(_grid)});if(wc.LayoutSettings.ClientSideEvents.OnAfterItemSelected==""){wc.LayoutSettings.ClientSideEvents.OnAfterItemSelected="WGUI.WCIS('"+_grid.Name+"', '"+wc.Name+"')"}else{wc.LayoutSettings.ClientSideEvents.OnAfterItemSelected+=";WGUI.WCIS('"+_grid.Name+"', '"+wc.Name+"')"}if(wc.MajorVersion=="4.0"){wc.LayoutSettings.ClientSideEvents.OnItemChecked="WGUI.WCIC('"+_grid.Name+"', '"+wc.Name+"')"}wc.KBHandlerInit=true}}wc.LastSelectedIndex=wc.SelectedIndex=-1;wc.IsDirty=true;wc.NeedClearList=true;if(wc.LinkSettings.Enabled){if(wc.LinkSettings.ParentWebCombo==null){wc.LinkSettings.ResolveParentWebCombo()}var parentCombo=null;if(wc.LinkSettings.ParentWebCombo!=null){for(var i=0;i<wc.LinkSettings.ParentWebCombo.length;i++){if(wc.LinkSettings.ParentWebCombo[i].Id==wc.LinkSettings.ParentWebComboID){parentCombo=wc.LinkSettings.ParentWebCombo[i];break}}}if(parentCombo!=null){var parentColumn=null;for(var i=0;i<table.Columns.length;i++){var tempCol=table.Columns[i];if(tempCol.Visible&&tempCol.EditType=="WebComboNET"&&tempCol.WebComboID==wc.LinkSettings.ResolvedParentWebComboID){parentColumn=tempCol;break}}if(parentColumn==null){alert("The ParentWebCombo '"+wc.LinkSettings.ParentWebComboID+"' which this WebCombo is linked to does not bound to any Column in this Grid.")}else{var rowEl=ac.rowElement;parentCombo.Text=wgGetCellByName(rowEl,tempCol.Name).innerText;parentCombo.Value=wgGetCellByName(rowEl,tempCol.Name).cellValue;parentCombo.UpdateState();wc.RequireLinkRefresh=true}}}if(!wc.IsDataBound&&wc.UnboundDataInitialized){try{var tdata=wc.GetTData();if(tdata){for(var i=0;i<tdata.rows.length;i++){wc.UnhighlightRow(tdata.rows[i])}}}catch(e){}}if(wc.MultipleSelectionSettings.Enabled){wc.SetMultipleValues(el.innerText,(el.cellValue?el.cellValue:el.innerText));wc.RefreshValueItems()}if(el.cellValue){if(!wc.MultipleSelectionSettings.Enabled){wc.Value=el.cellValue;var targetValue=el.innerText;if(col.ColumnType=="ImageAndText"){if(targetValue.substring(0,1)==" "){targetValue=targetValue.substring(1)}if(typeof(wc.Value)=="string"&&wc.Value.substring(0,1)==" "){wc.Value=wc.Value.substring(1)}}wc.Text=targetValue}if(!wc.IsDataBound&&wc.AllowAdd){if(!wc.UnboundDataInitialized){wc.InitializeUnboundMode()}wc.SearchUnbound()}}else{if(el.innerText!=""&&el.innerText!=" "&&escape(el.innerText)!="%A0"){var targetValue=el.innerText;if(col.ColumnType=="ImageAndText"&&targetValue.substring(0,1)==" "){targetValue=targetValue.substring(1)}wc.Text=targetValue;wc.Value=targetValue;if(!wc.IsDataBound&&wc.AllowAdd){if(!wc.UnboundDataInitialized){wc.InitializeUnboundMode()}wc.SearchUnbound()}}else{wc.Value=null;wc.Text="";if(wc.MultipleSelectionSettings.Enabled){wc.SetMultipleValues("","");wc.RefreshValueItems()}}}col.GetGrid().PreparePostBackData();return wc}else{alert("Can't find WebCombo.NET instance with ID '"+wcID+"'");return false}},IsElegantDefaultStyle:function(b,a){return(a.UseDefaultStyle&&b.IsElegantDefaultStyle())},ApplyWebCombo40ElegantStyle:function(c,a){if(WGEditEngine.IsElegantDefaultStyle(c,a)){var b=a.FrameObj.style;var d=a.TextObj.style;a.LayoutSettings.EnableAnimation=false;c.ApplyDefaultStyleBorder(b);b.paddingLeft="1px";b.paddingTop="0px";b.backgroundColor="white";d.fontSize="9pt";if(a.SearchObj){a.SearchObj.style.borderLeftWidth="0px"}}},WebComboEditHandler:function(ac,col,mode,isDirty){var wcID=col.WebComboID;var wc=wcGetComboById(wcID);if(wc){if(wc.MajorVersion&&parseInt(wc.MajorVersion.substring(0,1))>=3){return WGEditEngine.WebCombo30EditHandler(ac,col,mode,isDirty)}wcFrame=wc.FrameObj;var el=ac.element;var isAdd=el.parentElement.type=="NewRow";var grid=ISGetObject(ac.gridId);var _grid=grid;wgDispObjGeneric(grid,wcFrame,el,0,1,null,"WebComboNET");wcres(wcID);with(wc.TextObj){if(!_grid.UseCssFramework){style.paddingLeft="1px";style.paddingTop="1px"}value=(el.innerText==" "?"":el.innerText);if(isDirty){isDirty=true}else{isDirty=false}if(!wc.KBHandlerInit){attachEvent("onkeydown",function(){WGEditEngine.EditControlKeyboardHandler(_grid)});attachEvent("onselectstart",function(){event.cancelBubble=true});attachEvent("onpaste",function(){WGEditEngine.EditControlPasteHandler(_grid)});if(ISXml.GetNodeText(wc.XmlObj,"//events/onafteritemselected")==""){sxt(wc,"//events/onafteritemselected","WGUI.WCIS('"+_grid.Name+"', '"+wc.Name+"')")}else{sxt(wc,"//events/onafteritemselected",ISXml.GetNodeText(wc.XmlObj,"//events/onafteritemselected")+";WGUI.WCIS('"+_grid.Name+"', '"+wc.Name+"')")}wc.KBHandlerInit=true}}wc.LastSelectedIndex=wc.SelectedIndex=-1;wc.IsDirty=true;wc.NeedClearList=true;if(!wc.IsDataBound&&wc.UnboundDataInitialized){try{var tdata=wc.GetTData();if(tdata){for(var i=0;i<tdata.rows.length;i++){wcrcsel(wcID,tdata.rows[i])}}}catch(e){}}if(el.cellValue){wc.Value=el.cellValue;var targetValue=el.innerText;if(col.ColumnType=="ImageAndText"&&targetValue.substring(0,1)==" "){targetValue=targetValue.substring(1)}wc.Text=targetValue;if(!wc.IsDataBound&&wc.AllowAdd){if(!wc.UnboundDataInitialized){if(typeof(wcInitUnbound)=="function"){wcInitUnbound(wcID)}}wcuseek(wcID)}}else{if(el.innerText!=""&&el.innerText!=" "){wc.Value=el.innerText;var targetValue=el.innerText;if(col.ColumnType=="ImageAndText"&&targetValue.substring(0,1)==" "){targetValue=targetValue.substring(1)}wc.Text=targetValue;if(!wc.IsDataBound&&wc.AllowAdd){if(!wc.UnboundDataInitialized){if(typeof(wcInitUnbound)=="function"){wcInitUnbound(wcID)}}wcuseek(wcID)}}else{wc.Value=null;wc.Text=""}}col.GetGrid().PreparePostBackData();return wc}else{alert("Can't find WebCombo.NET instance with ID '"+wcID+"'");return false}},WebComboItemSelected:function(d,b){var c=ISGetObject(d);var a=wcGetComboById(b);WGEditEngine.MarkEdit(c);a.TextObj.isDirty=true},WebComboItemChecked:function(e,c){var d=ISGetObject(e);var b=wcGetComboById(c);WGEditEngine.MarkEdit(d);b.TextObj.isDirty=true;var a=b.GetSelectedRow().cells[0];if(!ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnComboItemCheck,e,c,a)){return}},TextboxEditHandler:function(a,c,i,g,f,h){var d=a.element;var e=ISGetObject(a.gridId);if(!e.TBObj){var j=document.getElementById(a.gridId+"_TB");j.name=j.id;j.autocomplete="off";j.attachEvent("onfocus",WGEditEngine.OnTextBoxFocus);j.onselectstart=function(){event.cancelBubble=true;return true};j.onkeydown=function(){WGEditEngine.EditControlKeyboardHandler(e)};if(IS.opera){j.attachEvent("onkeypress",function(){if(event.keyCode==13){event.cancelBubble=true;event.returnValue=false}})}j.attachEvent("onpaste",function(){WGEditEngine.EditControlPasteHandler(e)});j.attachEvent("oncut",function(){WGEditEngine.EditControlPasteHandler(e)});e.TBObj=j}var l=e.TBObj;var b=null;l.readOnly=(h);l.className=e.LayoutSettings.TextBoxClass;if(f){if(!e.CalDDObj){var m=document.getElementById(e.Name+"_CalDD");if(e.CalDDImg){m.src=e.ResolveImagePathEx(e.CalDDImg)}else{if(wg_Global.CalDDImg!="CalendarDD.gif"){m.src=e.ResolveImagePathEx(wg_Global.CalDDImg)}}e.CalDDObj=m}e.CalDDObj.DtObj=l;e.CalDDObj.DtFormat=c.DataFormatString;b=e.CalDDObj}wgDispObjGeneric(e,l,d,1,1,null,null,b);if(f){wgDispObjGeneric(e,b,d,d.offsetWidth-(e.BuiltInDropDown?16:0)+(e.IsElegantDefaultStyle()?1:0),2,true);b.style.cursor="hand"}if(c.TextboxMaxlength){l.maxLength=c.TextboxMaxlength}else{l.maxLength=2147483647}var k=(WG50Engine.IsWhitespace(d.innerText)?"":wgGetUnMask(e,c,d,true));if(c.ColumnType=="ImageAndText"&&WG50Engine.IsWhitespace(k.substring(0,1))){k=k.substring(1)}l.value=k;l.style.textAlign=d.currentStyle.textAlign;if(g){l.isDirty=true}else{l.isDirty=false}if(IS.ie){l.focus()}return l},GetCalendarSource:function(a){if(a.UseCssFramework){return"ISCalendar_CSS.htm"}return wg_Global.CalFile},PreloadCalendar:function(c){var a=wg_Global.CalFrObj;if(!a){var b=c.ResolveScriptPath(c.LayoutSettings.ScriptDirectory,WGEditEngine.GetCalendarSource(c));a=document.createElement("IFRAME");a.src=b;a.id="ISDefCal";a.style.cssText="position:absolute;top:-100px;left:-100px;height:10px;width:10px";document.body.appendChild(a);a=document.getElementById("ISDefCal");wg_Global.CalFrObj=a}},ToggleCalendarDropDown:function(n,m){var a=wg_Global.CalFrObj;var b=wg_Global.CalPopObj;var l=ISGetObject(m);if(!a&&!b&&!IsGecko30()){var c=l.ResolveScriptPath(l.LayoutSettings.ScriptDirectory,WGEditEngine.GetCalendarSource(l));if(IS.ie&&!IS.ie9){a=document.createElement("<IFRAME id='ISDefCal' src='"+c+"'></IFRAME>")}else{a=document.createElement("IFRAME");a.src=c;a.id="ISDefCal"}a.style.cssText="position:absolute;top:-100px;left:-100px;height:10px;width:10px";document.body.appendChild(a);a=document.getElementById("ISDefCal");wg_Global.CalFrObj=a;setTimeout("WGUI.TGCALDD(null, '"+m+"')",100);return}if(!b){var o="";if(IS.ie&&!IS.ie11){try{o=a.contentWindow.document.body.parentElement.outerHTML}catch(j){setTimeout("WGEditEngine.ToggleCalendarDropDown(null, '"+m+"')",100);return}}else{try{o=a.contentWindow.document.firstChild.innerHTML;if(o==""||o==null||typeof(o)=="undefined"){setTimeout("WGEditEngine.ToggleCalendarDropDown(null, '"+m+"')",100);return}o="<html>"+o+"</html>";o=o.replace(new RegExp("parent.","g"),"")}catch(j){setTimeout("WGEditEngine.ToggleCalendarDropDown(null, '"+m+"')",100);return}}if(l.UseCssFramework){b=new WindowPopup()}else{b=window.createPopup()}var g=b.document;var k=IS.GetIFrameDocument(a);g.estWidth=k.body.scrollWidth;g.estHeight=k.body.scrollHeight+k.body.offsetHeight;g.open("text/html","replace");g.write(o);g.close();document.getElementById("ISDefCal").removeNode(true);a=wg_Global.CalFrObj=null;wg_Global.CalPopObj=b;setTimeout("WGUI.TGCALDD(null, '"+m+"')",100);return}else{if(IsGecko30()||IS.ie11){var p=b.document.getElementById("cbYear");if(!p){wg_Global.CalPopObj=null;setTimeout("WGEditEngine.ToggleCalendarDropDown(null, '"+m+"')",100);return}}}var g=b.document;var l=ISGetObject(m);var i=l.CalDDObj.DtObj;if(!isCAL.isCalLoaded){loadDatePicker(g,l)}setObject(i,l);isCAL.curFormat=l.CalDDObj.DtFormat;var h=new Date();if(i.value!=""){var f=new ISClientData(null,"datetime",isCAL.curFormat);f.NewValue=i.value;l.ValEngine.Validate(f,l.CultureInfo);if(f.IsValid){h=new Date(f.DateData.Year,f.DateData.Month,f.DateData.Day)}}setDate(h);if(l.UseCssFramework){b.show(ISPosLib.getLeftW3C(i),ISPosLib.getTopW3C(i)+i.offsetHeight,null,null,null,true,true)}else{if(!IS.ie11){b.show(ISPosLib.getScreenLeft(i),ISPosLib.getScreenTop(i)+i.offsetHeight,180,147+isCAL.adjHeight,null,true)}else{b.show(ISPosLib.getScreenLeft(i),ISPosLib.getTopW3C(i)+i.offsetHeight,180,147+isCAL.adjHeight,null,true)}}},TBMLEditHandler:function(a,b,f,e){var c=a.element;var d=ISGetObject(a.gridId);if(!d.TBMLObj){var g=document.getElementById(a.gridId+"_TBML");g.name=g.id;g.attachEvent("onfocus",WGEditEngine.OnTextBoxFocus);g.onselectstart=function(){event.cancelBubble=true;return true};g.onkeydown=function(){WGEditEngine.EditControlKeyboardHandler(d)};g.attachEvent("onpaste",function(){WGEditEngine.EditControlPasteHandler(d)});if(IsGecko30()){g.style.overflowX="hidden"}d.TBMLObj=g}var h=d.TBMLObj;h.className=d.LayoutSettings.TextBoxClass;wgDispObjGeneric(d,h,c,1,1);if(b.TextboxMaxlength){h.maxLength=b.TextboxMaxlength}if(IsGecko30()){if(ISPosLib.getHeight(h)<40){h.style.height="40px"}}h.value=(c.innerText==" "?"":c.innerText);if(IS.moz){h.style.overflowY="scroll"}if(e){h.isDirty=true}else{h.isDirty=false}h.focus();return h},CheckboxEditHandler:function(a,c,g,f){var b=a.element;var d=WGEditEngine.GetCheckBoxCell(b);var e=ISGetObject(a.gridId);WGEditEngine.InitCheckBoxEditHandler(e,d);if(f){d.isDirty=true}else{d.isDirty=false}d.focus();return d},GetCheckBoxCell:function(a){var b=a.parentElement;if(wgIsFilterRow(b)){if(a.children[0].tagName=="SPAN"){return a.childNodes[0].childNodes[0]}else{return a.children[0].children[0].children[0]}}else{return a.childNodes[0]}},InitCheckBoxEditHandler:function(b,a){if(!a.editHandler){a.editHandler=true;a.onkeydown=function(){WGEditEngine.EditControlKeyboardHandler(b)};a.onclick=function(){WGEditEngine.CheckBoxChanged(b,a)}}},CheckBoxChanged:function(c,b){WGEditEngine.MarkEdit(c);b.isDirty=true;var a=WG50Engine.GetTD(b);var d=WG50Engine.GetTable(a.parentElement);a.cellModified=true;a.cellValue=b.checked;if(!ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnCheckBoxClick,c.Name,d.tblName,wgGetColNameByCell(a),b.checked)){return}},OnTextBoxFocus:function(){var b=event.srcElement;try{b.select()}catch(a){}},EncodeHtml:function(a,b,c){if(a.TreatMarkupAsLiteralText){b=b.replace(/[<]/g,"&lt;");b=b.replace(/[>]/g,"&gt;")}else{b=_FixAmpChar(b)}if(a.PreserveWhitespace){b=b.replace(/[ ]/g,"&nbsp;")}if(c){b=b.replace(/[\n]/g,"<br />")}return b},ExitEditMode:function(l,t){if(!l){return}var m=l.element;var d=l.cellElement;var B=l.type;var p=ISGetObject(l.gridId);var A="";var C="";var v=true;var j=true;var g=null;var h=false;if(!ISEvent.Raise(p.LayoutSettings.ClientSideEvents.OnExitEditMode,p.Name,l.tblName,p.LastEditObj)){return}var w=d.parentElement;var y=p.Tables[l.tblName];var g=y.GetColumn(wgGetColNameByCell(d));var x=false;if(B=="WebComboNET"){var D=ISGetObject(g.WebComboID);m.FrameObj.style.display="none";if(m.AllowAdd){if(m.Text==""||m.Text==null||m.Text==" "||m.SelectedIndex==-1){m.Text=m.TextObj.value}if(m.Value==""||m.Value==null||m.Value==" "||m.SelectedIndex==-1){m.Value=m.Text}}if(D.MultipleSelectionSettings.Enabled){A=D.GetMultipleValuesText();C=D.GetMultipleValuesValue()}else{A=(m.Text==null?"":m.Text);C=(m.Value==null?"":m.Value)}if(m.TextObj.isDirty||(d.innerText!=m.Text)){d.cellModified=true;h=true}D.IsTextObjFocused=false;D.LastEventType=""}else{if(B=="Checkbox"){j=false;if(!t){d.cellValue=WGEditEngine.GetCheckBoxCell(d).checked;if(wgIsFilterRow(w)){WGUIEngine.OnFilterBlur(d.childNodes[0])}}else{d.cellValue=d.oldCellValue;WGEditEngine.GetCheckBoxCell(d).checked=d.cellValue}}else{if(B=="Custom"){var c=p.CustomEditors[g.CustomEditorName];v=c.ImplementationObject.OnExitEditMode(t);A=c.ImplementationObject.GetText();C=c.ImplementationObject.GetValue();if(typeof(c.ImplementationObject.ShouldProcessExitEditModeDefaultBehavior)=="function"){j=c.ImplementationObject.ShouldProcessExitEditModeDefaultBehavior()}if(typeof(c.ImplementationObject.GetContentMode)=="function"){d.contentMode=c.ImplementationObject.GetContentMode()}}else{if(m.style.display!="none"){m.style.display="none"}if(B=="CalendarDropdown"||B=="CalendarCombo"){if(p.CalDDObj){p.CalDDObj.style.display="none"}}if(B=="TextBox"||B=="MultilineTextbox"||B=="CalendarCombo"||B=="CalendarDropdown"){if(m.isDirty){A=C=(m.value==null?"":m.value);if(A!=""){if(B=="MultilineTextbox"){x=true}else{var z=wgGetMask(p,l,A,null,null,true);if(z instanceof Array){if(z[0]){A=z[1]}else{A=z[1];C=z[2]}}else{A=z}}}d.cellModified=true}}else{if(B=="ResizableTextbox"){A=C=(m.children[0].value==null?"":m.children[0].value);if(A!=""){A=wgGetMask(p,l,A)}if(g.AllowMultiLine){x=true}if(m.children[0].isDirty){d.cellModified=true;h=true}}else{C=m.value;try{A=m.options[m.selectedIndex].text}catch(k){A=""}if(m.isDirty){d.cellModified=true}}}}}}var q=d.innerHTML.toUpperCase().indexOf("NOBR")>0;var f=WGEventEngine.GetContentSpan(d);var n=true;if(f){q=f.innerHTML.toUpperCase().indexOf("NOBR")>0}if((!m.isDirty&&!h)&&A==""){n=false}if(j&&(B=="Custom"||(d.cellModified&&n))){var s="";var y=p.Tables[l.tblName];var g=y.GetColumn(wgGetColNameByCell(d));if(!t){if(g.ColumnType=="ImageAndText"&&wgIsRecordRow(w)){try{s=d.childNodes[0].childNodes[0].outerHTML}catch(k){}}var u=(q?"<NOBR>":"")+s+(A==""?"&nbsp;":WGEditEngine.EncodeHtml(g,A,x))+(q?"</NOBR>":"");if(f){f.innerHTML=u}else{d.innerHTML=u}if(!IS.ie&&wgIsFilterRow(w)){WGMozEngine.ResizeFilterColumn(d,d.offsetWidth)}d.cellValue=C;var y=p.Tables[l.tblName];g=y.GetColumn(wgGetColNameByCell(d));if(C!=""&&B=="TextBox"){C=wgGetUnMask(p,g,d);d.cellValue=C}if(m.isDirty){d.cellModified=true}if(wgIsFilterRow(w)){WGUIEngine.OnFilterBlur(d.childNodes[0])}else{var o=y.Formulas;for(var r=0;r<o.length;r++){if(o[r].IsCellAccounted(d)){o[r].ProcessResult(d.parentElement,d)}}}}else{if(g.ColumnType=="ImageAndText"&&wgIsRecordRow(w)){try{s=d.childNodes[0].childNodes[0].outerHTML}catch(k){}}if(d.oldText){var u=(q?"<NOBR>":"")+s+(d.oldText==""||d.oldText==" "?"&nbsp;":d.oldText)+(q?"</NOBR>":"");if(!f){d.innerHTML=u}else{f.innerHTML=u}}if(d.cellValue){d.cellValue=d.oldCellValue}}if(p.IsClientBinding()||p.IsClientBinding("Client")||p.IsClientBinding("Server")){var b=y.ToRowObject(w);var a=b.GetCell(g.Name);a.Setup(a.GetElement())}}if(!IS.ie){setTimeout(function(){if(!p.LastEditObj){WGMozEngine.EnsureEditFocus(p,d)}},20)}if(!wgIsRowMarkedEdit(w)&&d.cellModified){d.cellModified=false}ISEvent.Raise(p.LayoutSettings.ClientSideEvents.OnAfterExitEditMode,p.Name,l.tblName,p.LastEditObj);p.LastEditObj=null;p.IsInEditMode=false;return v},GetBooleanValue:function(a){if(a=="true"||a=="True"){return true}else{if(a=="false"||a=="False"){return false}}return a},CancelCellChanges:function(a,k){var m=WG50Engine.GetTR(a);var o=WG50Engine.GetTable(k);var h=ISGetObject(o.gridId);var n=h.Tables[o.tblName];if(a.type=="Cell"||a.type=="FilterColumn"){if(a.cellModified){var c=n.GetColumn(wgGetColNameByCell(a));if(c.ColumnType!="Template"){if(c.EditType=="Checkbox"||c.FilterEditType=="Checkbox"){a.cellValue=a.oldCellValue;WGEditEngine.GetCheckBoxCell(a).checked=WGEditEngine.GetBooleanValue(a.cellValue)}else{var i=a.innerHTML.toUpperCase().indexOf("NOBR")>0;var b=WGEventEngine.GetContentSpan(a);var p=a.oldText;var j="";var d=true;if(wgIsFilterRow(m)){var g=n.FilteredColumns.GetNamedItem(c.Name);if(g!=null){if(WG50Engine.IsWhitespace(p)||p==typeof(undefined)||g._UIState=="Added"){n.FilteredColumns.Remove(g);p=""}else{g.FilterText=p}}}if(c.ColumnType=="Custom"){if((p==""||p==" ")&&a.innerHTML.toLowerCase().indexOf("<img")>-1){d=false}}if(d){if(b){i=b.innerHTML.toUpperCase().indexOf("NOBR")>0}if(c.ColumnType=="ImageAndText"&&wgIsRecordRow(k)){try{j=a.childNodes[0].childNodes[0].outerHTML}catch(f){}}var l=(i?"<NOBR>":"")+j+((p==""||p==" ")?"&nbsp;":p)+(i?"</NOBR>":"");if(b){b.innerHTML=l}else{a.innerHTML=l}if(typeof(a.cellValue)!="undefined"){a.cellValue=a.oldCellValue}if(wgIsFilterRow(m)&&!IS.ie){WGMozEngine.ResizeFilterColumn(a,a.offsetWidth)}}}}}a.cellModified=false}},CancelChanges:function(e){var j=WG50Engine.GetTable(e);var b=ISGetObject(j.gridId);var g=b.Tables[j.tblName];var f=new Array();if(wgIsColumnSetRow(e)){f=wgGetColumnSetRows(e)}else{f[0]=e}for(var c=0;c<f.length;c++){var a=f[c].cells;for(var d=0;d<a.length;d++){WGEditEngine.CancelCellChanges(a[d],e)}}if(b.LayoutSettings.VerboseEditingInformation){if(b.LayoutSettings.StatusBarVisible&&!b.IsStatusLocked){b.SetStatusIcon("Edit")}}if(b.LayoutSettings.AllowBatchUpdate){if(e.rowState){WGEventEngine.SetRowHeaderIndicator(e,e.rowState+"RowIndicator")}}if(e.rowValidated){e.rowValidated=false}b.ResetStatus()},AcceptChanges:function(g,f){var h=WG50Engine.GetTable(g);var c=ISGetObject(h.gridId);var b=g.cells;g.markedEdit=false;for(var d=0;d<b.length;d++){var a=b[d];if(a.type=="Cell"||a.type=="FilterColumn"){if(a.cellModified){a.cellModified=false}}}if(c.LayoutSettings.VerboseEditingInformation){if(c.LayoutSettings.StatusBarVisible&&!c.IsStatusLocked){var e=document.getElementById("tdStatIcon_"+c.Name).childNodes[0];if(e.src.indexOf(c.LayoutSettings.ImageSettings.EditImage)>-1){e.style.visibility="hidden"}}}var e=c.ResolveImagePathEx(c.LayoutSettings.ImageSettings.CurrentRowImage);WGEventEngine.SelectRow(g,e);c.ResetStatus()},DefaultAddRow:function(b,c,d){var a=b.ActiveEditCell;if(WGEditEngine.PrepareAddRowInfo(b)){if(!d){WGEditEngine.InitializeNewRow(b,a.rowElement);WGEventEngine.SelectRow(a.rowElement,b.GetCurSelImage())}if(c){WGEditEngine.ProcessInitialEdit(a.rowElement)}WGEditEngine.EnsureActiveEditCellFocus(b)}},DefaultUpdateRow:function(b){var a=b.ActiveEditCell;if(WGEditEngine.PrepareUpdateRowInfo(b)){}},EnsureActiveEditCellFocus:function(c,d){var a=c.ActiveEditCell;if(a){if(c.LastEditObj){return}if(document.activeElement==a.element||!c.HasFocus()){return}if(c.GetFrameElement().offsetHeight!=0){a.element.setActive()}if(!IS.ie){var f=WG50Engine.GetTable(a.element);f.focus()}if(!d){setTimeout(function(){WGEditEngine.EnsureActiveEditCellFocus(c,true)},200)}}else{var e=c.LastSelObj;if(e&&e.element){var b=wgGetCellByPosition(e.element,0);if(b&&c.HasFocus()){b.setActive()}}}},EditControlPasteHandler:function(a){WGEditEngine.MarkEdit(a);event.srcElement.isDirty=true},EditControlKeyboardHandler:function(g,e){var h=0;var m=false;var l=false;h=event.keyCode;if(!ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnEditKeyDown,g.Name,h)){return}h=event.keyCode;if(h==9){var c=g.ActiveEditCell;var b=c.element;var k=true;if(!event.shiftKey&&b==wgGetLastEditableCell(c.rowElement)){k=WGEditEngine.ExitEdit(g,0,true,h)[0];if(c.rowElement.type=="NewRow"||g.IsInProgress){k=false}}if(k){var i=null;if(IS.ie&&!IS.ie11){i=document.createEventObject();i.keyCode=h;i._srcElement=b;i.shiftKey=event.shiftKey;i.ctrlKey=event.ctrlKey;b.fireEvent("onkeydown",i)}else{i=new Object();i.srcElement=b;i.shiftKey=event.shiftKey;i.ctrlKey=event.ctrlKey;i.keyCode=h;WGEventEngine.ProcessKeyboardEvents(i)}if(!event.ctrlKey){setTimeout(function(){g.ActivateEditMode()},50)}if(IS.moz){setTimeout(function(){if(!g.LastEditObj){g.ActivateEditMode()}},50)}}m=true}else{if(h==27){var b=g.ActiveEditCell.element;WGEditEngine.ExitEditMode(g.LastEditObj,true);b.setActive();m=true}else{if(h==13){var c=g.ActiveEditCell;var b=c.element;var f=g.LastEditObj;if(!event.shiftKey){if(f.type!="MultilineTextbox"&&f.type!="ResizableTextbox"){var j=true;if(f.type=="WebComboNET"){var d=g.Tables[c.tblName].GetColumn(wgGetColNameByCell(b));var a=wcGetComboById(d.WebComboID);if(a.EntryMode=="InstantLookup"){j=false}}if(j){if(c.rowElement.type=="FilterRow"&&g.LayoutSettings.ApplyFiltersKey=="Enter"){WGEditEngine.ExitEdit(g,0,false)}else{WGEditEngine.ExitEditMode(f)}b.setActive();m=true}}else{m=false;l=true}}else{if(!f||f.type!="MultilineTextbox"){WGEditEngine.ExitEdit(g,0,false)}else{WGEditEngine.ExitEditMode(f);b.setActive()}m=true}}else{if(h==115){var c=g.ActiveEditCell;var b=c.element;var n=b.parentElement;if(wgIsFilterRow(n)){WGUIEngine.OnFilterKeyDown(b.childNodes[0]);event.keyCode=0;m=true}}}}}if(h>=46&&h<=57||h>=54&&h<=90||h>=96&&h<=111||h>=186&&h<=192||h>=219&&h<=222||h==113||h==8||h==229||h==32||l){WGEditEngine.MarkEdit(g);event.srcElement.isDirty=true}if(e){e=g.CustomEditors[e];e.ImplementationObject.OnKeyDown(event.keyCode)}if(m){event.cancelBubble=true;event.returnValue=false}},MarkEdit:function(f){var a=f.ActiveEditCell.rowElement;if(wgIsColumnSetRow(a)){a=wgGetColumnSetRow(a)}else{if(a.type=="PR"){a=wgGetPreviewRowParent(a)}}if(!a.markedEdit){var b=wgGetRowHeader(a);if(b){b.innerHTML="<img align=absmiddle src='"+f.ResolveImagePathEx(f.LayoutSettings.ImageSettings.EditImage)+"'>";b.setAttribute("state","edit")}a.markedEdit=true}if(f.LayoutSettings.VerboseEditingInformation&&!f.ActiveEditCell.editImageDisplayed){var e=wgGetColNameByCell(f.ActiveEditCell.element);var g=f.Tables[f.ActiveEditCell.tblName];var d=g.Columns.GetNamedItem(e);if(d.EditInfoImage==""){f.SetStatusIcon("Edit")}if(d.EditInfoText==""){f.SetStatus1("","","CommonText/EditedCell")}f.ActiveEditCell.editImageDisplayed=true}},ValidateRow:function(c,a){var g=wgGetRootRow(a);if(c.LayoutSettings.AllowBatchUpdate){var h=WG50Engine.GetRowByElement(g);if(!h.Table.IsRootTable){var e=h.GetParentRow();while(e!=null){if(e.GetRowState()=="Deleted"){alert(c.GetString("MessageBoxText/DeletedRowEditException"));WGEditEngine.CancelChanges(g);return false}e=e.GetParentRow()}}if(h.GetRowState()=="Added"&&wgIsRecordRow(g)&&h.Table.GetChildTables().length>0){var b=h.GetCells();for(var d=0;d<b.length;d++){if(b[d]!=null&&b[d].Modified&&b[d].Column.IsPrimaryKey()){alert(c.GetString("MessageBoxText/PrimaryKeyEditException"));return false}}}}if(g.rowValidated){return true}var f=true;wg_Global.LastValRowObj=g;f=ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnRowValidate,g);if(f){f=WGEditEngine.ValidateRequiredInput(c,a)}if(f){g.rowValidated=true}return f},ValidateRequiredInput:function(e,a){var j=wgGetRootRow(a);var l=WG50Engine.GetTable(j);var k=e.Tables[l.tblName];var h=k.ToRowObject(j);var c=h.GetCells();var f=false;for(var g=0;g<c.length;g++){var b=c[g];if(!b){continue}var d=b.Column;if(d.InputRequired){if(b.Text==""||b.Text=="\xA0"||(b.Text!=null&&escape(b.Text)!=""&&b.Text.length<3&&escape(b.Text).indexOf("%0A")>-1)){if(b.Column.ColumnType=="Custom"&&b.Value!=null&&b.Value.replace(" ","")!=""){continue}WGEditEngine.ShowRequiredIndicator(e,b);if(!f){f=true}}}}if(f){if(e.FreezePaneActive&&e.FreezeConfig!=null){WGUIEngine.SetFreezeScrollBarPosition(e,0,false,null,true)}e.SetStatus1("","","CommonText/InputRequiredStatus");e.SetStatusIcon("Warning");e.IsStatusLocked=true}return(!f)},ShowRequiredIndicator:function(e,a){var b=a.GetElement();var g=e.LayoutSettings.ImageSettings.RequiredImage;var d=b.getElementsByTagName("div");if(d.length>0){d[0].style.display=""}else{var c=document.createElement("DIV");c.setAttribute("ui-part","required");c.style.cssText="position:relative; width:100%";var f=document.createElement("IMG");f.src=e.ResolveImagePathEx(g);f.style.cssText="position:absolute; right:2px";f.title=(a.Column.InputRequiredErrorText!=""?a.Column.InputRequiredErrorText:e.GetString("Tooltip/InputRequired"));c.appendChild(f);b.insertAdjacentElement("afterBegin",c)}},PrepareAddRowInfo:function(j){var h=j.ActiveEditCell;var p=h.rowElement;var g=null;var o=wgGetRootRow(p);if(wgIsRowDirty(p)&&WGEditEngine.ValidateRow(j,p)){var s=j.Tables[h.tblName];var q=null;if(!s.IsRootTable){q=s.GetSubTableById(WG50Engine.GetTable(p).subId)}var m=s.NewRow(q);var d=m.Cells;for(var k=0;k<d.length;k++){var b=d[k];var f=b.Name;var c=wgGetCellByName(p,f);if(c){var e=c.contentMode;var r="";if(e=="HTML"){r=c.innerHTML;if(r!=""){var n=new RegExp("\r\n","g");r=r.replace(n,"")}}else{r=c.innerText}b.Text=r;if(c.cellValue){b.Value=c.cellValue}else{b.Value=b.Text}if((b.Value==""||b.Value==" ")&&e=="HTML"){b.Value=b.Text}if(b.Value==" "){b.Value=""}if(b.Text==" "){b.Text=""}b.Modified=(c.cellModified==true||r!=" ");b.DataChanged=true;b.OldValue=b.OldText="";b._UIState="Changed"}}if(j.LayoutSettings.AllowBatchUpdate){if(s.DataKeyFieldsCount==1){WGBatchEngine.AssignKeyValues(s,m,s.DataKeyFields)}else{var a=s.DataKeyFields.split(",");for(var k=0;k<a.length;k++){var l=a[k];WGBatchEngine.AssignKeyValues(s,m,l,true)}}m.Update();return false}else{m.RowElement=p;m.Update()}return true}return false},PrepareDeleteRowInfo:function(a,d){var g=WG50Engine.GetTable(d);var f=a.Tables[g.tblName];var b=a.LayoutSettings;d=wgGetRootRow(d);var c=WG50Engine.GetRowByElement(d);if(!b.AllowBatchUpdate){c.Delete()}else{var e=c.GetRowState();if(e=="Added"){c.UndoChanges()}else{c.Delete()}}},PrepareUpdateRowInfo:function(c){var b=c.ActiveEditCell;var f=b.rowElement;var a=null;var e=wgGetRootRow(f);if(wgIsRowDirty(f)&&WGEditEngine.ValidateRow(c,f)){var d=WG50Engine.GetRowByElement(f);d._UIState="Changed";d.Update();return true}return false},PrepareAddRow:function(a,e,b,c){e.setAttribute("action","AddRow");e.setAttribute("tblName",c.Table.Id);if(!ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnBeforeAdd,a.Name,c.Table.Id,a.TempLRO)){return}var f=a.XmlReq;if(e.selectSingleNode("//newRowData")){e.removeChild(e.selectSingleNode("//newRowData"))}ISXml.CreateCDATA(f,e,"newRowData",c.ToXml());if(c.SubTable){var d=c.SubTable.GetParentRow();d=wgGetPreviousRow(a.Tables[WG50Engine.GetTableNameByRow(d)].GetElement(WG40.BODY,WG40.HTMLTABLE,d),d);d=wgGetRootRow(d);WGHierEngine.PrepareXmlInfo(a,e,d);e.setAttribute("tblSubId",c.SubTable.SubId)}a.SetStatus1("","addrow","CommonText/AddRow");return true},PrepareUpdateRow:function(a,e,b,c){e.setAttribute("action","UpdateRow");e.setAttribute("tblName",c.Table.Name);e.setAttribute("position",c.Position);if(!ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnBeforeUpdate,a.Name,c.tblName,a.TempLRO)){return}var f=a.XmlReq;if(e.selectSingleNode("//RowData")){e.removeChild(e.selectSingleNode("//RowData"))}ISXml.CreateCDATA(f,e,"RowData",c.ToXml());if(c.SubTable){var d=c.SubTable.GetParentRow();d=wgGetPreviousRow(a.Tables[WG50Engine.GetTableNameByRow(d)].GetElement(WG40.BODY,WG40.HTMLTABLE,d),d);d=wgGetRootRow(d);WGHierEngine.CreateRelNames(a,e,d);e.setAttribute("tblSubId",c.SubTable.SubId)}e.setAttribute("parentPos",c.GetParentPos());a.SetStatus1("","updaterow","CommonText/UpdateRow");return true},PrepareDeleteRow:function(a,e,b,c){e.setAttribute("action","DeleteRow");e.setAttribute("tblName",c.Table.Name);e.setAttribute("position",c.Position);e.setAttribute("keyValue",(c.KeyValue?ISXml.EncodeString(c.KeyValue):""));if(!ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnBeforeDelete,a.Name,c.Table.Name,a.TempLRO)){return}if(c.SubTable){var d=c.SubTable.GetParentRow();d=wgGetPreviousRow(a.Tables[WG50Engine.GetTableNameByRow(d)].GetElement(WG40.BODY,WG40.HTMLTABLE,d),d);if(d.type=="CSRecord"){d=wgGetRootRow(d)}WGHierEngine.CreateRelNames(a,e,d);e.setAttribute("tblSubId",c.SubTable.SubId)}e.setAttribute("parentPos",c.GetParentPos());a.SetStatus1("","deleterow","CommonText/DeleteRow");return true},ResponseDeleteRow:function(d,q){var g=d.LastRequestObj;var m=d.Tables[g.Table.Name];var k=g.RowElement;var n=m.GetElement(WG40.BODY,WG40.HTMLTABLE,k);var o=parseFloat(d.TotalLoadedRows);var p=parseFloat(d.TotalRows);var i=d.LayoutSettings.PagingMode;var j=wgGetRootRow(k);var h=j.rowIndex;var f=false;if(!ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnAfterDelete,d.Name,g.tblName,d.LastRequestObj,d.XmlResp)){return}if(g.ParentPos==""){WGEditEngine.DeleteRowGeneric(d,m,n,k,e,o,p)}else{var b=m.GetElement(WG40.BODY,WG40.HTMLDIV,k);var a=ISXml.GetNodeText(q,"//htmlTB");b.outerHTML=a;if(m.IsRootTable){d.ClearChildTables();WG50Engine.RegisterRootTableBehaviour(d)}else{var l=m.GetSubTableById(n.subId);var e=l.GetParentRow();d.ClearChildTables(m.Id)}d.ActiveEditCell=null;d.LastSelObj=null}var c=ISXml.GetNodeText(q,"//footerString");if(c!=""){if(m.IsRootTable){WGUIEngine.UpdateColumnFooter(d,m,null,c)}else{var l=m.GetSubTableById(n.subId);WGUIEngine.UpdateColumnFooter(d,null,l,c)}}if(d.LayoutSettings.VerboseEditingInformation){d.SetStatus1("","","CommonText/DeleteSuccess");d.SetStatusIcon("Success");d.IsStatusLocked=true}else{d.SetStatus1("","ready","CommonText/Ready")}},ResponseUpdateRow:function(r,ah){var s="";try{s=ISXml.GetNodeText(ah,"//grouplevel")}catch(n){}var K=r.LastRequestObj;var Z=r.Tables[K.Table.Name];var U=K.RowElement;var ac=Z.GetElement(WG40.BODY,WG40.HTMLTABLE,U);var af=parseFloat(r.TotalLoadedRows);var ag=parseFloat(r.TotalRows);var O=r.LayoutSettings.PagingMode;var G=ISXml.GetNodeText(ah,"//needReposition");var D=ISXml.GetNodeText(ah,"//keyValue");var o=r.LastSelObj;var B=false;var x=ISXml.GetNodeText(ah,"//htmlTB");var A=false;var z=false;var X=null;if(!ISEvent.Raise(r.LayoutSettings.ClientSideEvents.OnAfterUpdate,r.Name,K.Table.Id,r.LastRequestObj,r.XmlResp)){return}if(G=="True"||(s!=""&&x!="")){if(s==""){var d=wgGetRootRow(U);var M=d.position;var N=d.rowIndex;var v=wgGetHierRecord(U);var Q=null;if(v&&v.type!="HierRecord"){v=null}if(Z.PreviewRowVisible){Q=wgGetPreviewRow(U)}if(wgIsColumnSetRow(U)){var f=wgGetColumnSetRows(U);for(var y=0;y<f.length;y++){f[y].removeNode(true)}}else{U.removeNode(true)}if(Q){Q.removeNode(true)}if(v){v.removeNode(true)}var P=parseFloat(ISXml.GetNodeText(ah,"//position"));if(!Z.IsRootTable||O=="ClassicPaging"||O=="None"||(O=="VirtualLoad"&&(af==ag||P<=af))){var l=ISXml.GetNodeText(ah,"//htmlRow");WGUIEngine.SetTempContent("<table>"+l+"</table>");var Y=WGUIEngine.GetTempContent();var I,w;var ad=ac.tBodies[ac.tBodies.length-1];if(!Z.IsRootTable){try{af=parseFloat(ac.rows[ac.rows.length-1].position)+1}catch(n){af=0}}else{WGUIEngine.FormatFreezeRows(r,Y.rows)}I=ad.appendChild(Y.rows[0]);if(r.BindingOperationMode=="ClientBinding"){z=true;X=I}var S=Y.rows.length;var k=0;for(var y=0;y<S;y++){var c=Y.rows[0];WG50Engine.EmulateAttributes(c);if(c.type!="HierRecord"){ad.appendChild(c);k++}}if(v&&U.childExpanded=="True"){if(U.relNames!=I.relNames){U.childExpanded="False";v=ad.appendChild(Y.rows[0])}}if(P<af){var ab=(P>M?P+1:P);w=v;if(w){ad.appendChild(w)}if(ab<af){var L=parseFloat(I.rowIndex);ac.moveRow(I.rowIndex,wgGetRowByPositionExact(ac,ab).rowIndex);if(k>0){for(var C=0;C<k;C++){ac.moveRow(L+C+1,I.rowIndex+C+1)}}if(w){ac.moveRow(w.rowIndex,I.rowIndex+k+1)}}if(P==af-1){WGEditEngine.FixTreeLines(r,Z,ac,I)}WGEditEngine.FixHierState(r,U,I);B=true}}else{if(Z.IsRootTable){af--;r.Set("TotalLoadedRows",af);if(r.IsClassicPaging()){WGPageEngine.InvalidatePagingArgs(r)}else{r.SetStatus2("","loaded",af,ag)}}}wgRefreshHierPosition(r,ac,ac.rows[0],0,w);var R=false;try{var ae=r.LastSelObj.getRowElement();var a=WG50Engine.GetTable(ae);if(a==null){R=true}}catch(n){R=true}if(R){r.ActiveEditCell=null;r.LastSelObj=null;WGEventEngine.ProcessMouseEvents(ac.rows[N].cells[Z.LastAECIndex],false,true)}}else{var m=Z.GetElement(WG40.BODY,WG40.HTMLDIV,K.RowElement);var l=ISXml.GetNodeText(ah,"//htmlTB");var N=U.rowIndex;m.outerHTML=l;if(Z.IsRootTable){r.ClearChildTables();WG50Engine.RegisterRootTableBehaviour(r)}else{var W=Z.GetSubTableById(ac.subId);var v=W.GetParentRow();r.ClearChildTables(Z.Id)}var g=s.split("_");var F;m=document.getElementById(m.id);ac=m.childNodes[0];for(var y=0;y<g.length;y++){var q=wgGetRowByGroup(ac,y,g[y],F);if(q){if(q.childrenLoaded=="True"){wgExpandGroupRow(q)}}F=q}if(r.BindingOperationMode=="ClientBinding"){A=true}r.ActiveEditCell=null;r.LastSelObj=null;var H=ac.rows[N];var aa=Z.LastAECIndex;if(H){if(aa>=H.cells.length){aa=H.cells.length-1}WGEventEngine.ProcessMouseEvents(ac.rows[N].cells[aa],false,true);B=true}}}else{B=true;var l=ISXml.GetNodeText(ah,"//htmlRow");if(l=="RowRemoved"){WGEditEngine.DeleteRowGeneric(r,Z,ac,U,v,af,ag)}else{WGUIEngine.SetTempContent("<table>"+l+"</table>");var Y=WGUIEngine.GetTempContent();var J=Y.rows[0];var T=wgGetRootRow(U);var E;if(Z.IsRootTable){WGUIEngine.FormatFreezeRows(r,Y.rows)}T.replaceNode(J);E=J;if(r.BindingOperationMode=="ClientBinding"){z=true;X=J}var b=J;var S=Y.rows.length;for(var u=0;u<S;u++){b=wgGetNextRow(ac,b);var c=Y.rows[0];WG50Engine.EmulateAttributes(c);if(b.type!="HierRecord"&&b.type!="GroupTotalRow"){if(b.type==c.type){b.replaceNode(c);b=null;b=c;var d=T;if(T.srLevel){d=wgGetRootRow(WGUIEngine.GetSelfRefParent(ac,c));if(d.srLevel==T.srLevel){d=T}}if((!c.srLevel&&c.style.display!="")||(typeof(T.srLevel)!="undefined"&&(T.srExpanded=="True"||T.style.display==""))){c.style.display=""}E=b}}}J.style.display="";if(o&&o.GetRowElement().rowIndex==-1){r.ActiveEditCell=null;r.LastSelObj=null;try{if(typeof(J.srLevel)!="undefined"&&r.LayoutSettings.EditOnClick){var V=ac.rows[oldLSO.rowIndex];r.LastEditObj.cellElement=V.cells[Z.LastAECIndex];WGEventEngine.ProcessMouseEvents(r.LastEditObj.cellElement,false,true)}else{WGEventEngine.ProcessMouseEvents(J.cells[Z.LastAECIndex],false,true)}}catch(n){}}if(T.childExpanded=="True"){WG50Engine.EmulateAttributes(J);if(T.relNames!=J.relNames){T.childExpanded="False";v=wgGetNextRow(ac,E);v.replaceNode(Y.rows[0])}}WGUIEngine.ClearTempContent();WGEditEngine.FixHierState(r,T,J);WGEditEngine.FixSelfRefState(r,Z,T,J);U=null}}var p=ISXml.GetNodeText(ah,"//footerString");if(p!=""){if(Z.IsRootTable){WGUIEngine.UpdateColumnFooter(r,Z,null,p);A=true}else{var W=Z.GetSubTableById(ac.subId);WGUIEngine.UpdateColumnFooter(r,null,W,p)}}if(J!=null){WGEditEngine.UpdateGroupTotalRows(ah,J)}if(r.LastEditObj){WGEditEngine.EnsureEditFocus(r)}else{if(B){WGEditEngine.EnsureActiveEditCellFocus(r)}}if(A){WG50Engine.OnViewChanged(Z,"UpdateRow")}else{if(z){WG50Engine.OnOperationCompleted(Z,"UpdateRow",X)}}if(r.LayoutSettings.VerboseEditingInformation){r.SetStatus1("","","CommonText/UpdateSuccess");r.SetStatusIcon("Success");r.IsStatusLocked=true}else{r.SetStatus1("","ready","CommonText/Ready")}},UpdateGroupTotalRows:function(f,e){var b=ISXml.GetNodeText(f,"//groupFooterCount");var c=null;var a=-1;if(b!=""){b=parseInt(b);for(var d=0;d<b;d++){if(c==null){c=WGEditEngine.GetNextGroupTotalRow(e);a=parseInt(c.groupIndex);c=WGEditEngine.ReplaceGroupTotalRows(f,c,d);continue}a--;c=WGUIEngine.GetTRByGroupIndex(c,a,"next","GroupTotalRow");c=WGEditEngine.ReplaceGroupTotalRows(f,c,d)}}},ReplaceGroupTotalRows:function(l,j,c){var d=ISXml.GetNodeText(l,"//groupFooterString_"+c);if(d!=""){WGUIEngine.SetTempContent("<table>"+d+"</table>");var k=WGUIEngine.GetTempContent();var f=k.rows[0];var i=j;i.replaceNode(f);f.style.display="";var a=f;var g=k.rows.length;for(var e=0;e<g;e++){a=wgGetNextRow(tb,a);var b=k.rows[0];WG50Engine.EmulateAttributes(b);a.replaceNode(b);b.style.display="";a=null;a=b}WGUIEngine.ClearTempContent();return f}},GetNextGroupTotalRow:function(c){var b=WG50Engine.GetTable(c);var a=wgGetNextRow(b,c);while(a!=null){if(a.type=="GroupTotalRow"){return a}a=wgGetNextRow(b,a)}return null},RefreshPosition:function(c){for(var a=0;a<c.rows.length;a++){var b=c.rows[a];WG50Engine.EmulateAttributes(b);if(b.type=="Record"){b.position=b.recordIndex=a}}},DeleteRowGeneric:function(a,i,k,g,b,m,n){var f=wgGetRootRow(g);var e=f.rowIndex;var c=false;var h=false;if(a.LastSelObj&&a.LastSelObj.GetRowElement()!=g){h=true}wgRemoveRow(i,g);if(k.rows.length>0){if(typeof(m)!="undefined"){wgRefreshHierPosition(a,k,k.rows[0],0,b)}else{WGEditEngine.RefreshPosition(k)}var d=k.rows[e];var j=i.LastAECIndex;if(!d){var l=wgGetLastVisibleRow(k);if(l){d=l.GetRowElement();if(d){if(d.type!="NewRow"&&b){WGEditEngine.MarkLastLines(a,i,k,d)}}}}}if(!h){a.ActiveEditCell=null;a.LastSelObj=null}if(d&&!h){if(j>=d.cells.length||j==-1){var l=WGUIEngine.GetLastCell(d);if(l){j=l.cellIndex}else{j=d.cells.length-1}}WGEventEngine.ProcessMouseEvents(d.cells[j],false,true);if(a.LastEditObj){WGEditEngine.ExitEditMode(a.LastEditObj,true)}c=true}if(c){WGEditEngine.EnsureActiveEditCellFocus(a)}if(typeof(m)!="undefined"){if(i.IsRootTable){n--;m--;a.Set("TotalLoadedRows",m);a.Set("TotalRows",n);if(a.IsClassicPaging()){WGPageEngine.InvalidatePagingArgs(a)}else{a.SetStatus2("","loaded",m,n)}}}g=null;b=null},ResponseAddRow:function(k,J){var l="";try{l=ISXml.GetNodeText(J,"//grouplevel")}catch(f){}var u=k.LastRequestObj;var D=k.Tables[u.Table.Id];var G=parseFloat(k.TotalLoadedRows);var H=parseFloat(k.TotalRows);var w=k.LayoutSettings.PagingMode;var E=null;var p=false;var o=false;var B=null;if(D.IsRootTable){E=D.GetElement(WG40.BODY,WG40.HTMLTABLE)}else{E=u.SubTable.GetElement(WG40.BODY,WG40.HTMLTABLE)}var y=k.LayoutSettings.ResetNewRowValuesOnError;try{if(u.RowElement){WGEditEngine.InitializeNewRow(k,u.RowElement);if(k.LastSelObj.GetRowElement().type=="NewRow"){WGEventEngine.SelectRow(u.RowElement,k.GetCurSelImage())}}}catch(f){}if(!ISEvent.Raise(k.LayoutSettings.ClientSideEvents.OnAfterAdd,k.Name,u.tblName,k.LastRequestObj,k.XmlResp)){return}if(l!=""){var d=null;if(D.IsRootTable){d=D.GetElement(WG40.BODY,WG40.HTMLDIV)}else{d=u.SubTable.GetElement(WG40.BODY,WG40.HTMLDIV)}var c=ISXml.GetNodeText(J,"//htmlTB");d.outerHTML=c;if(D.IsRootTable){WG50Engine.RegisterRootTableBehaviour(k)}if(D.IsRootTable){k.ClearChildTables()}else{k.ClearChildTables(D.Id)}var b=l.split("_");var r;for(var n=0;n<b.length;n++){var h=wgGetRowByGroup(E,n,b[n],r);if(h){if(h.childrenLoaded=="True"){wgExpandGroupRow(h)}}r=h}if(k.BindingOperationMode=="ClientBinding"){p=true}if(w=="None"){G++}else{G=k.LayoutSettings.VirtualPageSize}}else{var x=-1;var c="";try{x=parseFloat(ISXml.GetNodeText(J,"//position"));c=ISXml.GetNodeText(J,"//htmlRow")}catch(f){}var z=false;if(c==""){k.SetStatus1("","ready","CommonText/Ready");return}if(!D.IsRootTable||w=="None"||w=="ClassicPaging"||(w=="VirtualLoad"&&(G==H||x<=G))){WGUIEngine.SetTempContent("<table>"+c+"</table>");var C=WGUIEngine.GetTempContent();var s,m;var F=null;if(E.tBodies.length>0){F=E.tBodies[E.tBodies.length-1]}else{F=document.createElement("TBODY");E.appendChild(F)}if(!D.IsRootTable){try{G=parseFloat(E.rows[E.rows.length-1].position)+1}catch(f){G=0}}else{WGUIEngine.FormatFreezeRows(k,C.rows)}s=F.appendChild(C.rows[0]);var I=C.rows.length;for(var q=0;q<I;q++){if(C.rows[0].type=="HierRecord"){m=C.rows[0];I--}F.appendChild(C.rows[0])}if(k.BindingOperationMode=="ClientBinding"){o=true;B=s}var v=s.rowIndex;if(x<G){E.moveRow(s.rowIndex,wgGetRowByPositionExact(E,x).rowIndex);for(var n=0;n<I;n++){E.moveRow(v+n+1,s.rowIndex+n+1)}if(m){E.moveRow(m.rowIndex,s.rowIndex+(I)+1)}wgRefreshHierPosition(k,E,wgGetNextRow(E,(m?m:s)),x+1,m);z=true}var a=wgGetCellByPosition(s,0);if(k.HasFocus()){a.setActive()}WGEventEngine.EnsureCellVisible(k,a);WGUIEngine.ClearTempContent();if(D.IsRootTable){G+=1}if(!z){WGEditEngine.FixTreeLines(k,D,E,s)}}}if(D.IsRootTable){H+=1;if(G>H){G=H}k.Set("TotalLoadedRows",G);k.Set("TotalRows",H);if(k.IsClassicPaging()){WGPageEngine.InvalidatePagingArgs(k)}else{k.SetStatus2("","loaded",G,H)}}if(s!=null){WGEditEngine.UpdateGroupTotalRows(J,s)}var g=ISXml.GetNodeText(J,"//footerString");if(g!=""){if(D.IsRootTable){WGUIEngine.UpdateColumnFooter(k,D,null,g);p=true}else{var A=D.GetSubTableById(E.subId);WGUIEngine.UpdateColumnFooter(k,null,A,g)}}if(p){WG50Engine.OnViewChanged(D,"AddRow")}else{if(o){WG50Engine.OnOperationCompleted(D,"AddRow",B)}}if(k.LayoutSettings.VerboseEditingInformation){k.SetStatus1("","","CommonText/AddSuccess");k.SetStatusIcon("Success");k.IsStatusLocked=true}else{k.SetStatus1("","ready","CommonText/Ready")}},MarkLastLines:function(b,f,g,e){if(wgIsRecordRow(e)){var a=WGHierEngine.GetCellExpander(e);var c=wgGetHierRecord(e);if(c&&c.type!="HierRecord"){c=null}if(a){WGHierEngine.SetLastTree(b,a.childNodes[0],c)}if(c){var d=WGHierEngine.GetIStructCell(c);d.innerHTML=""}}},FixTreeLines:function(b,f,g,e){var d=wgGetPreviousRow(g,e);if(d&&d.type=="HierRecord"){var c=WGHierEngine.GetIStructCell(d);WGHierEngine.RenderIStructure(b,c);d=wgGetPreviousRow(g,d);d=wgGetRootRow(d);if(d&&d.type=="Record"){var a=WGHierEngine.GetCellExpander(d);WGHierEngine.SetNormalLTree(b,a.childNodes[0])}}else{if(d&&wgIsRecordRow(d)&&!f.IsRootTable){d=wgGetRootRow(d);var a=WGHierEngine.GetCellExpander(d);WGHierEngine.SetNormalLTree(b,a.childNodes[0],true)}}},FixHierState:function(b,d,c){if(d.childExpanded&&d.childExpanded=="True"){var a=WGHierEngine.GetCellExpander(c);if(a){WGHierEngine.ChangeImage(b,a,"False");c.childExpanded="True"}}if(d.tblName){c.tblName=d.tblName}},FixSelfRefState:function(b,e,d,c){if(d.srLevel&&d.srExpanded=="True"){var a=WGUIEngine.GetSelfRefImage(e,c);if(a){a.src=b.ResolveImagePathEx(b.LayoutSettings.ImageSettings.CollapseImage);c.srExpanded="True"}}},ToggleCEDropDown:function(e,d,b){var c=wgGetGridById(d);var a=c.CustomEditors[b];a.ImplementationObject.OnDropdown()},CopyMultipleRows:function(a){if(a!=null){WGMenuEngine.CopySelection(a)}}};var ceProto=null;if(typeof(WebGridCustomEditor)=="undefined"){ceProto=new Object()}else{ceProto=WebGridCustomEditor.prototype}ceProto.GetBaseEditorElement=function(){if(this.baseEditor==null){if(this.BaseEditorType=="Textbox"){this.baseEditor=document.getElementById(this.Grid.Name+"_TB"+this.Name)}else{this.baseEditor=this.ImplementationObject.GetBaseEditorElement()}}return this.baseEditor};ceProto.GetEditCell=function(){return this.Grid.GetActiveEditCell()};ceProto.GetEditCellElement=function(){return this.GetEditCell().element};ceProto.GetEditRowElement=function(){return this.GetEditCell().rowElement};ceProto.GetTable=function(){var a=this.Grid.GetActiveEditCell();var b=this.Grid.Tables[a.tblName];return b};ceProto.GetColumnXml=function(){var a=this.GetTable();return a.GetColumn(wgGetColNameByCell(this.GetEditCellElement()))};ceProto.GetColumnEditorProperties=function(){var a=this.GetColumnXml();return a.CustomEditorProperties};ceProto.GetEditorClientID=function(){var a=this.GetColumnXml();return a.CustomEditorServerId};ceProto.GetDropdownObject=function(){};ceProto.RowDirty=function(){WGEditEngine.MarkEdit(this.Grid)};ceProto.CellDirty=function(){this.GetEditCellElement().cellModified=true};ceProto.IsRowDirty=function(){return wgIsRowDirty(this.GetEditRowElement())};ceProto.GetDropdownButtonElement=function(){if(this.DDObj==null){if(this.DropdownButtonType=="Image"){this.DDObj=document.getElementById(this.Grid.Name+"_DD"+this.Name)}else{this.DDObj=this.ImplementationObject.GetDropdownButtonElement()}}return this.DDObj};ceProto.InitializeBaseEditor=function(a){var b=this.GetBaseEditorElement();var d=this.Grid;if(b!=null&&this.BaseEditorType=="Textbox"){if(!b.initialized){var c=this.Name;b.attachEvent("onfocus",WGEditEngine.OnTextBoxFocus);b.onselectstart=function(){event.cancelBubble=true;return true};b.onkeydown=function(){WGEditEngine.EditControlKeyboardHandler(d,c)};b.className=d.LayoutSettings.TextBoxClass}wgDispObjGeneric(d,b,a.element,1,1,null,null,this.HasDropdownButton)}};ceProto.EnterEditMode=function(a,d,j,i){var c;var h=this.Grid;if(this.ControlType=="DHTMLClientControl"){this.InitializeBaseEditor(a)}if(this.HasDropdownButton){var f=this.GetDropdownButtonElement();if(this.DropdownButtonType=="Image"&&f!=null){var g=this.DropdownButtonWidth;var b=2;if(this.Behavior.SupportElegantStyles&&h.IsElegantDefaultStyle()){g=-1}f.style.cursor="hand";f.style.display="";if(h.UseCssFramework){g=f.offsetWidth}if(a.element.offsetHeight>f.offsetHeight){b=Math.floor((a.element.offsetHeight-f.offsetHeight)/2)}wgDispObjGeneric(h,f,a.element,a.element.offsetWidth-g,b,true)}}var e=this.ImplementationObject.OnEnterEditMode(a,d,i);this.ImplementationObject.OnSetValue(a.element.innerText,a);if(i){this.ImplementationObject.OnDirty()}if(!c){c=e}return c};ceProto.ClearEditObject=function(){this.Grid.LastEditObj=null;this.Grid.IsInEditMode=false};function WebGridEditDestructor(){var a=delete WGEditEngine}window.attachEvent("onunload",WebGridEditDestructor);if(typeof(Sys)!="undefined"){Sys.Application.notifyScriptLoaded()};