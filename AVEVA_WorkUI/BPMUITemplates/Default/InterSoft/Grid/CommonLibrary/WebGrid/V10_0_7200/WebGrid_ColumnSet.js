var WGCSEngine={DrawSelRowBorder:function(row,mode,isBlur){var hTbl=wg_getTable(row);if(!row||!hTbl){return}var grid=ISGetObject(hTbl.gridId);var table=grid.Tables[hTbl.tblName];var rowStyle=table.GetSelRowStyle();var focusStyle=table.GetFocusCellStyle();var firstCell=false;var lastCell;var isInRowSpan=false;var rowSpanCount=0;var highlightType=grid.LayoutSettings.RowHighlightType;if(focusStyle!=""){focusStyle=focusStyle.substring(focusStyle.indexOf(":")+1)}if(isBlur){rowStyle=grid.GetBlurRowStyle();focusStyle="0px"}else{if(mode=="CheckedRow"){rowStyle=table.GetCheckedRowStyle();if(rowStyle==""){return}focusStyle=""}else{if(grid.LayoutSettings.BatchUpdateSettings!=null){if(grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){if(mode=="AddedRow"||mode=="ModifiedRow"||mode=="DeletedRow"){var cssClass=grid.LayoutSettings[mode+"Style"];rowStyle=null;if(cssClass!=""){rowStyle=IS.GetCssText(grid.Id,cssClass);focusStyle=""}}if(rowStyle==null||rowStyle==""){return}}else{if(mode=="AddedRow"){rowStyle=""}}}}}var rowset=new Array();if(wgIsColumnSetRow(row)){rowset=wgGetColumnSetRows(row)}else{rowset[rowset.length]=wgGetPreviewRowParent(row)}if(table.PreviewRowVisible&&row.type!="NewRow"&&row.type!="FilterRow"){rowset[rowset.length]=wgGetPreviewRow(row)}var lastRSCell=false;for(var j=0;j<rowset.length;j++){firstCell=false;var cellCount=wgGetCellCount(rowset[j]);if(isInRowSpan){rowSpanCount--;if(rowSpanCount==1){isInRowSpan=false}firstCell=true}lastCell=null;for(var i=0;i<rowset[j].cells.length;i++){var c=rowset[j].cells[i];if(wgIsValidCell(c)){if(mode=="Clear"){with(c.runtimeStyle){cssText="";if(c.stripedClass){c.className+=" "+c.stripedClass;c.stripedClass=null}}}else{if(mode!="Redraw"){c.runtimeStyle.cssText=rowStyle}if(IS.opera){continue}if(highlightType=="EntireRow"){if(!firstCell){firstCell=true;if(!isInRowSpan&&c.rowSpan>1){isInRowSpan=true;rowSpanCount=c.rowSpan}c.runtimeStyle.borderLeft=focusStyle;if(j==0){c.runtimeStyle.borderTop=focusStyle}else{c.runtimeStyle.borderTopWidth="0px"}if(j==rowset.length-1||c.rowSpan+j-1==rowset.length-1){c.runtimeStyle.borderBottom=focusStyle}else{c.runtimeStyle.borderBottomWidth="0px"}if(cellCount>1||c.type=="GroupCell"){c.runtimeStyle.borderRightWidth="0px"}else{c.runtimeStyle.borderRight=focusStyle}}else{lastCell=c;if(j==0){c.runtimeStyle.borderTop=focusStyle}else{c.runtimeStyle.borderTopWidth="0px"}if(j==rowset.length-1||c.rowSpan+j-1==rowset.length-1){c.runtimeStyle.borderBottom=focusStyle}else{c.runtimeStyle.borderBottomWidth="0px"}c.runtimeStyle.borderLeftWidth="0px";c.runtimeStyle.borderRightWidth="0px"}}}}}if(lastCell){with(lastCell.runtimeStyle){borderRight=focusStyle;if(j==0){borderTop=focusStyle}else{borderTopWidth="0px"}if(!lastRSCell){lastRSCell=j+lastCell.rowSpan-1==rowset.length-1;if(j==rowset.length-1||lastRSCell){borderBottom=focusStyle}else{borderBottomWidth="0px"}}else{borderRightWidth="0px"}borderLeftWidth="0px";if(borderRightWidth!="0px"&&lastCell.className.indexOf("DefNoBrdRight")>=0){lastCell.stripedClass="DefNoBrdRight";lastCell.className=lastCell.className.replace(/DefNoBrdRight/g,"")}}}if(mode=="Clear"&&!IS.ie&&rowset[j].type=="PR"&&IS.IsXHTMLDocType()){var pr=rowset[j];var td=WGUIEngine.GetPreviewRowExpandImageCell(rowset[0]);var prTd=pr.cells[0];if(td.expanded=="True"){prTd.style.lineHeight="";prTd.style.paddingTop="";prTd.style.paddingBottom=""}else{prTd.style.lineHeight="0px";prTd.style.paddingTop="0px";prTd.style.paddingBottom="0px"}}}if(mode!="Clear"&&mode!="CheckedRow"){if(wgIsColumnSetRow(row)||table.PreviewRowVisible){WGCSEngine.EnsureRowsVisible(grid,row)}}if(mode=="Clear"&&row.isRowChecked&&!isBlur){WGCSEngine.DrawSelRowBorder(row,"CheckedRow")}else{if(mode=="Clear"&&grid.LayoutSettings.AllowBatchUpdate&&grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){if(typeof(rowset[0].rowState)!="undefined"){WGCSEngine.DrawSelRowBorder(rowset[0],rowset[0].rowState+"Row")}}}},CreateNewCells:function(g,u,v,m){var h=wg_getTable(v);v.origColSpan=m.colSpan;v.origRowSpan=m.rowSpan;v.infoText=m.innerText;v.oldClassName=m.className;v.oldHeight=v.style.height;m.removeNode(true);v.style.height=v.h;var e=u.ColumnSets;var q=u.ColumnSetSettings.RowCount;var f=v;for(var n=0;n<q;n++){f.type="NewRow";for(var l=0;l<e.length;l++){var b=e[l];if(b.Visible){var c=parseInt(b.ColumnCount);for(var o=0;o<c;o++){var r=b.GetRowLayout(n,o);var a=r.ColumnMember;var t=r.Spanned;if(t==null){t=""}if(a!=""||t=="None"){var p=wgInsertCell(f);p.type=(a!=""?"Cell":"ECell");p.className=g.RowClass;p.cs=b.Position;p.r=n;p.c=o;var d=r.ColSpan;var s=r.RowSpan;if(d){p.colSpan=d}if(s){p.rowSpan=s}}}}}f=wgGetNextRow(h,f);if(n+1<q){if(n+1==q-1){if(parseFloat(f.h)>0){f.style.height=f.h}else{f.style.height=v.h}}else{if(parseFloat(f.h)>0){f.style.height=f.h}else{f.style.height=v.h}}f.csRowPos=n+1}}if(u.IsRootTable){g.NeedHeightResize=true}WGCSEngine.InitNewRow(g,v)},ProcessInitialEdit:function(b){var a=wgGetCSFirstEditableCell(b);if(a){WGEditEngine.HighlightEditCell(a)}},EnsureRowsVisible:function(f,h){var e=f.GetRootTable().GetElement(WG40.BODY,WG40.HTMLDIV);if(h.type=="NewRow"){tblName=wg_getTableNameByRow(h);if(f.Tables[tblName].IsRootTable){if(e.childNodes[0].rows.length==0){e=wg_getTable(h).parentElement}}}var d=new Array();if(wgIsColumnSetRow(h)){d=wgGetColumnSetRows(h)}else{d[d.length]=wgGetPreviewRowParent(h)}var l=f.Tables[wg_getTable(h).tblName];if(l.PreviewRowVisible&&h.type!="NewRow"&&h.type!="FilterRow"){d[d.length]=wgGetPreviewRow(h)}var b=ISPosLib.getClientTop(d[0]);var c=0;for(var g=0;g<d.length;g++){c+=d[g].offsetHeight}var a=b+c+30;var k=ISPosLib.getClientTop(e);var j=k+e.offsetHeight;if(b<k&&e.contains(h)){e.scrollTop-=k-b}if(a>j){e.scrollTop+=a-j}},InitNewRow:function(e,n){var c=wgGetColumnSetRows(n);var h=wgGetColumnSetRow(n);var m=e.Tables[wg_getTableNameByRow(n)];var d=null;if(h.rowValidated){h.rowValidated=false}if(!m.IsRootTable){var l=m.GetSubTableById(wg_getTable(n).subId);d=ISXml.CreateXmlDocument();d.loadXML(l.RelNames)}for(var g=0;g<c.length;g++){var k=c[g];var a=k.cells;for(var f=0;f<a.length;f++){if(a[f].type=="Cell"){var b=wgGetColNameByCell(a[f]);WGEditEngine.InitNewCell(e,m,b,a[f],d)}else{if(a[f].type=="ECell"){a[f].innerText=" "}}}d=null}},RemoveNewCells:function(e,i,l){var d=wgGetColumnSetRows(l);l.style.height=l.oldHeight;for(var f=0;f<d.length;f++){var b=d[f].cells;for(var g=0;g<b.length;g++){if(b[g].type=="Cell"||b[g].type=="ECell"){b[g].removeNode(true);g--}}if(f==0){var h=d[f];var a=h.insertCell(-1);a.colSpan=l.origColSpan;a.innerText=l.infoText;a.type="NewRowInfoCell";a.style.cssText="";a.className=l.oldClassName}else{d[f].style.height=""}}if(i.IsRootTable){e.NeedHeightResize=true}}};function wgGetColumnSetRows(f){var g=new Array();var c=wg_getTable(f);var a=f;g[0]=wgGetColumnSetRow(f);var b=ISGetObject(c.gridId);var h=b.Tables[c.tblName];var e=g[0];for(var d=1;d<h.ColumnSetSettings.RowCount;d++){e=wgGetNextRow(c,e);g[g.length]=e}return g}function wgGetLowestColumnSetRow(b){var a=wgGetColumnSetRows(b);return a[a.length-1]}function wgGetColumnSetRowByPos(b,c){for(var a=0;a<b.length;a++){if(b[a].csRowPos==c){return b[a]}}return null}function wgGetColumnSetRow(d){var e=null;if(d.tagName=="TD"){e=d.parentElement}else{if(d.tagName=="TR"){e=d}}var c=wg_getTable(e);if(e.type=="HierRecord"){e=wgGetPreviousRow(c,e)}if(e.type=="PR"){e=wgGetPreviousRow(c,e)}var a=parseFloat(e.csRowPos);var b=e;while(a>0){b=wgGetPreviousRow(c,b);a--}return b}function wgGetCSCellByPosition(k,h,a,d){var e=wgGetColumnSetRows(k);for(var f=0;f<e.length;f++){for(var g=0;g<e[f].cells.length;g++){var b=e[f].cells[g];WG50Engine.EmulateAttributes(b);if(b.r==h&&b.c==a&&b.cs==d){return b}}}return null}function wgGetCSCellByName(e,c){var b=wg_getTable(e);var a=wgGetGridById(b.gridId);var f=a.Tables[b.tblName];var d=f.GetRowLayoutByColName(c);if(d){return wgGetCSCellByPosition(e,d.Row,d.Col,wgGetCSPosByRL(d))}}function wgGetCSPosByRL(a){return a.Parent.Position}function wgGetLastEditableCSCell(l,d,k){var h=l.ColumnSetSettings.RowCount;var a=d.ColumnCount;for(var f=h-1;f>=0;f--){for(var g=a-1;g>=0;g--){var b=l.GetColNameByRowLayout(d.Position,f,g);if(b){var c=l.GetColumn(b);var e=wgGetCSCellByName(k,b);if(c.EditType!="NoEdit"&&(e.noEdit!="True")){return e}}}}return null}function wgGetPrevEditableCSCell(a,h){var g=null;if(a.tagName=="TD"){g=a.parentElement}else{g=a}var e=wg_getTable(g);var d=wgGetGridById(e.gridId);var j=d.Tables[e.tblName];for(var f=h;f>=0;f--){var b=j.GetColumnSetByPos(f);if(!b.Visible){continue}var c=wgGetLastEditableCSCell(j,b,g);if(c){return c}}}function wgGetCSPrevEditableCell(b,a){var o=b.parentElement;if(!o){o=a}var h=wg_getTable(o);var g=wgGetGridById(h.gridId);var q=g.Tables[h.tblName];var e=q.GetColumnSetByPos(b.cs);var c=null;var f=null;var p=parseFloat(b.c)-1;for(var k=b.r;k>=0;k--){if(p<0&&k>0){p=e.ColumnCount;k--}for(var l=p;l>=0;l--){c=q.GetColNameByRowLayout(b.cs,k,l);if(c){var d=q.GetColumn(c);f=wgGetCSCellByName(o,c);if(d.EditType!="NoEdit"&&(f.noEdit!="True")){break}else{f=null}}}p=e.ColumnCount;if(f){break}}if(!f){if(parseFloat(b.cs)>0){f=wgGetPrevEditableCSCell(b,b.cs-1)}}if(!f){var n=wgGetPrevEditableRow(h,o);if(n&&n.element&&q.Get("AllowEdit")=="Yes"){var m=new wgActiveCell(h.gridId,h.tblName);m.rowChanged=true;if(n.element&&n.element.type=="GroupHeader"){m.rowElement=n.element}if(n.element.type=="Record"||n.element.type=="NewRow"){if(n.element.type=="NewRow"){m.element=wgGetCSFirstEditableCell(n.element)}else{m.element=wgGetCSLastEditableCell(n.element)}if(m.element){m.rowElement=m.element.parentElement;pos=m.element.cellIndex}else{pos=q.LastAECIndex;m.element=n.element.cells[pos]}m.cellIndex=pos}else{pos=0;m.element=null;m.cellIndex=null}return m}}else{var m=new wgActiveCell(h.gridId,h.tblName);m.element=f;m.rowElement=f.parentElement;m.cellIndex=f.cellIndex;return m}}function wgGetCSLastEditableCell(e){if(!e){return}var d=wg_getTable(e);var c=wgGetGridById(d.gridId);var f=c.Tables[d.tblName];var b=f.ColumnSets;var a=wgGetPrevEditableCSCell(e,b.length-1);return a}function wgGetCSFirstEditableCell(d){if(!d){return}var c=wg_getTable(d);var b=wgGetGridById(c.gridId);var e=b.Tables[c.tblName];var a=wgGetNextEditableCSCell(d,0);if(!a&&d.type=="NewRow"){a=d.cells[d.cells.length-1]}return a}function wgGetCSPrevEditableRow(k,a,f,c,m){var q=null;if(a.tagName=="TD"){q=a.parentElement}else{q=a}if(!q){return}var j=wg_getTable(q);var h=wgGetGridById(j.gridId);var s=h.Tables[j.tblName];var e=s.GetColumnSetByPos(a.cs);var g=null;var r=q.csRowPos;if(m){r--}for(var l=r;l>=0;l--){var b=s.GetColNameByRowLayout(f,l,c);if(b){var d=s.GetColumn(b);g=wgGetCSCellByName(q,b);if(d.EditType!="NoEdit"&&(g.noEdit!="True")){break}else{g=null;if(l==0){q=wgGetColumnSetRow(q);break}}}}if(!g){var p=wgGetPrevEditableRow(j,q);if(p&&p.element&&s.Get("AllowEdit")=="Yes"){if(p.tblName!=j.tblName||p.element.type=="GroupHeader"||(p.element.type=="NewRow"&&q.type!="NewRow")){return p}var n=wgGetLowestColumnSetRow(p.element);return wgGetCSPrevEditableRow(j,n,f,c)}}else{var o=new wgActiveCell(j.gridId,j.tblName);o.element=g;o.rowElement=g.parentElement;o.cellIndex=g.cellIndex;return o}}function wgGetPrevCSRow(p,m){var l=wgGetPreviousRow(p,m);if(m.type=="NewRow"){l=null}while(l!=null){if(l.type=="HierRecord"){if(l.style.display=="none"){l=wgGetPreviousRow(p,l)}else{var b=l.cells[l.cells.length-1];var c=b.childNodes[b.childNodes.length-1];var g=document.getElementById("dvTB_"+c.gridId+"_"+c.tblName+"_"+c.subId).childNodes[0];var f=wgGetLastVisibleRow(g);if(f){if(f.element.type=="HierRecord"){f=wgGetLastChildVisibleRow(f.element)}if(f){return f}}else{l=wgGetPreviousRow(p,l)}}}else{if(l.style.display=="none"||l.type=="GroupTotalRow"||l.type=="PR"){l=wgGetPreviousRow(p,l)}else{var n=new SelectedObject(p.tblName,p.gridId,l);return n}}}if(l==null&&m.type!="NewRow"){var e=wg_States[p.gridId];var o=e.Tables[p.tblName];var a=o.Get("AllowAddNew");if(a=="Yes"){var h=o.GetNewRow(m);if(h){l=h;var n=new SelectedObject(p.tblName,p.gridId,l);return n}}}if(l==null){var e=ISGetObject(p.gridId);var o=e.Tables[p.tblName];if(!o.IsRootTable){var d=o.GetElement(WG40.COLHEADER,WG40.HTMLDIV,m).parentElement;if(d){if(d.previousSibling){d=d.previousSibling.previousSibling;var k=document.getElementById("dvTB_"+d.gridId+"_"+d.tblName+"_"+d.subId).childNodes[0];return wgGetLastVisibleRow(k)}}var i=o.GetParentRow(m);if(i){var j=wg_getTable(i);return new SelectedObject(j.tblName,j.gridId,i)}}}return null}function wgGetCSNextEditableCell(c,a){var r=c.parentElement;if(!r){r=a}if(typeof(c.cs)=="undefined"){return null}var l=wg_getTable(r);var k=wgGetGridById(l.gridId);var t=k.Tables[l.tblName];var f=t.GetColumnSetByPos(c.cs);var q=t.ColumnSetSettings.RowCount;var b=parseFloat(f.ColumnCount);var d=null;var h=null;var s=parseFloat(c.c)+1;for(var m=c.r;m<q;m++){if(s>=b&&m<q){s=0;m++}for(var n=s;n<b;n++){d=t.GetColNameByRowLayout(c.cs,m,n);if(d){var e=t.GetColumn(d);h=wgGetCSCellByName(r,d);if(e.EditType!="NoEdit"&&(h.noEdit!="True")){break}else{h=null}}}s=0;if(h){break}}var g=t.ColumnSets.length;if(!h){if(parseFloat(c.cs)<g){h=wgGetNextEditableCSCell(c,parseFloat(c.cs)+1)}}if(!h){var p=wgGetNextEditableRow(l,r);if(p&&p.element&&t.Get("AllowEdit")=="Yes"){var o=new wgActiveCell(l.gridId,l.tblName);o.rowChanged=true;if(p.element&&(p.element.type=="GroupHeader"||p.element.type=="GroupTotalRow")){o.rowElement=p.element}if(p.element.type=="Record"||p.element.type=="NewRow"){if(p.element.type=="NewRow"){o.element=wgGetCSFirstEditableCell(p.element)}else{o.element=wgGetCSFirstEditableCell(p.element)}if(o.element){o.rowElement=o.element.parentElement;pos=o.element.cellIndex}else{pos=t.LastAECIndex;o.element=p.element.cells[pos]}o.cellIndex=pos}else{pos=0;o.element=null;o.cellIndex=null}return o}}else{var o=new wgActiveCell(l.gridId,l.tblName);o.element=h;o.rowElement=h.parentElement;o.cellIndex=h.cellIndex;return o}}function wgGetNextEditableCSCell(a,j){var h=null;if(a.tagName=="TD"){h=a.parentElement}else{h=a}var f=wg_getTable(h);var e=wgGetGridById(f.gridId);var k=e.Tables[f.tblName];var c=k.ColumnSets.length;for(var g=j;g<c;g++){var b=k.GetColumnSetByPos(g);if(!b.Visible){continue}var d=wgGetFirstEditableCSCell(k,b,h);if(d){return d}}}function wgGetFirstEditableCSCell(l,d,k){var h=l.ColumnSetSettings.RowCount;var a=d.ColumnCount;for(var f=0;f<h;f++){for(var g=0;g<a;g++){var b=l.GetColNameByRowLayout(d.Position,f,g);if(b){var c=l.GetColumn(b);var e=wgGetCSCellByName(k,b);if(c.EditType!="NoEdit"&&(e&&e.noEdit!="True")){return e}}}}return null}function wgGetCSNextEditableRow(k,a,f,c,m){var r=null;if(a.tagName=="TD"){r=a.parentElement}else{r=a}if(!r){return}var j=wg_getTable(r);var h=wgGetGridById(j.gridId);var t=h.Tables[j.tblName];var e=t.GetColumnSetByPos(a.cs);var g=null;var s=r.csRowPos;var q=t.ColumnSetSettings.RowCount;if(m){s++}for(var l=s;l<q;l++){var b=t.GetColNameByRowLayout(f,l,c);if(b){var d=t.GetColumn(b);g=wgGetCSCellByName(r,b);if(d.EditType!="NoEdit"&&(g.noEdit!="True")){break}else{g=null}}}if(!g){var p=wgGetNextEditableRow(j,r);if(p&&p.element&&t.Get("AllowEdit")=="Yes"){if(p.tblName!=j.tblName||p.element.type=="GroupHeader"||(p.element.type=="NewRow"&&r.type!="NewRow")){return p}var n=wgGetColumnSetRow(p.element);return wgGetCSNextEditableRow(j,n,f,c)}}else{var o=new wgActiveCell(j.gridId,j.tblName);o.element=g;o.rowElement=g.parentElement;o.cellIndex=g.cellIndex;return o}}function wgInsertCell(b){var a=b.insertCell(-1);while(a.parentElement==null){a=b.insertCell(b.cells.length)}return a}function wgAnimateRH(g,d,e){if(g.style.posHeight<d){var f=d-g.style.posHeight;var a=parseInt(f/2);if(a==0){a=1}g.style.height=g.style.posHeight+a;var b=function(){wgAnimateRH(g,d,e)};window.setTimeout(b,50)}else{if(e){var h=wg_getTable(g);var c=wgGetGridById(h.gridId);c.NeedHeightResize=true}}}if(typeof(Sys)!="undefined"){Sys.Application.notifyScriptLoaded()};