function SelectedObject(c,b,a){this.tblName=c;this.gridId=b;this.element=a;this.rowIndex=0;this.cellIndex=0;this.type="";this.getRowElement=this.GetRowElement=function(){if(this.element){if(this.element.tagName=="TR"){return this.element}else{return this.element.parentElement}}return null};this.GetRowObject=this.ToRowObject=function(){var e=wgGetRootRow(this.GetRowElement());if(e){var d=ISGetObject(this.gridId);var f=d.Tables[this.tblName];return f.ToRowObject(e)}};this.getColSetRowElement=this.GetColSetRowElement=function(){var d=wgGetGridById(this.gridId);var e=d.Tables[this.tblName];if(e.IsUseColumnSet){return wgGetColumnSetRow(this.element)}return null};this.getColSetRowsElement=this.GetColSetRowsElement=function(){var d=wgGetGridById(this.gridId);var e=d.Tables[this.tblName];if(e.IsUseColumnSet){return wgGetColumnSetRows(this.element)}return null};return this}function wgGetLastSelectedObject(){return wg_Global.LastSelObj}function wgGetRowHeader(f){if(!f){return null}var d=WG50Engine.GetTable(f);if(!d){return null}var b=ISGetObject(d.gridId);if(!b){return null}for(var e=0;e<f.cells.length;e++){var a=f.cells[e];WG50Engine.EmulateAttributes(a);if(a.type=="RowSelector"||a.type=="RowHeader"){return a}}return null}function wgGetValidActiveCell(a){if(a.type!="Cell"){return a.parentElement.cells[wgGetFirstEditableCell(a.parentElement)]}else{return a}}function wgGetLastVisibleRow(g){var c=null;try{c=g.rows[g.rows.length-1]}catch(a){c=null}if(c==null){var f=ISGetObject(g.gridId).Tables[g.tblName];if(f.Get("AllowAddNew")=="Yes"){c=g.parentElement.previousSibling.childNodes[0].rows[0];c=f.GetNewRow(c);var d=new SelectedObject(g.tblName,g.gridId,c);return d}}if(c){WG50Engine.EmulateAttributes(c)}if(c&&(c.style.display=="none"||c.type=="GroupTotalRow"||c.type=="PR"||c.type=="CSRecord"||c.type=="ColHeader")){return wgGetPrevVisibleRow(g,c)}else{var b=ISGetObject(g.gridId);var f=b.Tables[g.tblName];if(b.LastSelObj!=null&&b.LastSelObj.element!=null&&b.LastSelObj.element.type=="NewRow"){c=g.rows[g.rows.length-1];WG50Engine.EmulateAttributes(c);if(c.style.display=="none"||c.type=="GroupTotalRow"||c.type=="PR"||c.type=="CSRecord"||c.type=="ColHeader"){return wgGetPrevVisibleRow(g,c)}}var d=new SelectedObject(g.tblName,g.gridId,c);return d}return null}function wgGetLastChildVisibleRow(e){if(e.style.display=="none"){e=wgGetPreviousRow(tb,e)}else{var a=e.cells[e.cells.length-1];var b=a.childNodes[a.childNodes.length-1];WG50Engine.EmulateAttributes(b);var d=document.getElementById("dvTB_"+b.gridId+"_"+b.tblName+"_"+b.subId).childNodes[0];var c=wgGetLastVisibleRow(d);if(c){if(c.type=="HierRecord"){c=wgGetLastChildVisibleRow(c.element)}if(c){return c}}else{e=wgGetPreviousRow(tb,e)}}return e}function wgGetPrevVisibleRow(u,r){var g=ISGetObject(u.gridId);var t=g.Tables[u.tblName];var q=wgGetPreviousRow(u,r);WG50Engine.EmulateAttributes(r);if(r.type=="NewRow"){if(t.Get("AllowFilter")=="Yes"&&t.IsFilterRowVisible()){var f=t.GetFilterRow(r);if(f){q=f;var s=new SelectedObject(u.tblName,u.gridId,q);return s}}else{q=null}}else{if(r.type=="FilterRow"){q=null}}while(q!=null){if(q.type=="HierRecord"){if(q.style.display=="none"){q=wgGetPreviousRow(u,q)}else{var b=q.cells[q.cells.length-1];var c=b.childNodes.length;for(var h=c-1;h>-1;h--){var d=b.childNodes[h];WG50Engine.EmulateAttributes(d);if(d.subId){var l=document.getElementById("dvTB_"+d.gridId+"_"+d.tblName+"_"+d.subId).childNodes[0];var j=wgGetLastVisibleRow(l);if(j){if(j&&j.element!=null&&j.element.type=="HierRecord"){j=wgGetLastChildVisibleRow(j.element)}if(j&&j.element){return j}}else{break}}}q=wgGetPreviousRow(u,q)}}else{if(q.style.display=="none"||q.type=="GroupTotalRow"||q.type=="PR"||q.type=="CSRecord"||q.type=="RowSeparator"||q.type=="ColHeader"||q.unselectable){q=wgGetPreviousRow(u,q)}else{var s=new SelectedObject(u.tblName,u.gridId,q);return s}}}if(q==null&&r.type!="NewRow"){var a=t.Get("AllowAddNew");if(a=="Yes"){var m=t.GetNewRow(r);if(m){q=m;var s=new SelectedObject(u.tblName,u.gridId,q);return s}}if(t.Get("AllowFilter")=="Yes"){var f=t.GetFilterRow(r);if(f){q=f;var s=new SelectedObject(u.tblName,u.gridId,q);return s}}}if(q==null){var g=ISGetObject(u.gridId);var t=g.Tables[u.tblName];if(!t.IsRootTable){var e=t.GetElement(WG40.COLHEADER,WG40.HTMLDIV,r).parentElement;if(e){while(e.previousSibling!=null){e=e.previousSibling.previousSibling;WG50Engine.EmulateAttributes(e);var p=document.getElementById("dvTB_"+e.gridId+"_"+e.tblName+"_"+e.subId).childNodes[0];var j=wgGetLastVisibleRow(p);if(j&&j.element&&j.element.type=="HierRecord"){var k=wgGetPreviousRow(p,j.element);if(k!=null){j.element=k}}if(j&&j.element){return j}}}var n=t.GetParentRow(r);if(n){var o=WG50Engine.GetTable(n);return new SelectedObject(o.tblName,o.gridId,n)}}}return null}function wgProcessKeyboardEvents(a){return WGEventEngine.ProcessKeyboardEvents(a)}function wgGetPrevSiblingRow(d,b){var a;WG50Engine.EmulateAttributes(b);if(b.type=="NewRow"){return null}else{if(b.type=="Record"){a=wgGetPreviousRow(d,b);if(a){if(a.type=="HierRecord"){a=wgGetPreviousRow(d,a)}else{if(a.type=="NewRow"){a=null}}}}else{if(b.type=="GroupHeader"){a=wgGetPreviousRow(d,b);if(a){a=WGUIEngine.GetTRByGroupIndex(a,b.groupIndex,"previous")}if(a){if(a.parentIndex!=b.parentIndex){a=null}}}}}if(a==null){return null}var c=new SelectedObject(d.tblName,d.gridId,a);return c}function wgGetFirstVisibleRow(f){var b=null;try{b=f.rows[0]}catch(a){b=null}if(b){WG50Engine.EmulateAttributes(b)}if(b&&(b.style.display=="none"||b.type=="GroupTotalRow"||b.type=="PR"||b.type=="CSRecord"||b.type=="ColHeader")){return wgGetNextVisibleRow(f,b)}else{WG50Engine.EmulateAttributes(f);var d=ISGetObject(f.gridId).Tables[f.tblName];if(d.Get("AllowAddNew")=="Yes"){if(!b){b=f.parentElement.previousSibling.childNodes[0].rows[0]}b=d.GetNewRow(b)}var c=new SelectedObject(f.tblName,f.gridId,b);return c}return null}function wgGetNextSiblingRow(f,c){var b;WG50Engine.EmulateAttributes(c);if(c.type=="NewRow"){return null}else{if(c.type=="Record"){var a=wgGetGridById(f.gridId);var e=a.Tables[f.tblName];if(e.IsUseColumnSet){b=wgGetLowestColumnSetRow(c);b=wgGetNextRow(f,b)}else{b=wgGetNextRow(f,c)}if(b){if(b.type=="PR"){b=wgGetNextRow(f,b)}if(b&&b.type=="HierRecord"){b=wgGetNextRow(f,b)}else{if(b.type=="NewRow"||b.type=="GroupTotalRow"){b=null}}}}else{if(c.type=="GroupHeader"){b=wgGetNextRow(f,c);if(b){b=WGUIEngine.GetTRByGroupIndex(b,c.groupIndex,"next")}if(b){if(b.parentIndex!=c.parentIndex){b=null}}}}}if(b==null){return null}var d=new SelectedObject(f.tblName,f.gridId,b);return d}function wgGetNextVisibleRow(s,p){var f=ISGetObject(s.gridId);var r=f.Tables[s.tblName];var o=wgGetNextRow(s,p);var h=false;if(p.type=="NewRow"){h=true}else{if(wgIsFilterRow(p)&&r.Get("AllowAddNew")=="No"){h=true}}if(h){var f=ISGetObject(s.gridId);var r=f.Tables[s.tblName];var e=0;tbl=r.GetElement(WG40.BODY,WG40.HTMLTABLE,p);if(f.EnableSection508Standards){e=WG50Engine.GetFirstRecordRowIndex(tbl)}if(tbl.rows.length>0){o=tbl.rows[e]}else{o=null}if(o!=null){WG50Engine.EmulateAttributes(o)}}while(o!=null){if(o.type=="HierRecord"){if(o.style.display=="none"){o=wgGetNextRow(s,o)}else{var a=o.cells[o.cells.length-1];var b=a.childNodes.length;for(var g=0;g<b;g++){var c=a.childNodes[g];WG50Engine.EmulateAttributes(c);if(c.subId){var k=document.getElementById("dvTB_"+c.gridId+"_"+c.tblName+"_"+c.subId).childNodes[0];var j=wgGetFirstVisibleRow(k);if(j){if(j.element){return j}}else{break}}}o=wgGetNextRow(s,o)}}else{if(o.style.display=="none"||o.type=="GroupTotalRow"||o.type=="PR"||o.type=="CSRecord"||!o.type||o.type=="RowSeparator"||o.type=="ColHeader"||o.unselectable){o=wgGetNextRow(s,o)}else{var q=new SelectedObject(s.tblName,s.gridId,o);return q}}}if(o==null){if(!r.IsRootTable){var d=r.GetElement(WG40.COLHEADER,WG40.HTMLDIV,p).parentElement;if(d){if(d.nextSibling){d=d.nextSibling.nextSibling;WG50Engine.EmulateAttributes(d);var n=document.getElementById("dvTB_"+d.gridId+"_"+d.tblName+"_"+d.subId).childNodes[0];return wgGetFirstVisibleRow(n)}}var l=r.GetParentRow(p);if(l){var m=WG50Engine.GetTable(l);l=wgGetNextSiblingRow(m,l);if(!l){return null}l=wgGetPreviousRow(m,l.element);return wgGetNextVisibleRow(m,l)}}}return null}var WGEventEngine={ProcessMouseEvents:function(e,r,s){var m;if(!e){return}if(e.tagName!="TD"&&e.tagName!="TH"){m=e;e=WG50Engine.GetTDorTH(e)}if(!e){return}if(e.tagName=="TD"||e.tagName=="TH"){var u=e.parentElement;var l;WG50Engine.EmulateAttributes(e);WG50Engine.EmulateAttributes(u);if(!e.type){return}else{if(e.type=="SubCell"){e=WG50Engine.GetTD(e.parentElement);if(e){u=e.parentElement}}}if(!e.type){return}if(wgIsValidClickableCell(e)||wgIsValidRow(u)){if(e.type=="RowSelector"){r=true}var h=WG50Engine.GetTable(u);var g=ISGetObject(h.gridId);if(!g||!g.Enabled){return}var t=g.Tables[h.tblName];var a=t.Get("CellClickAction");var p=t.GetSelRowStyle();var f=t.GetFocusCellStyle();var k=g.ResolveImagePathEx(g.LayoutSettings.ImageSettings.CurrentRowImage);var c=false;if(wgGetActiveGrid()==null){wg_Global.ActiveGrid=g.Name;WG50Engine.FocusGrid(g,true)}if(!s){if(!ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnCellClick,g.Id,t.Id,u.rowIndex,e.cellIndex,e,u.position)){return}}if(typeof(event)=="undefined"){event=null}if(event!=null&&t.Get("AllowMultipleSelection")=="Yes"&&ISEvent.IsRightButton(event)){var q=t.GetCheckedRows();for(var j=0;j<q.length;j++){if(wgIsSameRow(q[j],u)){return}}}if(a=="RowSelect"||a=="CellSelect"||wgIsValidRow(u)){var b=t.Get("AllowEdit")=="Yes";if(g.LastSelObj&&(g.ActiveEditCell||g.LastEditObj)){l=g.LastSelObj.element;if(l.tagName=="TD"){l=l.parentElement}if(!wgIsSameRow(l,u)||r){var o=g.ExitEdit(1)[0];if(!o){return}}else{if(((b||(u.type=="NewRow"))||u.type=="FilterRow")&&!r&&u.type!="GroupHeader"){if(m){WG50Engine.EmulateAttributes(m);if(m.rowChecker){WGUIEngine.RowCheckerClicked(m,event.shiftKey)}else{WGEditEngine.CheckBoxClicked(m,e)}}WGEventEngine.EnsureFocusAfterCheck(g,event);WGEventEngine.ButtonClicked(g,t,m,e);c=true;if(g.LastEditObj){var o=g.ExitEditMode();if(o&&(a!="CellSelect"||u.type=="NewRow"||u.type=="FilterRow")){WGEditEngine.HighlightEditCell(e);var d=g.LayoutSettings.EditOnClick;if(d||u.type=="NewRow"||u.type=="FilterRow"){if(wgIsFilterRow(u)&&m&&m.tagName=="IMG"){return}if(!s&&event.button!=2){g.ActivateEditMode()}if(u.type=="NewRow"||wgIsFilterRow(u)||d){return}}else{e.setActive();return}}else{if(o&&a=="CellSelect"&&g.LayoutSettings.EditOnClick){}else{return}}}else{if(a!="CellSelect"){WGEditEngine.HighlightEditCell(e);if(g.LayoutSettings.EditOnClick||u.type=="NewRow"||u.type=="FilterRow"){if(wgIsFilterRow(u)&&m&&m.tagName=="IMG"){return}if(!s&&event.button!=2){g.ActivateEditMode()}}return}}}}}}WGEventEngine.EnsureFocusAfterCheck(g,event);var n=false;if((a=="RowSelect"||e.type=="RowSelector"||u.type=="GroupHeader"||u.type=="NewRow"||u.type=="FilterRow")){if(u.type=="GroupHeader"&&a=="None"){n=false}else{n=true}}if(n){if(t.Get("AllowMultipleSelection")=="Yes"&&event!=null&&(wgIsFilterRow(u)||wgIsNewRow(u))&&(event.ctrlKey||event.shiftKey)){return}if(e.type=="RowSelector"){if(!ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnRowSelectorClick,g.Id,t.Id,u.rowIndex,u,u.position)){return}r=true}if(u.type=="NewRow"){WGEventEngine.CreateNewCells(g,u)}WGEventEngine.SelectRow(u,k);if(wgIsColumnSetRow(u)&&e.type=="RowSelector"&&a=="CellSelect"){if(typeof(WGEditEngine)!="undefined"){WGEditEngine.ClearEditCell(e)}WGEventEngine.HighlightRow(u,p,f,"Forcedraw",true)}else{WGEventEngine.HighlightRow(u,p,f,"",s)}if(((b&&(u.type=="Record"||u.type=="CSRecord"))||u.type=="FilterRow")&&!r){if(g.HasFocus()){WGEditEngine.HighlightEditCell(e);if(wgIsFilterRow(u)&&m&&m.tagName=="IMG"){return}if(g.LayoutSettings.EditOnClick){g.ActivateEditMode()}}else{WGEditEngine.HighlightEditCell(e,"Nodraw")}}else{if(wgIsRecordRow(u)&&!b){g.ActiveEditCell=null}}if(r&&b){if(g.HasFocus()){e.setActive()}}if((u.type=="GroupHeader"||!b)&&g.ActiveEditCell&&g.ActiveEditCell.rowElement.type=="NewRow"){WGEditEngine.SetNewRowInfoText(g.ActiveEditCell.rowElement);g.ActiveEditCell=null}else{if(u.type=="NewRow"){WGEditEngine.ProcessInitialEdit(u);if(!s){g.ActivateEditMode()}}else{if(u.type=="FilterRow"){if(event!=null&&ISEvent.IsLeftButton(event.button)){g.ActivateEditMode()}}else{if(u.type=="GroupHeader"&&g.ActiveEditCell){g.ActiveEditCell=null}}}}}else{if(a=="CellSelect"&&u.type!="PR"){if(l){if(!wgIsSameRow(l,u)){WGEventEngine.SelectRow(u,k)}}else{WGEventEngine.SelectRow(u,k)}WGEventEngine.HighlightCell(e,p,f,"",s);if(g.LayoutSettings.EditOnClick){g.ActivateEditMode()}}}}if(m&&m.type=="checkbox"){WG50Engine.EmulateAttributes(m);if(m.rowChecker){WGUIEngine.RowCheckerClicked(m,event.shiftKey)}else{if(typeof(WGEditEngine)!="undefined"){if(typeof(WGEditEngine.CheckBoxClicked)=="function"){WGEditEngine.CheckBoxClicked(m,e)}}}}if(!c){WGEventEngine.ButtonClicked(g,t,m,e)}}},EnsureFocusAfterCheck:function(b,a){if(!IS.ie&&!b.HasFocus()){if(a&&a.srcElement){var c=a.srcElement;if(c.tagName=="INPUT"&&c.type=="checkbox"){b.SetFocus()}}}},ButtonClicked:function(e,i,f,d){if(IS.safari){if(f&&f.tagName=="IMG"&&f.parentElement!=null){if(f.parentElement.tagName=="BUTTON"){f=f.parentElement}}}if(f&&f.tagName=="BUTTON"){WG50Engine.EmulateAttributes(f);if(f.disabled){return}var c=wgGetColNameByCell(d);var h=ISEvent.Raise(e.LayoutSettings.ClientSideEvents.OnButtonClick,e.Id,i.Id,c,f.keyValue);if(h){if(IS.moz||IS.safari){event.cancelBubble=true;event.returnValue=false}var b=i.Columns.GetNamedItem(c);if(b.ButtonAutoPostback){var g=b.ButtonPostbackMode;if(g=="OnTheFly"){WG50Engine.ExecuteFlyPostback(e.Name,"ButtonClick",f)}else{var a=e.Name+"\03"+i.Id+"\03"+c+"\03"+f.keyValue;__doPostBack(e.ServerUniqueID,"ButtonClick:"+a)}}}}},CreateNewCells:function(b,j){var d;var a=j.cells;var f=0;for(var c=0;c<a.length;c++){WG50Engine.EmulateAttributes(a[c]);if(a[c].type=="NewRowInfoCell"){d=a[c];break}}if(d){var h=b.Tables[WG50Engine.GetTableNameByRow(j)];if(h.IsUseColumnSet){WGCSEngine.CreateNewCells(b,h,j,d);return}if(h.IsRootTable){f=1}j.origColSpan=d.colSpan;j.infoText=d.innerText;d.colSpan=1;d.innerText=" ";d.type="Cell";j.oldClassName=d.className;d.className=b.RowClass;for(var c=0;c<j.origColSpan-1;c++){var e=j.insertCell(-1);e.type="Cell";e.className=b.RowClass;if(f==1&&c==j.origColSpan-2){e.type=""}}if(b.FreezePaneActive&&b.FreezeConfig!=null){var g=new WebGridPartOption();g.AddNewRow=true;WGUIEngine.ProcessFreezeLayout(b,true,g)}WGEditEngine.InitializeNewRow(b,j)}},RemoveNewCells:function(h){var f;var a=h.cells;var d=WG50Engine.GetTable(h);var c=wgGetGridById(d.gridId);var g=c.Tables[d.tblName];if(g.IsUseColumnSet){WGCSEngine.RemoveNewCells(c,g,h);return}for(var e=0;e<a.length;e++){if(a[e].type=="Cell"){f=a[e];break}}if(f){var b=0;if(g.IsRootTable&&c.FreezePaneActive){for(var e=0;e<h.cells.length;e++){h.cells[e].style.display=""}}for(var e=0;e<h.origColSpan-1;e++){h.deleteCell(f.cellIndex+1);b++}f.colSpan=h.origColSpan;f.innerText=h.infoText;f.type="NewRowInfoCell";f.style.cssText="";f.className=h.oldClassName}},GetContentSpan:function(a){for(var b=0;b<a.childNodes.length;b++){if(a.childNodes[b].tagName=="SPAN"&&a.childNodes[b].getAttribute("content")==""){return a.childNodes[b]}else{if(a.childNodes[b].childNodes.length>0){var c=WGEventEngine.GetContentSpan(a.childNodes[b]);if(c){return c}}}}return null},RedrawSelectedRowBorder:function(row,mode,isBlur,ignoreBlur){var cellCount=wgGetCellCount(row);var hTbl=WG50Engine.GetTable(row);if(!row||!hTbl){return}var grid=ISGetObject(hTbl.gridId);var table=grid.Tables[hTbl.tblName];var rowStyle=table.GetSelRowStyle();var focusStyle=table.GetFocusCellStyle();var firstCell=false;var lastCell;var highlightType=grid.LayoutSettings.RowHighlightType;if(focusStyle!=""){focusStyle=focusStyle.substring(focusStyle.indexOf(":")+1)}if(wgGetActiveGrid()!=grid.Name){isBlur=true}if(ignoreBlur){isBlur=false}if(isBlur){rowStyle=grid.GetBlurRowStyle();focusStyle="0px"}else{if(mode=="CheckedRow"){rowStyle=table.GetCheckedRowStyle();if(rowStyle==null||rowStyle==""){return}focusStyle=""}else{if(grid.LayoutSettings.BatchUpdateSettings!=null){if(grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){if(mode=="AddedRow"||mode=="ModifiedRow"||mode=="DeletedRow"){var cssClass=grid.LayoutSettings[mode+"Style"];rowStyle=null;if(cssClass!=""){rowStyle=IS.GetCssValues(grid.Id,cssClass);focusStyle=""}}if(rowStyle==null||rowStyle==""){return}}else{if(mode=="AddedRow"){rowStyle=""}}}}}row.selectionMode=mode;if(wgIsColumnSetRow(row)||(table.PreviewRowVisible&&row.type!="GroupHeader"&&row.type!="NewRow")){WGCSEngine.DrawSelRowBorder(row,mode,isBlur);return}if(table.SelfReferencingSettings.Enabled&&table.SelfReferencingSettings.IsTreeViewSelectionMode&&row.type!="GroupHeader"&&row.type!="NewRow"){var colExpName=table.SelfReferencingSettings.ExpandColumnMember;var colExp=wgGetCellByName(row,colExpName);var spExp=WGEventEngine.GetContentSpan(colExp);if(mode=="Clear"){spExp.runtimeStyle.cssText=""}else{if(mode!="Redraw"){spExp.runtimeStyle.cssText=rowStyle}spExp.runtimeStyle.border=focusStyle}return}for(var i=0;i<row.cells.length;i++){var c=row.cells[i];var isHidden=false;var tempColor=null;WG50Engine.EmulateAttributes(c);if(c.type=="Cell"||c.type=="GroupCell"||c.type=="FilterColumn"){if(mode=="Clear"){if(!IS.ie&&c.currentStyle.display=="none"){isHidden=true}c.runtimeStyle.cssText="";if(isHidden){c.style.display="none"}else{if(!IS.ie&&c.style.display=="none"){c.style.display=""}}}else{if(mode!="Redraw"){if(!IS.ie&&c.currentStyle.display=="none"){isHidden=true}if(!IS.ie&&!isBlur){if(c.style.color!=""){tempColor=c.style.color}if(rowStyle.indexOf(" color:")==-1){tempColor=null}}c.runtimeStyle.cssText=rowStyle;if(!IS.ie&&tempColor){c.style.color=tempColor}if(isHidden){c.style.display="none"}}if(IS.opera){continue}if(highlightType=="EntireRow"){if(!firstCell){firstCell=true;c.runtimeStyle.borderLeft=focusStyle;c.runtimeStyle.borderTop=focusStyle;c.runtimeStyle.borderBottom=focusStyle;if(cellCount>1||c.type=="GroupCell"){c.runtimeStyle.borderRightWidth="0"}else{c.runtimeStyle.borderRight=focusStyle}}else{lastCell=c;c.runtimeStyle.borderTop=focusStyle;c.runtimeStyle.borderBottom=focusStyle;c.runtimeStyle.borderLeftWidth="0";c.runtimeStyle.borderRightWidth="0"}}}}}if(lastCell&&highlightType=="EntireRow"){with(lastCell.runtimeStyle){borderRight=focusStyle;borderTop=focusStyle;borderBottom=focusStyle;borderLeftWidth="0"}}if(mode=="Clear"&&row.isRowChecked&&!isBlur){WGEventEngine.RedrawSelectedRowBorder(row,"CheckedRow")}else{if(mode=="Clear"&&grid.LayoutSettings.AllowBatchUpdate&&grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){if(typeof(row.rowState)!="undefined"&&row.rowState!=null){WGEventEngine.RedrawSelectedRowBorder(row,row.rowState+"Row")}}}},HighlightRow:function(m,n,c,k,r){if(!m){return}if(k=="Clear"&&m.tagName=="TD"){WGEventEngine.HighlightCell(m,n,c,"Clear");return}if(k=="Clear"){var e=WG50Engine.GetTable(m);if(!e){return}var d=ISGetObject(e.gridId);if(d.LastSelObj!=null&&!WG50Engine.IsSelectedObjectValid(d.LastSelObj)){return}}else{var e=WG50Engine.GetTable(m);var d=ISGetObject(e.gridId);var g=false;if(m.type=="PR"){m=wgGetPreviousRow(e,m)}var s=d.Tables[e.tblName];if(event!=null&&s.Get("AllowMultipleSelection")=="Yes"){var j=d.LastSelObj;var h=(j!=null?j.GetRowElement():null);if(j==null||j.tblName==s.Name){if(event.ctrlKey&&!event.shiftKey){if(h!=null&&!wgIsSameRow(h,m)){if(!h.isRowChecked&&h.selectionMode!="Clear"){s.AddSelectedRow(h)}}if(!m.isRowChecked){s.AddSelectedRow(m)}else{s.RemoveSelectedRow(m);k="Clear"}}else{var p=s.GetCheckedRows();if(p.length>0&&!event.ctrlKey){for(var f=0;f<p.length;f++){var o=p[f];o.isRowChecked=false;WGEventEngine.HighlightRow(o,"","","Clear")}s.ClearSelectedRows()}if(event.shiftKey&&h!=null&&!wgIsSameRow(h,m)){if(!wgIsSameRow(h,m)){if(!h.isRowChecked&&h.selectionMode!="Clear"){s.AddSelectedRow(h)}}if(m.rowIndex>h.rowIndex){var b=wgGetNextRow(e,h);while(b!=m){if(!b.isRowChecked&&wgIsRecordRow(b)){s.AddSelectedRow(b,true)}b=wgGetNextRow(e,b)}}else{var b=wgGetPreviousRow(e,h);while(b!=m){if(!b.isRowChecked&&wgIsRecordRow(b)){s.AddSelectedRow(b,true)}b=wgGetPreviousRow(e,b)}}s.AddSelectedRow(m);g=true}}}}if(d.LastSelObj){if(!wgIsSameRow(d.LastSelObj.element,m)){if(!g){WGEventEngine.HighlightRow(d.LastSelObj.element,"","","Clear")}else{if(d.ActiveEditCell!=null&&s.SelectedRowsContain(d.ActiveEditCell.rowElement)){WGEventEngine.HighlightCell(d.ActiveEditCell.element,n,c,"")}}if(d.LastSelObj.element.type=="NewRow"){WGEventEngine.RemoveNewCells(d.LastSelObj.element)}}}else{if(d.LastSelObj&&wgIsSameRow(d.LastSelObj.element,m)&&k!="Forcedraw"){return}}if(!r){if(!ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnBeforeRowSelect,d.Id,e.tblName,d.LastSelObj)){return}}var q=new SelectedObject(e.tblName,e.gridId,m);q.type="Row";q.rowIndex=m.rowIndex;d.LastSelObj=q;if(!r){if(!ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnRowSelect,d.Id,e.tblName,m.rowIndex,m,m.position)){return}}if(d.LayoutSettings.RowChangedAction!="None"&&event!=null&&!wgIsNewRow(m)&&!wgIsFilterRow(m)){var l=d.LayoutSettings.RowChangedAction;if(l=="FullPagePostback"){var a=m.keyValue+"\03"+e.tblName;__doPostBack(d.ServerUniqueID,"RowChanged:"+a)}else{if(l=="OnTheFlyPostback"){WG50Engine.ExecuteFlyPostback(d.Name,"RowChanged",m)}}}}WGEventEngine.RedrawSelectedRowBorder(m,k)},HighlightCell:function(cell,rowStyle,focusStyle,mode,skipEvts){if(!cell.origStyle){cell.origStyle=cell.style.cssText}if(focusStyle!=""){focusStyle=focusStyle.substring(focusStyle.indexOf(":")+1)}if(mode=="Clear"&&cell.tagName=="TR"){WGEventEngine.HighlightRow(cell,rowStyle,focusStyle,"Clear");return}var hTbl=WG50Engine.GetTable(cell.parentElement);var grid=ISGetObject(hTbl.gridId);if(mode=="Clear"){}else{if(grid.LastSelObj&&grid.LastSelObj.element!=cell){WGEventEngine.HighlightCell(grid.LastSelObj.element,"","","Clear")}if(grid.LastSelObj&&grid.LastSelObj.GetRowElement()!=cell.parentElement){var lastRow=grid.LastSelObj.GetRowElement();if(lastRow&&lastRow.type=="NewRow"){WGEventEngine.HighlightRow(lastRow,"","","Clear");WGEventEngine.RemoveNewCells(lastRow)}}var selObj=new SelectedObject(hTbl.tblName,hTbl.gridId,cell);var table=grid.Tables[hTbl.tblName];selObj.type="Cell";selObj.rowIndex=cell.parentElement.rowIndex;selObj.cellIndex=wgGetCellPosByName(cell.parentElement,cell);table.LastAECIndex=cell.cellIndex;if(table.IsUseColumnSet){table.LastCSIndex=[cell.r,cell.c,cell.cs]}grid.LastSelObj=selObj;if(!skipEvts){if(!ISEvent.Raise(grid.LayoutSettings.ClientSideEvents.OnCellSelect,hTbl.gridId,hTbl.tblName,selObj.rowIndex,selObj.cellIndex,cell)){return}}var allowEdit=table.Get("AllowEdit")=="Yes";if(allowEdit){grid.ActiveEditCell=new wgActiveCell(hTbl.gridId,hTbl.tblName,cell);grid.ActiveEditCell.rowElement=cell.parentElement}}if(mode=="Clear"){var clear=true;var row=null;if(grid.LayoutSettings.AllowBatchUpdate){row=wgGetRootRow(cell.parentElement);if(row.rowState&&grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){clear=false}}if(clear){cell.runtimeStyle.cssText=""}else{if(grid.LayoutSettings.BatchUpdateSettings.HighlightChanges){var cssClass=grid.LayoutSettings[row.rowState+"RowStyle"];var rowStyle;if(cssClass!=""){rowStyle=IS.GetCssValues(grid.Id,cssClass)}if(rowStyle){with(cell.runtimeStyle){cssText=rowStyle;borderRight="";borderBottom=""}}}}if(cell.stripedClass){cell.className+=cell.stripedClass;cell.stripedClass=""}}else{with(cell.runtimeStyle){cssText=rowStyle;borderLeft=borderRight=borderBottom=borderTop=focusStyle}if(cell.className.indexOf("DefNoBrdBottom")>=0){cell.className=cell.className.replace(/DefNoBrdBottom/g,"");cell.stripedClass="DefNoBrdBottom "}if(cell.className.indexOf("DefNoBrdRight")>=0){cell.className=cell.className.replace(/DefNoBrdRight/g,"");cell.stripedClass+="DefNoBrdRight "}}},SelectRow:function(g,f){if(!g){return}var e=WG50Engine.GetTable(g);if(!e){return}var d=ISGetObject(e.gridId);if(d.LastSelObj&&f!=null){obj=d.LastSelObj.element;if(obj.tagName=="TR"){WGEventEngine.SelectRow(obj,null)}else{WGEventEngine.SelectRow(obj.parentElement,null)}}if(!d){return}if(wgIsColumnSetRow(g)){g=wgGetColumnSetRow(g)}else{if(g.type=="PR"){g=wgGetPreviewRowParent(g)}}var a=wgGetRowHeader(g);if(!a){return}if(f){var h=true;if(d.LayoutSettings.AllowBatchUpdate){if(g.rowState){h=false}}if(h){if(d.CurrentRowImage){a.innerHTML="";a.appendChild(d.CurrentRowImage)}else{a.innerHTML="<img src='"+f+"' align='absmiddle'>";d.CurrentRowImage=a.children[0]}a.setAttribute("state","selection")}}else{if(g.type=="NewRow"){f=d.ResolveImagePathEx(d.LayoutSettings.ImageSettings.NewRowImage);a.innerHTML="<img src='"+f+"' align='absmiddle'>";a.setAttribute("state","newrow")}else{var b=true;if(d.LayoutSettings.AllowBatchUpdate){if(g.rowState){b=false}}if(b){a.innerHTML="&nbsp;";a.setAttribute("state","")}}}g.markedEdit=false},SetRowHeaderIndicator:function(h,g){if(!h){return}var d=WG50Engine.GetTable(h);if(!d){return}var b=ISGetObject(d.gridId);if(!b){return}if(wgIsColumnSetRow(h)){h=wgGetColumnSetRow(h)}else{if(h.type=="PR"){h=wgGetPreviewRowParent(h)}}var a=wgGetRowHeader(h);if(!a){return}var f=b.LayoutSettings.ImageSettings;var e=f[g];if(e!=""&&typeof(e)!="undefined"){var i="";if(g=="AddedRowIndicator"){i=b.GetString("AddedRowState")}else{if(g=="ModifiedRowIndicator"){i=b.GetString("ModifiedRowState")}else{if(g=="DeletedRowIndicator"){i=b.GetString("DeletedRowState")}}}a.innerHTML="<img src='"+b.ResolveImagePathEx(e)+"' title='"+i+"' align='absmiddle'>";a.setAttribute("state",g.toLowerCase().replace("indicator",""))}},ProcessDoubleClick:function(g){var a=event.srcElement;var f;if(a.tagName!="TD"&&a.tagName!="TH"){a=WG50Engine.GetTDorTH(a)}if(!a||(a.tagName!="TD"&&a.tagName!="TH")){return}if(a.tagName=="TD"||a.tagName=="TH"){f=WG50Engine.GetTable(a.parentElement)}else{if(a.tagName=="TR"){f=WG50Engine.GetTable(a)}}if(!f){return}if(f.tagName!="TABLE"||!f.gridId){return}if(f.tblName!=g){return}var b=ISGetObject(f.gridId);var e=b.Tables[f.tblName];var d=a.parentElement;if(b.EnableSection508Standards){var c=WGUIEngine.OnColumnHeaderDblClick();if(c){return}}if(!ISEvent.Raise(b.LayoutSettings.ClientSideEvents.OnCellDblClick,f.gridId,f.tblName,d.rowIndex,a.cellIndex,a,d.position)){return}if(d.type=="GroupHeader"){WGUIEngine.ChangeImage(b,wgGetCellByPosition(d,0).childNodes[0],d.expanded);WGUIEngine.ToggleGroupRow(null,d)}else{if(wgIsRecordRow(d)){if(!b.LayoutSettings.EditOnClick){if(e.Get("AllowEdit")=="Yes"){b.ActivateEditMode()}else{if(typeof(d.srLevel)!="undefined"){wgToggleSelfRefRow(d)}}}}}event.cancelBubble=true;event.returnValue=false},OnKeyPress:function(){if(IS.moz&&wg_Global.LastKeyDownProcessed){event.cancelBubble=true;event.returnValue=false}},OnKeyUp:function(){},ProcessKeyboardEvents:function(w){var v=(w?w:event);var u=v.srcElement;if(!u){u=v._srcElement}var S,M;if(u.tagName=="TD"){S=WG50Engine.GetTable(u.parentElement);M=u.parentElement}else{if(u.tagName=="TR"){S=WG50Engine.GetTable(u);M=u}else{if(u.tagName=="SPAN"||u.tagName=="NOBR"){u=WG50Engine.GetTD(u);if(u!=null){M=u.parentElement;S=WG50Engine.GetTable(u)}}}}if(!S){return}if(S.tagName!="TABLE"||!S.gridId){return}var z=ISGetObject(S.gridId);var Q=z.Tables[S.tblName];var I=false;var d=false;var s=false;var G=true;var O=false;var P=z.LastSelObj;var A=false;var R=null;if(IS.moz){if(P){u=P.element;S=WG50Engine.GetTable(u)}}if(S!=Q.GetElement(WG40.BODY,WG40.HTMLTABLE,M)){if(!P){return}u=P.element;S=WG50Engine.GetTable(u)}try{if(!ISEvent.Raise(z.LayoutSettings.ClientSideEvents.OnKeyDown,z.Name,S.tblName,u.parentElement.rowIndex,u.cellIndex)){return}}catch(t){return}var g=Q.Get("CellClickAction");if(g=="None"){d=true}if(d){event.cancelBubble=true;return}var q=new SelectedObject(S.tblName,S.gridId,null);var m=false;var l=false;if(v.keyCode==187&&v.ctrlKey){m=true}if(v.keyCode==189&&v.ctrlKey){l=true}switch(v.keyCode){case 35:var M=P.element;if(P.type=="Cell"){M=M.parentElement}if(g=="RowSelect"||M.type=="GroupHeader"){try{if(M.type=="NewRow"){q=wgGetLastVisibleRow(Q.GetElement(WG40.BODY,WG40.HTMLTABLE))}else{q=wgGetLastVisibleRow(S)}}catch(t){}}else{q.cellIndex=wgGetCellCount(WG50Engine.GetTR(P.element))-1;q.element=wgGetCellByPosition(WG50Engine.GetTR(P.element),q.cellIndex)}if(q){var h=z.Tables[q.tblName].Get("CellClickAction");if(h=="RowSelect"||M.type=="GroupHeader"){q.type="Row"}else{if(h=="CellSelect"){q.type="Cell"}}s=true;I=true}if(!v.ctrlKey&&g!="CellSelect"){if(M.type=="NewRow"||wgIsFilterRow(M)||(wgIsRecordRow(M)&&Q.Get("AllowEdit")=="Yes")){var D=wgGetLastEditableCell(M);if(D){WGEditEngine.HighlightEditCell(D)}s=false}}break;case 36:var M=P.element;if(P.type=="Cell"){M=M.parentElement}if(g=="RowSelect"||M.type=="GroupHeader"){q=wgGetFirstVisibleRow(S)}else{q.element=wgGetCellByPosition(WG50Engine.GetTR(P.element),0);q.cellIndex=0}if(q){var h=z.Tables[q.tblName].Get("CellClickAction");if(h=="RowSelect"||M.type=="GroupHeader"){q.type="Row"}else{if(h=="CellSelect"){q.type="Cell"}}s=true;I=true}if(!v.ctrlKey&&g!="CellSelect"){if(M.type=="NewRow"||wgIsFilterRow(M)||(wgIsRecordRow(M)&&Q.Get("AllowEdit")=="Yes")){WGEditEngine.ProcessInitialEdit(M);s=false}}break;case 9:if(v.ctrlKey){while(true){var x;if(!v.shiftKey){x=wgGetNextFocusableElement(z,null,x)}else{x=wgGetPrevFocusableElement(z,null,x)}if(x){if(z.LastEditObj){z.ExitEditMode()}try{x.focus();break}catch(t){}}else{break}}s=false;I=true;break}case 37:if(v.keyCode==37||(v.keyCode==9&&v.shiftKey)){var M=P.element;if(g=="RowSelect"||M.type=="GroupHeader"||M.type=="NewRow"||wgIsFilterRow(M)){if(P.type=="Cell"){M=M.parentElement}if(M.type=="GroupHeader"&&M.expanded=="True"){WGUIEngine.ChangeImage(z,wgGetCellByPosition(M,0).childNodes[0],M.expanded);WGUIEngine.ToggleGroupRow(null,M)}else{if(typeof(M.srLevel)!="undefined"&&!Q.Get("AllowEdit")=="Yes"){if(
/*table.Get("AllowEdit") == "Yes" &&*/
g!="CellSelect"){var C=WGUIEngine.GetSelfRefImage(Q,M);WGUIEngine.ChangeImage(z,C,M.srExpanded);WGUIEngine.ToggleSelfRefRow(C)}}else{if(M.type=="NewRow"||wgIsFilterRow(M)||(wgIsRecordRow(M)&&Q.Get("AllowEdit")=="Yes")){if(!wgActiveCellValid(z,M)){WGEditEngine.ProcessInitialEdit(M)}else{var H=wgGetPrevEditableCell(z.ActiveEditCell.element,M);if(H){if(!H.rowChanged){WGEditEngine.HighlightEditCell(H.element);if(wgIsColumnSetRow(M)){H.element.setActive()}}if(H.rowChanged){M=H.rowElement;q.type="Row";q.element=M;s=true;if(H.element){A=true;R=H.element}}if(wgIsColumnSetRow(M)){G=false}}}}}}}else{if(g=="CellSelect"){if(P.cellIndex-1>=0){q=new SelectedObject(P.tblName,P.gridId,null);q.cellIndex=P.cellIndex-1;q.rowIndex=P.rowIndex;q.type="Cell";q.element=wgGetCellByPosition(P.element.parentElement,q.cellIndex);s=true}}}I=true;break}case 9:if(v.shiftKey){break}case 39:var M=P.element;if(g=="RowSelect"||P.element.type=="GroupHeader"||M.type=="NewRow"||wgIsFilterRow(M)){if(P.type=="Cell"){M=M.parentElement}if(M.type=="GroupHeader"){if(M.expanded=="False"){WGUIEngine.ChangeImage(z,wgGetCellByPosition(M,0).childNodes[0],M.expanded);WGUIEngine.ToggleGroupRow(null,M)}else{if(v.keyCode==9){var F=wgGetNextVisibleRow(S,M);var E=wgGetFirstEditableCell(F.element);if(F&&F.element){M=F.element;q.type="Row";q.element=M;s=true;if(E>-1){E=M.cells[E];A=true;R=E}}}}}else{if(typeof(M.srLevel)!="undefined"&&!Q.Get("AllowEdit")=="Yes"){if(g!="CellSelect"){var C=WGUIEngine.GetSelfRefImage(Q,M);WGUIEngine.ChangeImage(z,C,M.srExpanded);WGUIEngine.ToggleSelfRefRow(C)}}else{if(M.type=="NewRow"||wgIsFilterRow(M)||(wgIsRecordRow(M)&&Q.Get("AllowEdit")=="Yes")){if(!wgActiveCellValid(z,M)){WGEditEngine.ProcessInitialEdit(M)}else{var E=wgGetNextEditableCell(z.ActiveEditCell.element,M);if(E){if(!E.rowChanged){if(z.LayoutSettings.FocusNewRowOnLastCell&&Q.Get("AllowAddNew")=="Yes"&&E.element==z.ActiveEditCell.element&&parseFloat(M.position)==z.TotalLoadedRows-1){Q.GotoNewRow(M)}else{WGEditEngine.HighlightEditCell(E.element);if(wgIsFilterRow(M)){WGEventEngine.EnsureCellVisible(z,E.element)}if(wgIsColumnSetRow(M)){E.element.setActive()}}}if(E.rowChanged){M=E.rowElement;q.type="Row";q.element=M;s=true;if(E.element){A=true;R=E.element}}if(wgIsColumnSetRow(M)){G=false}}}}}}}else{if(g=="CellSelect"){var b=(P.element.tagName=="TR"?P.element:P.element.parentElement);if(!z.LastEditObj){if(P.cellIndex+1<wgGetCellCount(b)){q=new SelectedObject(P.tblName,P.gridId,null);q.cellIndex=P.cellIndex+1;q.rowIndex=P.rowIndex;q.type="Cell";q.element=wgGetCellByPosition(b,q.cellIndex);s=true}}else{var a=P.GetRowElement();if(wgIsRecordRow(a)&&Q.Get("AllowEdit")=="Yes"){var E=wgGetNextEditableCell(z.ActiveEditCell.element,a);if(E){q=new SelectedObject(P.tblName,P.gridId,null);q.cellIndex=E.element.cellIndex;q.rowIndex=a.rowIndex;q.type="Cell";q.element=E.element}s=true}}}}I=true;break;case 38:var o;var M=P.element;if(P.type=="Cell"){M=M.parentElement}if(v.ctrlKey){q=wgGetPrevSiblingRow(S,M);if(!q){q=wgGetPrevVisibleRow(S,M)}}else{q=wgGetPrevVisibleRow(S,M)}if(Q.Get("AllowEdit")=="Yes"&&!wgActiveCellValid(z,M)){if(!wgIsColumnSetRow(M)){WGEditEngine.ProcessInitialEdit(M)}else{G=false}}else{if(wgIsColumnSetRow(M)&&(Q.Get("AllowEdit")=="Yes"||wgIsFilterRow(M))){var u=z.ActiveEditCell.element;var n=wgGetCSPrevEditableRow(S,u,u.cs,u.c,true);if(n&&n.element&&n.element.type!="GroupHeader"&&n.element.type!="NewRow"){if(n&&Q.Id==n.tblName){if(wgIsSameRow(n.rowElement,M)){O=true;A=true;G=false;R=n.element;q=new SelectedObject(P.tblName,P.gridId,null);q.type="Row";q.element=n.rowElement}else{G=false;q=new SelectedObject(P.tblName,P.gridId,null);q.type="Row";q.element=n.rowElement;if(n.element){A=true;R=n.element}}}}else{if(!event.ctrlKey){q=wgGetPrevVisibleRow(S,u.parentElement)}}}}if(q){var h=z.Tables[q.tblName].Get("CellClickAction");if(h=="RowSelect"||q.element.type=="GroupHeader"||q.element.type=="NewRow"||q.element.type=="FilterRow"){q.type="Row"}else{if(h=="CellSelect"){q.type="Cell";if(P.tblName==q.tblName){q.cellIndex=P.cellIndex;q.element=wgGetCellByPosition(q.element,q.cellIndex)}else{if(z.Tables[q.tblName].LastAECIndex!=-1){q.cellIndex=z.Tables[q.tblName].LastAECIndex;q.element=wgGetValidActiveCell(q.element.cells[q.cellIndex])}else{q.element=wgGetCellByPosition(q.element,q.cellIndex)}}}}s=true;I=true}break;case 40:var o;var M=P.element;if(P.type=="Cell"){M=M.parentElement}if(P.tblName!=S.tblName){S=WG50Engine.GetTable(M)}if(v.ctrlKey){q=wgGetNextSiblingRow(S,M);if(!q){q=wgGetNextVisibleRow(S,M)}}else{q=wgGetNextVisibleRow(S,M)}if(Q.Get("AllowEdit")=="Yes"&&!wgActiveCellValid(z,M)){if(!wgIsColumnSetRow(M)){WGEditEngine.ProcessInitialEdit(M)}else{G=false}}else{if(wgIsColumnSetRow(M)&&(Q.Get("AllowEdit")=="Yes"||wgIsFilterRow(M))){var u=z.ActiveEditCell.element;var n=wgGetCSNextEditableRow(S,u,u.cs,u.c,true);if(n&&n.element&&n.element.type!="GroupHeader"&&n.element.type!="NewRow"){if(n&&Q.Id==n.tblName){if(wgIsSameRow(n.rowElement,M)){O=true;A=true;G=false;R=n.element;q=new SelectedObject(P.tblName,P.gridId,null);q.type="Row";q.element=n.rowElement}else{G=false;q=new SelectedObject(P.tblName,P.gridId,null);q.type="Row";q.element=n.rowElement;if(n.element){A=true;R=n.element}}}}else{if(!event.ctrlKey){q=wgGetNextVisibleRow(S,u.parentElement)}}}}if(q){var h=z.Tables[q.tblName].Get("CellClickAction");if(h=="RowSelect"||q.element.type=="GroupHeader"||q.element.type=="NewRow"){q.type="Row"}else{if(h=="CellSelect"){q.type="Cell";if(P.tblName==q.tblName){q.cellIndex=P.cellIndex;q.element=wgGetCellByPosition(q.element,q.cellIndex)}else{if(z.Tables[q.tblName].LastAECIndex!=-1){q.cellIndex=z.Tables[q.tblName].LastAECIndex;q.element=wgGetValidActiveCell(q.element.cells[q.cellIndex])}else{q.element=wgGetCellByPosition(q.element,q.cellIndex)}}}}s=true;I=true}break;case 46:var M=P.element;if(P.type=="Cell"){M=M.parentElement}if(Q.Get("AllowDelete")=="Yes"&&wgIsRecordRow(M)&&M.rowState!="Deleted"){var k=true;if(z.LayoutSettings.PromptBeforeDelete){k=confirm(z.GetString("MessageBoxText/DeleteRow"))}if(k){WGEditEngine.PrepareDeleteRowInfo(z,M);I=true}else{event.cancelBubble=true}}break;case 107:if(g=="RowSelect"){var a=P.element;if(P.type=="Cell"){a=a.parentElement}if(wgIsRecordRow(a)){var T;a=wgGetRootRow(a);for(var B=0;B<a.cells.length;B++){if(a.cells[B].type=="CellExpander"){T=a.cells[B];break}}if(T&&(a.childExpanded=="True")){WGHierEngine.ChangeImage(z,T,"True");WGHierEngine.ToggleRow(null,a)}}}I=true;break;case 109:if(g=="RowSelect"){var a=P.element;if(P.type=="Cell"){a=a.parentElement}if(wgIsRecordRow(a)){var T;for(var B=0;B<a.cells.length;B++){if(a.cells[B].type=="CellExpander"){T=a.cells[B];break}}if(T&&(a.childExpanded=="False"||!a.childExpanded)){WGHierEngine.ChangeImage(z,T,"False");WGHierEngine.ToggleRow(null,a)}}}I=true;break;case 27:if(Q.Get("AllowAddNew")=="Yes"||Q.Get("AllowEdit")=="Yes"||wgIsFilterRow(M)){var L=z.ExitEdit(-1)[0];if(L){z.IsInEditMode=false}}break;case 82:if(v.ctrlKey){z.Refresh();v.keyCode=0;I=true;break}case 76:if(v.ctrlKey){wgLoadMore(z.Name);v.keyCode=0;I=true;break}case 69:if(v.ctrlKey){if(typeof(WGMenuEngine.ShowExportMenu)=="function"&&z.LayoutSettings.AllowExport=="Yes"){wgExport(z.Name)}v.keyCode=0;I=true;break}case 115:if(v.keyCode==115){if(wgIsFilterRow(M)){WGUIEngine.OnFilterKeyDown(z.ActiveEditCell.element.childNodes[0]);v.keyCode=0;I=true}else{if(z.ActiveEditCell){var j=Q.Columns.GetNamedItem(wgGetColNameByCell(z.ActiveEditCell.element));if(j&&j.EditType=="Custom"){var f=z.CustomEditors[j.CustomEditorName];if(f.ImplementationObject){f.ImplementationObject.OnDropdown()}v.keyCode=0;I=true}}}}default:if(v.keyCode>=48&&v.keyCode<=57||v.keyCode>=54&&v.keyCode<=90||v.keyCode>=96&&v.keyCode<=111||v.keyCode>=186&&v.keyCode<=192||v.keyCode>=219&&v.keyCode<=222||v.keyCode==113||v.keyCode==13||v.keyCode==32||v.keyCode==229){if(!v.ctrlKey){var M=P.element;if(P.type=="Cell"){M=M.parentElement}if((Q.Get("AllowAddNew")=="Yes"&&M.type=="NewRow")||(Q.Get("AllowEdit")=="Yes"&&wgIsRecordRow(M))||wgIsFilterRow(M)){if(v.shiftKey&&v.keyCode==13){z.ExitEdit(0,false);I=true}else{var K=WGEditEngine.ActivateEditMode(z,true);if(v.keyCode==13){I=true}else{if(K){WGEditEngine.MarkEdit(z);v.cancelBubble=true}}}}else{var J=Q.GetRowCheckerColumn();if(J&&wgIsRecordRow(M)){WGUIEngine.SetRowCheck(M);I=true}}}else{if(v.keyCode==84){if(Q.Get("AllowFilter")=="Yes"&&Q.IsFilterRowVisible()){q=new SelectedObject(P.tblName,P.gridId,Q.GetFilterRow());q.type="Row";s=true}I=true}else{if(v.keyCode==32){var J=Q.GetRowCheckerColumn();if(J){WGUIEngine.SetRowCheck(M);I=true}}}}}}if(m){var M=P.element;if(g=="RowSelect"||P.element.type=="GroupHeader"||M.type=="NewRow"){if(P.type=="Cell"){M=M.parentElement}if(M.type=="GroupHeader"&&M.expanded=="False"){WGUIEngine.ChangeImage(z,wgGetCellByPosition(M,0).childNodes[0],M.expanded);WGUIEngine.ToggleGroupRow(null,M)}else{if(M.type=="Record"){var T;for(var B=0;B<M.cells.length;B++){if(M.cells[B].type=="CellExpander"){T=M.cells[B];break}}if(T&&(M.childExpanded=="False"||!M.childExpanded)){WGHierEngine.ChangeImage(z,T,"False");WGHierEngine.ToggleRow(null,M)}}}}}else{if(l){var M=P.element;if(g=="RowSelect"||M.type=="GroupHeader"||M.type=="NewRow"){if(P.type=="Cell"){M=M.parentElement}if(M.type=="GroupHeader"&&M.expanded=="True"){WGUIEngine.ChangeImage(z,wgGetCellByPosition(M,0).childNodes[0],M.expanded);WGUIEngine.ToggleGroupRow(null,M)}else{if(M.type=="Record"){var T;for(var B=0;B<M.cells.length;B++){if(M.cells[B].type=="CellExpander"){T=M.cells[B];break}}if(T&&(M.childExpanded=="True")){WGHierEngine.ChangeImage(z,T,"True");WGHierEngine.ToggleRow(null,M)}}}}}}if(s){var p=ISGetObject(q.gridId);var r=p.Tables[q.tblName];var N=r.GetSelRowStyle();var y=r.GetFocusCellStyle();var C=p.ResolveImagePathEx(p.LayoutSettings.ImageSettings.CurrentRowImage);if(z.ActiveEditCell||z.LastEditObj){if(!wgIsSameRow(P.GetRowElement(),q.GetRowElement())){var L=z.ExitEdit(2)[0];if(!L){return}}}if(q.type=="Row"){if(q.element.type=="NewRow"){WGEventEngine.CreateNewCells(p,q.element)}if(!O){WGEventEngine.SelectRow(q.element,C);WGEventEngine.HighlightRow(q.element,N,y)}if(G){var c=wgGetCellByPosition(q.element,0);c.setActive();if(q.element.type=="NewRow"||wgIsFilterRow(q.element)||(q.element.type=="Record"&&r.Get("AllowEdit")=="Yes")){wgSetLastAEC(q.element)}else{WGEventEngine.EnsureCellVisible(z,c);p.ActiveEditCell=null}}else{if(A){if(R.cellIndex==-1){if(q.element.type=="NewRow"){R=wgGetCSFirstEditableCell(q.element)}}WGEventEngine.EnsureCellVisible(z,R);R.setActive()}}if(A){WGEditEngine.HighlightEditCell(R)}}else{if(q.type=="Cell"){if(!wgIsSameRow(P.GetRowElement(),q.GetRowElement())){WGEventEngine.SelectRow(q.element.parentElement,C)}WGEventEngine.HighlightCell(q.element,N,y);q.element.setActive();WGEventEngine.EnsureCellVisible(p,q.element)}}}if(I){event.cancelBubble=true;event.returnValue=false}wg_Global.LastKeyDownProcessed=I},EnsureCellVisible:function(l,a){var h=l.GetRootTable().GetElement(WG40.BODY,WG40.HTMLDIV);var n=h.scrollLeft;var o=h.scrollTop;var p=a.parentElement;var u=WG50Engine.GetTableNameByRow(p);var t=l.Tables[u];var v=true;var j=0;var i=false;if(p.type=="NewRow"||p.type=="FilterRow"){if(l.Tables[u].IsRootTable){if(h.childNodes[0].rows.length==0){h=WG50Engine.GetTable(p).parentElement}}}if(t.IsRootTable&&l.FreezePaneActive){v=false;if(l.CacheFrozenWidth==0){l.CacheFrozenWidth=WGUIEngine.GetFrozenColumnsTotalWidth(l)}j=l.CacheFrozenWidth}var d=ISPosLib.getClientLeft(a)+a.offsetWidth+h.scrollLeft;var r=h.offsetWidth+h.scrollLeft+ISPosLib.getClientLeft(h);var k=posLib2.getLeftAbs(l.FrameObj,l);if(r<d){if(v){h.scrollLeft+=d-r+20}else{var m=0;if(l.FreezeConfig!=null){m=l.FreezeConfig[0].length}WGUIEngine.ScrollFreezePaneAbsolute(l,a);i=true}}if(k==0){k=ISPosLib.getClientLeft(h)}var c=ISPosLib.getClientLeft(a)-k;if(c<0&&v){h.scrollLeft+=c-20}if(!v&&l.FreezeConfig!=null){if(l.FreezeConfig[0].length>0){var g=wgGetColNameByCell(a);var f=t.Columns.GetNamedItem(g);if(f!=null&&f.HiddenFromView){if(f.Position==l.GetLastFrozenColumn().Position+1){WGUIEngine.SetFreezeScrollBarPosition(l,0,false,false,true)}else{WGUIEngine.ScrollFreezePaneToDirection(l,"Left")}i=true}}}if(!i){var e=ISPosLib.getClientTop(a);var b=e+a.offsetHeight+17;var s=ISPosLib.getClientTop(h);var q=s+h.offsetHeight;if(e<s&&h.contains(a)){h.scrollTop-=s-e}if(b>q&&q>0){h.scrollTop+=b-q}if(!IS.ie&&(n!=h.scrollLeft||o!=h.scrollTop)){WG50Engine.OnTableScroll(l)}}}};function WebGridEventDestructor(){delete WGEventEngine;window.detachEvent("onunload",WebGridEventDestructor);IS.RegisterUnloadVariables("WGEventEngine")}window.attachEvent("onunload",WebGridEventDestructor);if(typeof(Sys)!="undefined"){Sys.Application.notifyScriptLoaded()};