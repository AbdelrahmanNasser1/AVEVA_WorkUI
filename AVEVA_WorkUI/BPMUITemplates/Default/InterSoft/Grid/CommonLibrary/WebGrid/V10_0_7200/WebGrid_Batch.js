var pGrid=WebGrid.prototype;pGrid.GetChangesCount=function(){var b=0;for(var c in this.Tables){if(c!=null&&typeof(c)=="string"){var a=this.Tables[c];if(typeof(a)!="function"&&a!=null){b+=a.GetChangesCount()}}}return b};pGrid.UpdatePendingChangesStatus=function(){var c=this.GetChangesCount();var g=WG50Engine.GetCommandElement(this,"BatchUpdate",0);var a=WG50Engine.GetCommandElement(this,"BatchUpdate",1);var i=WG50Engine.GetCommandElement(this,"BatchUpdate",2);var f=WG50Engine.GetCommandElement(this,"BatchUpdate",3);var h="";if(c==0){h=this.GetString("Tooltip/PendingChangesEmpty");WGUIEngine.SetCommandAttribute(a,null,null,null,true);WGUIEngine.SetCommandAttribute(i,null,null,null,true);WGUIEngine.SetCommandAttribute(f,null,null,null,true)}else{var b=this.GetChanges("Added");var e=this.GetChanges("Modified");var d=this.GetChanges("Deleted");h=this.GetString("Tooltip/PendingChangesExisted");h=h.replace("{0}",c);h=h.replace("{1}",b.length);h=h.replace("{2}",e.length);h=h.replace("{3}",d.length);WGUIEngine.SetCommandAttribute(a,null,null,null,false);WGUIEngine.SetCommandAttribute(i,null,null,null,false);WGUIEngine.SetCommandAttribute(f,null,null,null,false)}g.innerHTML=this.GetString("CommonText/PendingChanges").replace("{0}",c);g.title=h};pGrid.UndoAllChanges=function(){var b=0;for(var c in this.Tables){if(c!=null&&typeof(c)=="string"){var a=this.Tables[c];if(typeof(a)!="function"&&a!=null){a.UndoChanges(true)}}}this.UpdatePendingChangesStatus()};pGrid.AcceptAllChanges=function(){WG50Engine.ExecuteFlyPostback(this.Id,"BatchUpdate")};pGrid.AcceptAllChangesWithEvent=function(){if(ISEvent.Raise(this.LayoutSettings.ClientSideEvents.OnAcceptAllChanges,this.Id)){this.AcceptAllChanges();return true}return false};pGrid.GetChanges=function(d){var b=new Array();for(var e in this.Tables){if(e!=null&&typeof(e)=="string"){var a=this.Tables[e];if(typeof(a)!="function"&&a!=null){var f=a.GetChanges(d);if(f.length>0){for(var c=0;c<f.length;c++){b.push(f[c])}}}}}return b};pGrid.InvalidateChanges=function(){for(var b in this.Tables){if(b!=null&&typeof(b)=="string"){var a=this.Tables[b];if(typeof(a)!="function"&&a!=null){a.InvalidateChanges()}}}};pGrid.ClearChanges=function(){for(var b in this.Tables){if(b!=null&&typeof(b)=="string"){var a=this.Tables[b];if(typeof(a)!="function"&&a!=null){a.Storage.PendingChanges.Clear()}}}};var pTable=WebGridTable.prototype;pTable.GetChanges=function(a){return this.Storage.PendingChanges.Get(null,a)};pTable.GetChangesCount=function(){return this.Storage.PendingChanges.Items.length};pTable.UndoChanges=function(d){var a=this.GetChanges();for(var b=0;b<a.length;b++){var c=a[b].Row;if(a[b].RequireInvalidate){this.Storage.PendingChanges.Remove(a[b])}else{c.UndoChanges(true)}}if(!d){this.UpdatePendingChangesStatus()}};pTable.AcceptUIChanges=function(d){var a=this.GetChanges();for(var b=0;b<a.length;b++){var c=a[b].Row;if(a[b].RequireInvalidate){this.Storage.PendingChanges.Remove(a[b])}else{c.AcceptUIChanges(true)}}if(!d){this.UpdatePendingChangesStatus()}};pTable.InvalidateChanges=function(){this.Storage.PendingChanges.Invalidate()};pTable.AcceptChanges=function(){};pTable.AddPendingChanges=function(m,n,i,e,h){var f=this.Grid;var b=null;var k=null;var c=false;var o=true;if(typeof(n.GetType)=="undefined"){k=WG50Engine.GetRowByElement(n)}else{k=n;n=k.GetElement()}k.InvalidateRowState();var b=k.GetChanges();if(b==null||b.length==0){c=true}else{if(b[0].RowState==m||(b[0].RowState=="Modified"&&m=="Added")){if(m=="Modified"){b[0].MergeChanges(k)}else{if(m=="Added"){alert(f.GetString("MessageBoxText/DuplicateKeyException").replace("{0}",b[0].KeyValues.replace("\03"," ")));return false}}}else{if(m=="Deleted"){if(b[0].RowState=="Modified"){this.RemovePendingChanges(k,true);c=true}}else{if(m=="Modified"&&b[0].RowState=="Added"){if(!b[0].MergeChanges(k)){return false}o=false}}}}if(c){b=new WebGridRowChanges();b.RowState=m;b.Setup(k);if(ISEvent.Raise(f.LayoutSettings.ClientSideEvents.OnAddPendingChanges,f.Id,this,b)){this.Storage.PendingChanges.Add(b)}}if(i){var j;if(n!=null){if(m=="Added"||m=="Modified"){WGEditEngine.AcceptChanges(n)}j=wgGetRootRow(n);if(j.rowState!="Added"){j.rowState=m}}var a=f.ActiveEditCell;var l=null;if(a!=null){l=a.rowElement}if(m=="Added"){if(l!=null&&!h){WGEditEngine.InitializeNewRow(f,l);WGEventEngine.SelectRow(l,f.GetCurSelImage());if(f.LayoutSettings.SelectFirstCellOnAdd){var d=wgGetFirstEditableCell(l);if(d>-1){WGEventEngine.ProcessMouseEvents(l.cells[d],false,true)}}}}else{if(f.LayoutSettings.BatchUpdateSettings.HighlightChanges&&this.Get("CellClickAction")=="CellSelect"&&j!=null){WGEventEngine.RedrawSelectedRowBorder(j,j.rowState+"Row",false,true);if(a!=null){WGEventEngine.ProcessMouseEvents(a.element,false,true)}}}k.UpdatePendingChangesUI(h);f.UpdatePendingChangesStatus()}if(e){if(m=="Added"){var a=wgGetCellByPosition(k.GetElement(),0);if(a!=null){if(f.HasFocus()){a.setActive()}f.PreventLoadMore();WGEventEngine.EnsureCellVisible(f,a)}}}return true};pTable.RemovePendingChangesAndAcceptUI=function(f,d){var a=f.GetChanges();var g=f.GetElement();var h=f.GetRowState();var b=f.Table.Grid;if(g!=null){var e=wgGetRootRow(g);e.rowState=null;e.removeAttribute("rowState")}for(var c=0;c<a.length;c++){a[c].UndoUIChanges(true);this.Storage.PendingChanges.Remove(a[c])}f.InvalidateRowState();if(d&&g!=null&&h!="Added"){WGEventEngine.SelectRow(g,null);WGEventEngine.RedrawSelectedRowBorder(g,"Clear")}};pTable.RemovePendingChanges=function(f,d){var a=f.GetChanges();var g=f.GetElement();var h=f.GetRowState();var b=f.Table.Grid;if(g!=null){var e=wgGetRootRow(g);e.rowState=null;e.removeAttribute("rowState")}for(var c=0;c<a.length;c++){if(ISEvent.Raise(b.LayoutSettings.ClientSideEvents.OnRemovePendingChanges,b.Id,this,a[c])){if(d){a[c].UndoUIChanges()}this.Storage.PendingChanges.Remove(a[c])}}f.InvalidateRowState();if(d&&g!=null&&h!="Added"){WGEventEngine.SelectRow(g,null);WGEventEngine.RedrawSelectedRowBorder(g,"Clear")}};pTable.UpdatePendingChangesUI=function(){};pTable.GenerateUniqueKey=function(b,a){if(b=="Number"){var c=this.UniqueKeySeed++;if(this.VirtualIdentity!=null){c+=this.VirtualIdentity[a.DataMember]}return c}else{if(b=="GUID"){return IS.CreateGUID()}}};var pRow=WebGridRow.prototype;pRow.GetChanges=function(a){if(this.Type=="Record"){return this.Table.Storage.PendingChanges.Get(this,a)}else{if(this.Type=="NewRecord"){return this.Table.Storage.PendingChanges.Get(this,"Added")}}return null};pRow.GetRowState=function(){if(this._RowStateCached){return this._RowStateCached}var a=this.GetChanges();var b="";if(a==null||a.length==0){b="Unmodified"}else{b=a[0].RowState}this._RowStateCached=b;return b};pRow.InvalidateRowState=function(){this._RowStateCached=null};pRow.UndoChanges=function(b){var a=this.Table.Grid;if(!ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnUndoChanges,a.Name,this)){return}if(this.GetRowState()!="Unmodified"){this.Table.RemovePendingChanges(this,true)}if(!b){a.UpdatePendingChangesStatus()}};pRow.AcceptUIChanges=function(a){if(this.GetRowState()!="Unmodified"){this.Table.RemovePendingChangesAndAcceptUI(this,true)}if(!a){grid.UpdatePendingChangesStatus()}};pRow.AcceptChanges=function(){};pRow.AddPendingChanges=function(){var d="";if(this._UIState=="Added"){d="Added"}else{if(this.DataChanged){d="Modified"}else{if(this._UIState=="Removed"){d="Deleted"}}}if(d=="Added"){var e=this.Table;if(e.DataKeyFieldsCount==1){WGBatchEngine.AssignKeyValues(e,this,e.DataKeyFields)}else{var a=e.DataKeyFields.split(",");for(var b=0;b<a.length;b++){var c=a[b];WGBatchEngine.AssignKeyValues(e,this,c,true)}}}this.Table.AddPendingChanges(d,this,true,false,true)};pRow.UpdatePendingChangesUI=function(h){var c=this.Table.Grid;var f=c.LayoutSettings.ImageSettings;var l=this.GetRowState();var e="";var g=false;if(l=="Added"){var j=this.GetChanges()[0];if(j.Row.GetElement()==null){WGBatchEngine.AddRowToTable(this.Table,j);g=true}e="AddedRowIndicator"}else{if(l=="Modified"){e="ModifiedRowIndicator";if(h){var j=this.GetChanges()[0];if(j.Row.GetElement()!=null){for(var d=0;d<j.Data.length;d++){var b=j.Data[d];var a=this.GetCell(b.Column.Name);if(a!=null){a.SetText(b.NewText,false,true);a.SetValue(b.NewValue,h);if(a.OldValue!=null){a.OldValue=b.OldValue;a.GetElement().oldCellValue=b.OldValue}if(a.OldText!=null){a.OldText=b.OldText;a.GetElement().oldText=b.OldText}}}ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnSynchronizeChangesUI,c.Id,j,j.Row)}}}else{if(l=="Deleted"){e="DeletedRowIndicator"}}}var k=this.GetElement();if(k!=null){WGEventEngine.SetRowHeaderIndicator(k,e);if(l=="Added"&&g){WGEventEngine.RedrawSelectedRowBorder(k,"AddedRow",false,true)}else{if(h){WGEventEngine.RedrawSelectedRowBorder(k,l+"Row",false,true)}}}};pRow.UpdateCellData=function(a){};pRow.SetDeleted=function(){this._UIState="Removed"};var pCell=WebGridCell.prototype;pCell.SetChanges=function(a,b){if(typeof(b)=="undefined"){b=a}this.Row.DataChanged=true;if(this.Row.GetElement()!=null){this.SetText(a,false,true);this.SetValue(b)}else{this.OldText=this.Text;this.OldValue=this.Value;this.Text=a;this.Value=b;this.Modified=true}};pCell.UndoChanges=function(f){var d=this.Table.Grid;var e=this.Row;if(!ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnUndoChanges,d.Name,this)){return}if(e.GetRowState()!="Unmodified"&&e.GetRowState()!="Deleted"){var b=e.GetChanges()[0];if(b!=null){var c=b.GetExistingData(this.Column.Name);if(c!=null){var a=this.GetElement();a.cellModified=true;a.oldCellValue=c.OldValue;a.oldText=c.OldText;WGEditEngine.CancelCellChanges(a,e.GetElement());b.Data.splice(c,1)}}}if(!f){d.UpdatePendingChangesStatus()}};pGrid=null;pTable=null;pRow=null;pCell=null;var WGBatchEngine={AddRowToTable:function(u,o){var f=u.Grid;var p=u.NewRowTemplate;var g=WGUIEngine.RenderGroupRowHeader(u);if(f.BindingOperationMode=="ClientBinding"){p=u.HtmlTemplate.GetRowTemplateWithGroupHeader()}else{p=p.replace(new RegExp("<td grouprowheader></td>","g"),g);if(IS.ie){p=p.replace(new RegExp("<TD grouprowheader></TD>","g"),g)}else{p=p.replace(new RegExp('<td grouprowheader=""></td>',"g"),g)}}WGUIEngine.SetTempContent("<table>"+p+"</table>");var r=WGUIEngine.GetTempContent();var v=null;if(u.IsRootTable){v=u.GetElement(WG40.BODY,WG40.HTMLTABLE)}else{if(!o.Row.SubTable){return}v=o.Row.SubTable.GetElement(WG40.BODY,WG40.HTMLTABLE)}var n;var h;var w=null;var x;var m;var q;if(v.tBodies.length>0){w=v.tBodies[v.tBodies.length-1]}else{w=document.createElement("TBODY");v.appendChild(w)}WGUIEngine.FormatFreezeRows(f,r.rows);n=r.rows[0];WG50Engine.EmulateAttributes(n);WG50Engine.EmulateAttributes(v);q=WGBatchEngine.GetSimulatedPosition(u,v);if(o.KeyValues!=null){var b=o.KeyValues.split("\03");var a=u.DataKeyFields.split("\03");if(u.DataKeyFieldsCount==1){n.keyValue=b[0]}else{for(var k=0;k<b.length;k++){n["keyValue"+k]=b[k]}}if(n.relNames!=""){var y=ISXml.CreateXmlDocument();ISXml.LoadXml(y,n.relNames);for(var k=0;k<a.length;k++){ISXml.SetNodeText(y,"//DataColumn[@name='"+a[k]+"']",b[k])}n.relNames=y.xml}}x=r.rows.length;for(var l=0;l<x;l++){r.rows[0].rowState="Added";w.appendChild(r.rows[0])}n.position=q;o.Element=n;o.Row.RelNames=n.relNames;m=o.Row;m.RowElement=n;m._UIState="Changed";for(var k=0;k<o.Data.length;k++){var d=o.Data[k];var e=d.Column;if(e.Visible){var c=m.GetCell(e.Name,true);if(c!=null){if(e.IsAutoIncrement){c.SetText("(Auto)",false,true)}else{c.SetText(d.NewText,true,true)}c.SetValue(d.NewValue,true)}}}ISEvent.Raise(f.LayoutSettings.ClientSideEvents.OnSynchronizeChangesUI,f.Id,o,o.Row);WGEditEngine.AcceptChanges(n);if(f.LayoutSettings.Hierarchical){WGEditEngine.FixTreeLines(f,u,v,n);WGEditEngine.MarkLastLines(f,u,v,n)}WGUIEngine.ClearTempContent()},MoveNewRowsToBottom:function(e){var a=e.GetChanges("Added");if(a.length>0){for(var c=0;c<a.length;c++){var b=a[c];var d=b.Element;var f=WG50Engine.GetTable(d);WGBatchEngine.MoveRow(e,f,d,f.rows.length-1)}}},MoveRow:function(b,c,a,d){c.moveRow(a.rowIndex,d)},AssignKeyValues:function(h,f,d,b){var c=h.GetColumn(d);if(c!=null){if(b&&f.KeyValues==null){f.KeyValues=new Array()}if(c.DataType=="System.String"){var g=f.GetCells().GetNamedItem(c.Name).Value;if(b){f.KeyValues.push(g)}else{f.KeyValue=g}}else{if(c.DataType=="System.Guid"||c.DataType.indexOf("Int")>-1||c.DataType=="System.Decimal"){var e;var a=f.GetCells().GetNamedItem(c.Name);var i=a.Value;if(c.IsAutoIncrement||(i==""||i==null||i==" ")){if(c.DataType=="System.Guid"){e=h.GenerateUniqueKey("GUID",c)}else{e=h.GenerateUniqueKey("Number",c)}}else{if(c.DataType=="System.Guid"){e=i}else{e=parseFloat(i)}}if(b){f.KeyValues.push(e)}else{f.KeyValue=e}a.Value=e}}}},GetSimulatedPosition:function(b,c){if(b.IsRootTable){if(b.LastRowPosition==-1){b.LastRowPosition=b.Grid.TotalRows}else{b.LastRowPosition++}return b.LastRowPosition}else{var a=b.GetSubTableById(c.subId);if(a.LastRowPosition==-1){a.LastRowPosition=a.GetRowsCount()}else{a.LastRowPosition++}return a.LastRowPosition}},DeleteSubTableCascade:function(q,p,d){var l=q.Grid;var k=false;if(typeof(d)=="undefined"){d=new Array();k=true}d.push(p.GetChanges()[0]);if(l.LayoutSettings.Hierarchical){var h=q.GetChildTables();for(var m=0;m<h.length;m++){var g=h[m];var f=p.GetChildRows(g.Name);if(f!=null&&f.length>0){for(var n=0;n<f.length;n++){var e=f[n];WGBatchEngine.DeleteSubTableCascade(g,e,d)}}}}if(d.length>0&&k){for(var m=0;m<d.length;m++){var a=d[m];var b=a.Row;var c=b.Table;if(b!=p){c.RemovePendingChanges(b);if(!c.IsRootTable){var o=c.GetSubTablePosById(b.SubTable.SubId);if(o>-1){c.SubTableIds.splice(o,1)}}}}}},InvalidateChangesCascade:function(d,c){if(d.IsRootTable){d.Grid.InvalidateChanges()}else{d.InvalidateChanges();var a=d.GetChildTables();for(var b=0;b<a.length;b++){a[b].InvalidateChanges()}}},RefreshUI:function(h,l){var m=null;var n=new Array();var f=false;if(h.Table.GetChangesCount()==0){return false}if(l!=null&&l._Type=="WebGridSubTables"){m=l;f=true}else{m=h.Table}var d=m.GetRowsCount();var b=null;if(d==0){if(m.UngroupedRows){d=m.UngroupedRows.length}if(isNaN(d)){d=0}}for(var e=0;e<d;e++){var j=m.GetRow(e,true);if(!j){if(b==null&&m.Grid.BindingOperationMode=="ClientBinding"){b=WGGroupingEngine.UngroupRows(m.Rows,new ISArray());if(b.length!=d){e=d;break}}j=b[e]}if(j!=null){var k=j.GetRowState();if(k!="Unmodified"&&k!="Added"){var c=j.GetChanges()[0];if(c.RequireInvalidate){c.Row=j;c.Element=j.GetElement();c.Element.rowState=k;c.RequireInvalidate=false}n.push(c)}}}var a=h.Table.GetChanges("Added");for(var e=0;e<a.length;e++){var g=a[e].Row;if(!f||(f&&g.SubTable!=null&&WG50Engine.CompareExact(m.RelNames,g.SubTable.RelNames))){if(f){g.SubTable=m}n.push(a[e])}}for(var e=0;e<n.length;e++){var c=n[e];var j=c.Row;if(c.RowState=="Added"){c.RequireInvalidate=false}j.UpdatePendingChangesUI(true)}},ShowCalloutNotification:function(c){var b=c.PendingChangesCallout;if(!b){b=new WebCallOut(c.Id+"_PendingChangesCallout");b.UseCssFramework=c.UseCssFramework;b.PointingPosition="AutoDetect";b.PreferredVerticalPosition="Top";b.PreferredHorizontalPosition="Right";b.Height=80;b.Width=220;b.Title="Unsaved Changes";b.UseWebResourcesForClient=true;b.TitleStyle="WG7-COTitle";b.ContainerStyle="WG7-COContainer";b.ClientSideEvents.OnClose="WGBatchEngine.OnCalloutClosed('"+c.Id+"')";if(c.UseCssFramework){b.FrameStyle="common-callout";b.TitleStyle="common-callout-title";b.ContainerStyle="common-callout-container"}b.CreateAtClient();if(!c.UseCssFramework){var d=document.getElementById(b.Id+"_titleIcon");d.style.cssText="margin-top: 3px; margin-left: 3px"}c.PendingChangesCallout=b}if(b.PreventShow){return}var a=WG50Engine.GetCommandElement(c,"BatchUpdate",1);b.SetText(c.GetString("MessageBoxText/NotifyPendingChanges").replace("{0}",c.GetChangesCount()));b.PreventShow=true;b.ShowAutoDetect(a)},OnCalloutClosed:function(b){var a=ISGetObject(b);a.SetFocus();setTimeout(function(){var c=ISGetObject(b);c.PendingChangesCallout.PreventShow=false},1000)},OnBeforeUnload:function(a){if(a.GetChangesCount()>0&&a.LayoutSettings.BatchUpdateSettings.PromptUnsavedChanges){event.returnValue=a.GetString("MessageBoxText/UnsavedPendingChanges")}},PrepareBatchUpdate:function(b,d,c,a){d.setAttribute("action","BatchUpdate");b.SetStatus1("","batchupdate","CommonText/BatchUpdate");return true},GetRelNamesString:function(d){var e="<DataColumns>";var f=d.Table;var b=f.DataKeyFields.split(",");for(var c=0;c<b.length;c++){var a=b[c];e+="<DataColumn name='"+a+"'>";if(d.KeyValues!=null&&d.KeyValues.length>0){e+=d.KeyValues[c]}else{e+=d.KeyValue}e+="</DataColumn>"}e+="</DataColumns>";return e},PostBatchUpdateProcess:function(d,s,r){var e=(ISXml.GetNodeText(s,"//hasPartialErrors")=="true");var m="";var n="";var q=d.RootTable;var o=null;if(e){m=ISXml.GetNodeText(s,"//partialErrors");n=ISXml.GetNodeText(s,"//rowErrors");var a=d.GetChanges();o=ISXml.CreateXmlDocument();ISXml.LoadXml(o,"<Root>"+n+"</Root>");var p=ISXml.GetNodes(o,"//Item");for(var f=0;f<a.length;f++){var c=a[f];var g=false;for(var k=0;k<p.length;k++){var l=ISXml.GetNodeText(p[k],"Value").replace(" ","\03");if(l==c.KeyValues){g=true;break}}if(!g){var h=c.Table;h.Storage.PendingChanges.Remove(c)}}if(ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnBatchUpdateError,d.Id,o)){alert(m.replace(/\\n/ig,"\n"))}}else{var b=d.PendingChangesCallout;if(b){b.Hide()}if(r){WGBatchEngine.AcceptUIChanges(d)}d.ClearChanges()}ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnBatchUpdateSuccess,d.Id,e,o);d.UpdatePendingChangesStatus();if(d.LayoutSettings.VerboseEditingInformation){if(!e){d.SetStatus1("","","CommonText/BatchUpdateSuccess");d.SetStatusIcon("Success")}else{d.SetStatus1("","","CommonText/BatchUpdateSuccessWithPartialErrors");d.SetStatusIcon("Warning")}d.IsStatusLocked=true}else{d.SetStatus1("","ready","CommonText/Ready")}},ResponseBatchUpdate:function(d,g){var e=new WebGridPartOption();var a=ISXml.GetNodeText(g,"//htmlString");var f=d.RootTable;var b=f.GetElement(WG40.BODY,WG40.HTMLDIV);WGBatchEngine.PostBatchUpdateProcess(d,g);WG50Engine.UnregisterGridBody(d);e.Body=true;IS.SetOuterHTML(b,a);WG50Engine.RegisterRootTableBehaviour(d);var c=ISXml.GetNodeText(g,"//footerString");if(c!=""){WGUIEngine.UpdateColumnFooter(d,f,null,c);e.Footer=true}WGUIEngine.ClearInvalidSelection(d,f);WG50Engine.OnViewChanged(f,"BatchUpdate",e);WGUIEngine.UpdateDataStatus(d,g);d.ClearChildTables()},SynchronizeNewRowTemplate:function(l,a,b){var g=l.Grid;if(a=="Move"&&!l.IsUseColumnSet&&l.NewRowTemplate!=""){var m=document.createElement("div");var c=b[0];var d=b[1];var e=c+1-l.GroupedColumns.length;var f=d+1-l.GroupedColumns.length;var j=null;m.innerHTML="<table>"+l.NewRowTemplate+"</table>";j=m.children[0].rows[0];WGUIEngine.MoveObject(j.cells[f],j.cells[e],e>f);var k=new IS.StringBuilder();for(var h=0;h<m.children[0].rows.length;h++){k.Append(m.children[0].rows[h].outerHTML)}l.NewRowTemplate=k.ToString();m=null}},UpdateNewRowTemplate:function(b,c){if(c!=null){var a=ISXml.GetNodeText(c,"//newRowTemplate");if(a){b.NewRowTemplate=a}}},AddNewRowsFromClipboard:function(o,l){var p=window.clipboardData.getData("Text");if(p==null||p==""){alert(f.GetString("MessageBoxText/ClipboardException"));return}var b=p.split("\n");var a=b[0].split("\t");var q=true;var f=o.Grid;var n=null;if(a.length<1||a.length!=o.GetVisibleColumnNames().length){q=confirm(f.GetString("MessageBoxText/ClipboardDataUnmatch"))}if(!o.IsRootTable&&l){n=o.GetSubTableById(WG50Engine.GetTableSubId(l))}if(q){if(f.LastEditObj){f.ExitEditMode()}for(var g=0;g<b.length;g++){a=b[g].split("\t");if(a!=""&&a!=" "){var k=o.NewRow(n);var e=k.GetCells();var m=0;for(var j=0;j<a.length;j++){if(j>o.Columns.length-1){break}var d=e[j];if(d){var p=WG50Engine.IsWhitespace(a[j-m])?"":a[j-m];var r=p;var c=p.split("\03");if(c.length>1){p=c[0];r=c[1]}if(d.Column.DataFormatString!=""&&WG50Engine.GetSimpleType(d.Column)=="Number"){r=wgGetUnMask(f,d.Column,d.GetElement(),true,r)}d.SetChanges(p,r)}else{m++}}k.AddPendingChanges()}}f.UpdatePendingChangesStatus()}},AcceptUIChanges:function(c){var b=0;for(var d in c.Tables){if(d!=null&&typeof(d)=="string"){var a=c.Tables[d];if(typeof(a)!="function"&&a!=null){a.AcceptUIChanges(true)}}}c.UpdatePendingChangesStatus()}};function wgAcceptAllChanges(b){var a=ISGetObject(b);if(!IS.ie&&WGUIEngine.IsCommandDisabled()){return}if(ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnAcceptAllChanges,a.Id)){a.AcceptAllChanges()}}function wgUndoAllChanges(b){var a=ISGetObject(b);var c=false;if(!IS.ie&&WGUIEngine.IsCommandDisabled()){return}if(a.LayoutSettings.BatchUpdateSettings.PromptOnUndoAllChanges){if(confirm(a.GetString("MessageBoxText/UndoPendingChanges"))){c=true}}else{c=true}if(c){if(ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnUndoAllChanges,a.Id)){a.UndoAllChanges()}}}function wgReviewChanges(b){var a=ISGetObject(b);WGBatchUIEngine.LaunchReviewChanges(a)}function wgProcessBatchUpdate(b,c){var a=ISGetObject(b);var d=ISXml.CreateXmlDocument();ISXml.LoadXml(d,c);setTimeout(function(){WGBatchEngine.PostBatchUpdateProcess(a,d,true)},0)};