function WebGridHtmlTemplate(){this.Table=null;this.IsRootTable=true;this.ContainerElement=null;this.HeaderElement=null;this.BodyElement=null;this.FooterElement=null;this.TempElement=null;this.Synchronize=function(){WGBindingEngine.SynchronizeTemplate(this)};this.ToString=function(d){if(this.IsRootTable){if(d==WG40.BODY){var l=this.BodyElement.children[0];var b=this.BodyElement.outerHTML;var g=new RegExp("<tr[^>]*record.*>","ig");var h=new RegExp("</tr>","ig");var e=g.exec(b).index;var f=-1;var a;while((a=h.exec(b))!=null){f=a.index}b=b.substring(0,e)+b.substring(f+5);return b}else{if(d==WG40.ROW){var l=this.BodyElement.children[0];var k="";for(var c=0;c<l.rows.length;c++){var j=l.rows[c];WG50Engine.EmulateAttributes(j);if(j.type!="ColHeader"&&j.type!="FilterRow"&&j.type!="RowSeparator"&&j.Type!="NewRow"){k+=l.rows[c].outerHTML}}return k}}}else{}};this.GetRowTemplateWithGroupHeader=function(){var b=this.ToString(WG40.ROW);var c=this.Table;var a=WGUIEngine.RenderGroupRowHeader(c);if(IS.ie&&!IS.IsHTML5DocType()&&!IS.IsXHTMLDocType()){b=b.replace(new RegExp("<TD grouprowheader></TD>","g"),a)}else{b=b.replace(new RegExp('<td grouprowheader=""></td>',"ig"),a)}return b};this.SetTempRow=function(a){if(this.TempElement==null){this.TempElement=document.createElement("div")}this.TempElement.innerHTML="<table>"+a+"</table>"};this.IsTempRowInitialized=function(){return(this.TempElement!=null&&this.TempElement.children[0].rows.length>0)};this.GetTempRow=function(){if(this.TempElement!=null){return this.TempElement.children[0].rows[0]}return null};this.GetTempRowString=function(){var a=this.GetTempRow();if(a!=null){return a.outerHTML}return""};this.MergeRowToBody=function(c){var a=this.ToString(WG40.BODY);var b=a.indexOf("<tbody>");if(b==-1){b=a.indexOf("<TBODY>")}if(c.toLowerCase().indexOf("<tbody>")==-1){b+=7;a=a.substring(0,b)+c+a.substring(b)}else{a=a.substring(0,b)+c+a.substring(b+15)}return a};this.GetVirtualCellElement=function(a){var b=document.createElement("div");b.innerHTML="<table><tr>"+a+"</tr></table>";return b.children[0].rows[0].cells[0]}}var WGBindingEngine={MapJsonToXml:function(g,k){var p=ISXml.CreateXmlDocument();var e=null;var f=null;var m=null;ISXml.LoadXml(p,"<isnet.webui.webgrid />");for(var j in k){ISXml.CreateNode(p,p.documentElement,j);ISXml.SetNodeText(p.documentElement,j,k[j])}if(k.jsonBody){e=ISJsonEngine.ParseAjax(k.jsonBody);f=ISADONETMappingEngine.MappingJsonToObject(e)}if(k.tblName){m=g.Tables[k.tblName]}else{m=g.RootTable}switch(k.action){case"ColumnFilter":case"ColumnSort":case"BatchUpdate":var a=new Array();if(k.jsonGroupRows){a.push(ISJsonEngine.ParseAjax(k.jsonGroupRows))}m.Rows=null;WGBindingEngine.EnsureDataBound(m,f,a);ISXml.CreateCDATA(p,p.documentElement,"htmlString",WGRenderEngine.RenderTableBody(m,f));break;case"LoadData":case"Refresh":case"Group":case"Ungroup":case"ChangeGroup":case"ColumnChange":var a=new Array();if(k.action=="Group"||k.action=="Ungroup"){WGBindingEngine.SynchronizeTemplate(m.HtmlTemplate,k.action,[1])}if(k.jsonGroupRows){a.push(ISJsonEngine.ParseAjax(k.jsonGroupRows))}m.Rows=null;WGBindingEngine.EnsureDataBound(m,f,a);ISXml.CreateCDATA(p,p.documentElement,"bodyHtmlString",WGRenderEngine.RenderTableBody(m,f));break;case"Paging":if(!k.jsonBody){e=ISJsonEngine.ParseAjax(k.jsonRows);f=ISADONETMappingEngine.MappingJsonToObject(e)}m.Rows=null;WGBindingEngine.EnsureDataBound(m,f);if(k.jsonBody){ISXml.CreateCDATA(p,p.documentElement,"bodyHtmlString",WGRenderEngine.RenderTableBody(m,f))}else{ISXml.CreateCDATA(p,p.documentElement,"rowsHtmlString",WGRenderEngine.RenderRows(m,f))}break;case"More":var l=WGBindingEngine.EnsureDataBound(m,f,[null,true]);ISXml.CreateCDATA(p,p.documentElement,"htmlString",WGRenderEngine.RenderRows(m,f,l[0]));m._PartialRows=l[0];break;case"LoadGroup":var l=WGBindingEngine.EnsureDataBound(m,f,[null,false,[k.position,k.parentPos]]);var b=WGRenderEngine.RenderRows(m,f,l[0]);if(g.ClientBindingSettings.EnableGroupRowPaging){if(k.loadedRows&&parseInt(k.loadedRows)<parseInt(k.totalRows)){var h=m.ToRowObject(g.LastRequestObj);h.GroupTotalRendered=true;b+=WGGroupingEngine.RenderGroupLoadMoreRow(h)}}if(b!=""){b="<tbody>"+b+"</tbody>"}ISXml.CreateCDATA(p,p.documentElement,"htmlString",b);m._PartialRows=l[0];break;case"AddRow":case"UpdateRow":case"DeleteRow":if(k.jsonBody){m.Rows=null;WGBindingEngine.EnsureDataBound(m,f);ISXml.CreateCDATA(p,p.documentElement,"htmlTB",WGRenderEngine.RenderTableBody(m,f))}else{if(k.jsonRows){e=ISJsonEngine.ParseAjax(k.jsonRows);f=ISADONETMappingEngine.MappingJsonToObject(e);var l=WGBindingEngine.EnsureDataBound(m,f,[null,false,null,k]);var d=l[0];var n=WGRenderEngine.RenderRows(m,f,[d]);ISXml.CreateCDATA(p,p.documentElement,"htmlRow",n);m._PartialRows=[d]}else{if(k.htmlRow=="RowRemoved"||k.action=="DeleteRow"){var d=g.GetSelectedObject().ToRowObject();var c=d.ParentCollection;c.splice(parseFloat(d.Position),1);c.ReindexPosition();WGBindingEngine.PostDataBound(m)}}}break;case"LoadChild":break;case"ChildTableRefresh":break;case"SelfRefChild":break}return p},PrepareLoadData:function(c,f,d){if(c.LastEditObj){c.ExitEditMode()}f.setAttribute("action","LoadData");f.setAttribute("tblName",c.GetRootTable().Id);WGUIEngine.ReorderColumn(c.RootTable);if(IS.moz){if(!c.RootTable.IsUseColumnSet&&c.RootTable.Columns.length>0){var b=c.RootTable.Columns[0];try{b.Resize(b.Width)}catch(a){}}}c.SetStatus1("","loadingdata","CommonText/LoadingData");return true},EnsureDataBound:function(q,d,a){var n=[];var e=q.Grid;if(q.Rows==null){WGBindingEngine.PopulateRows(q,d,a);WGBindingEngine.PrepareGroupRows(q,a)}else{if(typeof(a)!="undefined"){n[0]=WGBindingEngine._PopulateRows(q,d);if(a[1]){WGBindingEngine.MergeGridRows(q.Rows,n[0])}else{if(a[2]){var l=a[2][0];var k="";var p=q.Rows;if(a[2][1]!=null){if(a[2][1].indexOf(";")>-1){k=a[2][1].split(";")}else{k=a[2][1].split("_")}}groupRow=null;if(k!=""){for(var h=0;h<k.length;h++){if(h==0){gr=p[parseFloat(k[h])]}else{gr=gr.Children[parseFloat(k[h])]}}gr=gr.Children[l]}else{gr=p[l]}if(gr!=null){var g=gr.GetChildren();for(var h=0;h<n[0].length;h++){var m=n[0][h];g.Add(m);m._UIState="Unchanged";m.ParentCollection=g;m.Parent=gr}}}else{if(a[3]){var j=a[3];var b=null;if(j.action=="UpdateRow"){var c=e.GetSelectedObject().ToRowObject();b=c.ParentCollection;var f=WGBindingEngine.CreateRow(q,d.Rows[0],c.Position);c.Cells=f.Cells;c.DataRow=f.DataRow;c.KeyValue=f.KeyValue;c.KeyValues=f.KeyValues;if(j.needReposition=="True"&&j.grouplevel==""){b.splice(parseFloat(c.Position),1);c.Position=parseFloat(j.position);b.splice(c.Position,0,c)}n[0]=c}else{var f=WGBindingEngine.CreateRow(q,d.Rows[0],parseFloat(j.position));b=q.Rows;f.Position=f.DataSourceIndex;b.splice(f.Position,0,f);n[0]=f}if(b!=null){b.ReindexPosition()}}}}}}ISEvent.Raise(e.LayoutSettings.ClientSideEvents.OnDataBound,e.Id);WGBindingEngine.PostDataBound(q);return n},PostDataBound:function(b,c){var a=b.Grid;if(b.Get("ColumnFooters")=="Yes"){WGBindingEngine.UpdateColumnFooter(b)}if(a.LayoutSettings.AllowBatchUpdate){a.UpdatePendingChangesStatus()}if(c){b.UpdateDataStatus()}},PopulateRows:function(d,b,a){var c=WGBindingEngine._PopulateRows(d,b);d.UngroupedRows=null;d.Rows=c;d.Rows.UngroupedRows=c},_PopulateRows:function(l,d,j,b){if(!j){j=new ISArray()}var c=null;var f=l.Grid;if(d.GetType()=="ISDataTable"){c=d.Rows}else{if(d.GetType()=="ISDataView"){c=d.Items}}if(d!=null&&c.length>0){var k=0;var e=c.length;if(!f.IsClientBinding("Server")&&f.LayoutSettings.PagingMode!="None"){if(f.IsClientOperation()){if(f.IsClassicPaging()){f.EnsureCurrentPageValid();var a=f.GetCurrentPage();k=(a-1)*f.LayoutSettings.PagingSize;e=k+f.LayoutSettings.PagingSize}else{if(l.GroupedColumns.length==0){k=(b!=undefined?b:0);e=k+f.LayoutSettings.VirtualPageSize}}if(e>c.length){e=c.length}}}for(var h=k;h<e;h++){var g=WGBindingEngine.CreateRow(l,c[h],h);j.Add(g);g.ParentCollection=j;g._UIState="Unchanged"}}j.Parent=l;return j},PrepareGroupRows:function(c,a){var b;if(c.GroupedColumns.length>0){if(c.IsRootTable){b=WGGroupingEngine.GroupRows(c.Rows,c.GroupedColumns[0])}else{}if(c.Grid.LayoutSettings.PagingMode=="VirtualLoad"&&a&&a.length>0){WGGroupingEngine.PrepareVirtualGroupRows(c,b,a[0])}c.UngroupedRows=c.Rows;c.Rows=b}},CreateRow:function(o,n,k){var m=o.NewRow();var b=m.GetCells();var g=o.Grid;if(n==null){throw new Error("rowView cannot be null during CreateRow.")}if(n.GetType()=="ISDataRowView"){n=n.Row}m.DataRow=n;m.DataSourceIndex=k;m.SectionRowIndex=k;if(o.DataKeyFieldsCount==1){m.KeyValue=n.Cells.GetNamedItem(o.DataKeyFields).Value}else{if(o.DataKeyFieldsCount>1){var f=o.DataKeyFields.split(",");m.KeyValues=new Array();for(var l=0;l<f.length;l++){m.KeyValues.push(n.Cells.GetNamedItem(f[l]).Value)}}}if(o.PreviewRowVisible&&o.PreviewRowSettings.DataMember!=""){m.PreviewRowValue=n.Cells.GetNamedItem(o.PreviewRowSettings.DataMember).Value}if(g.SerializeTagToClient){var p=n.Cells.GetNamedItem("__tag");if(p!=null){m.Tag=p.Value}}for(var k=0;k<b.length;k++){var a=b[k];var d=a.Column;if(d.Bound){var e=d.DataMember;var c=n.Cells.GetNamedItem(e);var q=n.Cells.GetNamedItem("__text_"+e);var h=n.Cells.GetNamedItem("__group_"+e);if(!g.IsClientBinding("Server")){if(d.ValueList!=null&&d.ValueList.IsValid()){q=n.Cells.GetNamedItem(d.ValueList.DataTextField)}}if(c!=null){a.Value=c.Value;a.Text=a.Value}if(a.Text!=null){a.Text=a.Text.toString()}if(q!=null){a.Text=q.Value}if(h!=null){m.GroupRowText=h.Value}ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnInitializeCell,g.Id,a)}}ISEvent.Raise(g.LayoutSettings.ClientSideEvents.OnInitializeRow,g.Id,m);return m},MergeGridRows:function(c,d){var b=c.Parent;c.Parent=null;for(var a=0;a<d.length;a++){c.Add(d[a]);d[a]._UIState="Unchanged"}c.Parent=b},PrepareTemplate:function(d,c){var a=d.RootTable.GetElement(WG40.BODY,WG40.HTMLDIV);var e=new WebGridHtmlTemplate();e.Table=d.RootTable;if(a!=null){var b=document.createElement("div");var m=e.Table.NewRowTemplate;var n=a.outerHTML;if(c){var k=-1;var i=null;if((i=new RegExp("<tr[^>]*record.*>","ig").exec(n))!=null){k=i.index}if(k>-1){var l=-1;var h=new RegExp("</tr>","ig");var j=null;while((j=h.exec(n))!=null){l=j.index}if(l>-1){n=n.substring(0,k)+n.substring(l)}}}var f=n.indexOf("<tbody>");if(f==-1){f=n.indexOf("<TBODY>")}if(f>-1){f+=7}else{f=n.indexOf("</table>");if(f==-1){f=n.indexOf("</TABLE>")}}n=n.substring(0,f)+m+n.substring(f);b.innerHTML=n;if(b.children[0].children.length>1){b.children[0].removeChild(b.children[0].children[1])}e.BodyElement=b.children[0]}d.RootTable.HtmlTemplate=e},PrepareChildTableTemplate:function(a){},SynchronizeTemplate:function(K,a,b){var F=K.Table;var p=F.Grid;var c=K.BodyElement;var G=c.children[0];var j=G.children[0];var D=G.rows[0];switch(a){case"Resize":j.childNodes[b[0]].width=b[1];break;case"Move":var d=b[0];var e=b[1];var f=d+1-F.GroupedColumns.length;var g=e+1-F.GroupedColumns.length;WGUIEngine.MoveObject(j.childNodes[e],j.childNodes[d],d>e);WGUIEngine.MoveObject(D.cells[g],D.cells[f],f>g);break;case"Remove":var u=b[0];if(!IS.ie&&WGUIEngine.GetFreezeAdjustment(p)<0){WGUIEngine.SkipFreezeLayout(p,500);WGUIEngine.InvalidateFreezeContainer(p);WGUIEngine.SetFreezeScrollBarPosition(p,0,false,false,true,true)}else{u+=WGUIEngine.GetFreezeAdjustment(p)}j.childNodes[u].removeNode(true);D.cells[u+1-F.GroupedColumns.length].removeNode(true);var k=F.GetElement(WG40.COLHEADERGROUP);if(k!=null){k.childNodes[u].removeNode(true)}if(F.Get("ColumnFooters")=="Yes"){var H=F.GetElement(WG40.COLFOOTER,WG40.HTMLTABLE);var h=H.rows[1];H.children[0].childNodes[u].removeNode(true);h.cells[u].removeNode(true)}break;case"Add":var l=b[0];var u=b[1];var E=b[2];var w=document.createElement("col");if(!IS.ie&&WGUIEngine.GetFreezeAdjustment(p)<0){WGUIEngine.SkipFreezeLayout(p,500);WGUIEngine.InvalidateFreezeContainer(p);WGUIEngine.SetFreezeScrollBarPosition(p,0,false,false,true,true)}else{u+=WGUIEngine.GetFreezeAdjustment(p)}if(E){var I=F.GetElement(WG40.COLHEADER,WG40.HTMLTABLE);var P=K.GetVirtualCellElement(F.HeaderTemplate);var z=I.rows[0].cells[u-1].insertAdjacentElement("afterEnd",P);var M=z.parentElement;WGBindingEngine.SetupColumnHeader(l,z)}var k=F.GetElement(WG40.COLHEADERGROUP);if(k!=null){var A=document.createElement("col");A.width=l.Width;k.childNodes[u-1].insertAdjacentElement("afterEnd",A)}if(F.Get("AllowAddNew")=="Yes"){var B=F.GetNewRow(M);B.cells[B.cells.length-1].colSpan+=1;B.nextSibling.cells[0].colSpan+=1}if(F.IsRootTable&&F.Get("AllowFilter")=="Yes"){var n=F.GetFilterRow(M);var N=K.GetVirtualCellElement(F.FilterTemplate);var x=n.cells[u-1].insertAdjacentElement("afterEnd",N);if(!x){x=N}WGBindingEngine.SetupColumnFilter(l,x);n.nextSibling.cells[0].colSpan+=1}if(F.Get("ColumnFooters")=="Yes"){var H=F.GetElement(WG40.COLFOOTER,WG40.HTMLTABLE);var h=H.rows[1];var y=document.createElement("col");var O=K.GetVirtualCellElement(F.FooterTemplate);var x=h.cells[u-1].insertAdjacentElement("afterEnd",O);h.previousSibling.cells[0].colSpan+=1;y.width=l.Width;H.children[0].childNodes[u-1].insertAdjacentElement("afterEnd",y)}w.width=l.Width;j.childNodes[u-1].insertAdjacentElement("afterEnd",w);var L=K.GetTempRow();var v=D.insertCell(u+(E?1:0)-F.GroupedColumns.length);var J=null;var q=new WebGridCell();for(var t=0;t<L.cells.length;t++){if(L.cells[t].type=="Cell"){J=L.cells[t];break}}v.className=p.LayoutSettings.RowClass+" "+(J?J.additionalClass:"");WGRenderEngine.SetAttribute(v,"type","Cell");q.Row=new WebGridRow();q.Column=l;WGRenderEngine.RenderCell(l,q,v,true);break;case"Group":var s=F.GetElement(WG40.COLHEADER,WG40.HTMLTABLE);if(s!=null){var r=s.rows[0];var m=null;var B=null;var o=null;var H=null;var k=F.GetElement(WG40.COLHEADERGROUP);if(F.Get("AllowFilter")=="Yes"){m=F.GetFilterRow(r)}if(F.Get("AllowAddNew")=="Yes"){B=F.GetNewRow(r)}if(F.Get("ColumnFooters")=="Yes"){H=F.GetElement(WG40.COLFOOTER,WG40.HTMLTABLE);o=H.rows[1]}for(var t=0;t<b[0];t++){if(k!=null){WGBindingEngine.CreateColGroup(p,k)}WGBindingEngine.CreateGroupRowHeader(p,r);if(m!=null){WGBindingEngine.CreateGroupRowHeader(p,m);m.nextSibling.cells[0].colSpan+=1}if(B!=null){WGBindingEngine.CreateGroupRowHeader(p,B);B.nextSibling.cells[0].colSpan+=1}if(o!=null){WGBindingEngine.CreateColGroup(p,H.children[0]);WGBindingEngine.CreateGroupRowHeader(p,o);o.previousSibling.cells[0].colSpan+=1}WGBindingEngine.CreateColGroup(p,j);if(p.EnableSection508Standards){var C=F.GetElement(WG40.COLGROUP,WG40.HTMLTABLE);WGBindingEngine.CreateColGroup(p,C)}}}break;case"Ungroup":var s=F.GetElement(WG40.COLHEADER,WG40.HTMLTABLE);var m=null;var B=null;var o=null;var H=null;var k=F.GetElement(WG40.COLHEADERGROUP);if(F.Get("AllowFilter")=="Yes"){m=F.GetFilterRow(r)}if(F.Get("AllowAddNew")=="Yes"){B=F.GetNewRow(r)}if(F.Get("ColumnFooters")=="Yes"){H=F.GetElement(WG40.COLFOOTER,WG40.HTMLTABLE);o=H.rows[1]}if(s!=null){var r=s.rows[0];if(k!=null){k.childNodes[0].removeNode(true)}for(var t=0;t<b[0];t++){if(m!=null){m.deleteCell(0);m.nextSibling.cells[0].colSpan-=1}if(B!=null){B.deleteCell(0);B.nextSibling.cells[0].colSpan-=1}if(o!=null){H.children[0].childNodes[0].removeNode(true);o.deleteCell(0);o.previousSibling.cells[0].colSpan-=1}r.deleteCell(0);j.childNodes[0].removeNode(true)}}break}if((a=="Group"||a=="Ungroup")&&p.EnableSection508Standards){WGBindingEngine.PrepareTemplate(p,true)}},GetColWidth:function(a,b){if(a.UseCssFramework){return a.LayoutSettings.RowHeaderWidth+"px"}if(b=="Hier"){return"22px"}else{if(b=="Group"){return"16px"}}return"16px"},CreateGroupRowHeader:function(a,c){var b=c.insertCell(0);b.type="ColHeader";b.style.width=WGBindingEngine.GetColWidth(a,"Group");b.className=c.cells[1].className;b.innerText=" "},CreateColGroup:function(a,c){var b=document.createElement("col");b.width=WGBindingEngine.GetColWidth(a,"Group");c.insertAdjacentElement("afterBegin",b)},_WalkedRow:null,SynchronizeElements:function(e,b,a){var d=e.Rows;if(b){d=b}if(d.length>0){var f=e.GetElement(WG40.BODY,WG40.HTMLTABLE);var c=null;if(!a){c=f.rows[0]}else{c=a}WGBindingEngine._WalkedRow=c;WGBindingEngine.SynchronizeRows(e,f,d)}WGBindingEngine._WalkedRow=null},SynchronizeRows:function(g,h,f){var d=WGBindingEngine._WalkedRow;var a=g.Grid;for(var b=0;b<f.length;b++){var c=f[b];var e=false;if(!WGBindingEngine.IsValidMapableRow(d)){while(d!=null&&!WGBindingEngine.IsValidMapableRow(d)){d=wgGetNextRow(h,d)}}if(d!=null){if(c.Type==d.type){e=true;if(c.Type=="Record"){if(c.GetKeyValueString()!=WG50Engine.GetKeyValueString(g,d)){e=false}}}if(!e){throw new Error("SynchronizeRows failed!")}else{c.RowElement=d}ISEvent.Raise(a.LayoutSettings.ClientSideEvents.OnSynchronizeRow,a.Id,c);WGBindingEngine.PostRowInitialization(c);WGBindingEngine.SynchronizeCells(g,c)}WGBindingEngine._WalkedRow=wgGetNextRow(h,d);if(c.Children!=null&&c.Children.length>0){WGBindingEngine.SynchronizeRows(g,h,c.Children)}d=WGBindingEngine._WalkedRow}},SynchronizeCells:function(i,g){var c=i.Grid;var b=g.RowElement.cells;var e=0;var h=0;if(g.Type=="Record"){for(var f=0;f<b.length;f++){var a=b[f];WG50Engine.EmulateAttributes(a);if(a.type=="Cell"){var d=g.Cells[h];if(d!=null&&d.Column.Visible){d.CellElement=a;ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnSynchronizeCell,c.Id,d);WGBindingEngine.PostCellInitialization(d);e++}h++}}if(i.GetVisibleColumnNames().length!=h){throw new Error("SynchronizeCells failed!")}}else{var d=g.Cells[0];d.CellElement=b[b.length-1];ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnSynchronizeCell,c.Id,d);WGBindingEngine.PostCellInitialization(d)}},IsValidMapableRow:function(a){WG50Engine.EmulateAttributes(a);if(a.type=="Record"||a.type=="GroupHeader"){return true}return false},UpdateColumnFooter:function(h){var g=h.GetUngroupedRows();for(var e=0;e<h.Columns.length;e++){var a=h.Columns[e];if(a.Visible&&a.AggregateFunction!="None"){var f=WGRenderEngine.RenderAggregateFunction(g,a,null);var d=h.GetElement(WG40.COLFOOTER,WG40.HTMLTABLE);var c=d.rows[1];var b=wgGetCellByName(c,f.ColumnName);if(b!=null){b.innerText=(a.FooterText!=""?a.FooterText+" ":"")+f.FormattedValue}}}},PostRowInitialization:function(b){var a=b.Parent;var c=b.GetElement();var d=b.Table;if(a){c.parentIndex=a.Position.toString()}},PostCellInitialization:function(a){},SetupColumnHeader:function(a,d){var f=a.Table;var c=f.Grid;var e=new IS.StringBuilder();var g=function(i){e.Append(i)};var h=function(i,j){WGRenderEngine.SetAttribute(d,i,j)};h("colName",a.Name);h("type","Column");h("dataBound",WG50Engine.ToBoolString(a.Bound));if(c.EnableSection508Standards){if(a.HtmlScope!="None"){h("scope",a.HtmlScope.toLowerCase())}if(a.HtmlUniqueId!=""){h("id",a.HtmlUniqueId)}if(a.HtmlHeaders!=""){h("headers",a.HtmlHeaders)}}if(a.HeaderTooltip!=""){h("hasTooltip","true");h("title",a.HeaderTooltip)}h("isGrouped",WG50Engine.ToBoolString(a.IsGrouped));h("isSorted",WG50Engine.ToBoolString(a.IsSorted));h("sortOrder",a.SortOrder);var b=d.children[0];if(b.children.length>0){b=b.children[0]}if(a.HeaderImage!=""&&!a.IsRowChecker){g('<img align="absmiddle" src="'+c.ResolveImagePathEx(c.LayoutSettings.ImageSettings.Folder,a.HeaderImage)+'" />')}if(a.IsRowChecker){g("<input");if(!c.EnableSection508Standards){g(' hidefocus="hidefocus"')}g(' type="checkbox" class="DefChkBox" onclick="wgCheckBoxHeaderClick(this)" />')}else{if(a.Caption!=""){g(a.Caption)}else{if(a.Name!=""){if(a.ColumnType=="Image"||a.ColumnType=="Custom"||a.ShowInSelectColumns=="No"){g("&nbsp;")}else{g(a.Name)}}else{g("&nbsp;")}}}b.innerHTML=e.ToString();WGUIEngine.RemoveSortIcon(d);WGUIEngine.SetColumnSortOrder(c,d);a.AltElement=d},SetupColumnFilter:function(a,c){var i=a.Table;var f=i.Grid;var h="";var b=i.FilteredColumns.GetNamedItem(a.Name);var d="";var e=WGMenuEngine.GetFilterTypeInt(a.DefaultFilterType);var j=function(k,l){WGRenderEngine.SetAttribute(c,k,l)};if(b!=null){d=b.FilterText.replace(new RegExp('"',"ig"),"&quot;");e=WGMenuEngine.GetFilterTypeInt(b.FilterType)}j("colName",a.Name);j("filterType",e);if(d!=""){j("cellValue",d)}if(a.GetFilterEditType()=="Checkbox"){h='<input type="checkbox" class="DefChkBox" ';if(d=="True"||d=="true"){h+=" checked"}c.children[0].innerHTML=h}else{if(b!=null){if(b.FilterDisplayText!=""){h=b.FilterDisplayText}else{h=d}c.children[0].innerHTML=h}}if(e==8){var g=c.children[1];g.disabled="true";g.style.filter="gray()";g.onclick=null;g.style.cursor=""}if(!IS.ie){WGMozEngine.FixFilterColumns(i)}},HandleClientOperation:function(d,c,a,b){var f=null;if(!f){f=d.RootTable}switch(c){case"ColumnSort":case"ColumnFilter":case"PagingNext":case"PagingPrev":case"PagingTo":var g=0;if(c=="PagingNext"){if(d.CurrentPageIndex<d.TotalPages){g=d.CurrentPageIndex+1}else{return false}}else{if(c=="PagingPrev"){if(d.CurrentPageIndex-1>0){g=d.CurrentPageIndex-1}else{return false}}else{if(c=="PagingTo"){g=b}}}if(c.indexOf("Paging")>-1){if(g>d.TotalPages){return false}else{if(d.CurrentPageIndex==g){return false}else{d.CurrentPageIndex=g}}}if(d.IsClientOperation()){d.RebindData();if(c=="ColumnFilter"||c.indexOf("Paging")>-1){WGBindingEngine.PostDataBound(f,true)}}break;case"Group":case"Ungroup":case"ChangeGroup":case"ColumnChange":if(c=="Group"||c=="Ungroup"){WGBindingEngine.SynchronizeTemplate(f.HtmlTemplate,c,[1])}if(d.IsClientOperation()){d.RebindData()}break;case"More":if(d.TotalLoadedRows==d.TotalRows||d.LastAction=="Insert"){return false}if(d.IsClientOperation()){var e=WGBindingEngine._PopulateRows(f,f.GetView(),null,d.TotalLoadedRows);WGBindingEngine.MergeGridRows(f.Rows,e);WGServiceEngine.AddLoadedRows(f,e)}break}},AddLoadedRows:function(g,e){var b=WGRenderEngine.RenderRows(g,g.GetView(),e);var h=g.GetElement(WG40.BODY,WG40.HTMLTABLE);var d=g.Grid;g._PartialRows=e;WGUIEngine.SetTempContent("<table>"+b+"</table>");var f=WGUIEngine.GetTempContent();var a=0;var c=f.rows[0];if(d.FreezePaneActive&&d.FrozenColumns!=null){WGUIEngine.FormatFreezePane(d,true,f.rows)}h.appendChild(f.tBodies[0]);WG50Engine.OnOperationCompleted(g,"More",c);ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnRenderCompleted,d.Id,this);d.Set("TotalLoadedRows",g.Rows.length,true);d.SetStatus2("","loaded",d.TotalLoadedRows,d.TotalRows);d.SetStatus1("","ready","CommonText/Ready");WGUIEngine.ClearTempContent()}};var WGRenderEngine={RenderTableBody:function(k,b,e,a){var j=k.HtmlTemplate.GetRowTemplateWithGroupHeader();var f=new IS.StringBuilder();var l="";var m=null;var n=k.GetVisibleColumnNames();var g=k.Rows;var c=k.Grid;ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnPreRender,this.Id);if(a){g=a}k.HtmlTemplate.SetTempRow(j);m=k.HtmlTemplate.GetTempRow();var h=g.length;for(var d=0;d<h;d++){f.Append(WGRenderEngine.RenderRow(k,g[d],m,n))}if(e){l=f.ToString()}else{l=k.HtmlTemplate.MergeRowToBody(f.ToString())}ISEvent.Raise(c.LayoutSettings.ClientSideEvents.OnPostRender,this.Id);return l},RenderRows:function(c,b,a){return WGRenderEngine.RenderTableBody(c,b,true,a)},RenderRow:function(e,c,h,i,d){var g;if(c.Type=="GroupHeader"){g=WGGroupingEngine.RenderGroupRow(e,c,h,i,d)}else{g=WGRenderEngine.RenderRecordRow(e,c,h,i,d);if(e.PreviewRowVisible||e.IsUseColumnSet||e.ChildTables.length>0){var f=h.parentElement.parentElement;var b=wgGetNextRow(f,h);while(b!=null){g+=WGRenderEngine.RenderOtherRow(e,c,b,i,d);b=wgGetNextRow(f,b)}}}if(!c.IsSelfRefChildRow&&typeof(WGGroupingEngine)!="undefined"&&!c.GroupTotalRendered){var a=WGGroupingEngine.PrepareRenderGroupTotalRow(c,d);if(!d&&a){g+=a}}return g},RenderOtherRow:function(f,d,b,g,e){var a=f.Grid;if(b.type=="PR"){var c=wgGetPreviewRowCell(b);var g=f.GetVisibleColumnNames();c.children[0].innerHTML=d.PreviewRowValue;if(!IS.ie){b.style.lineHeight="1px"}if(IS.IsHTML5DocType()){b.cells[0].style.display="none"}if(d.Parent!=null){if(d.Parent.HasCollapsedParents()||(d.Parent!=null&&(!d.Parent.Expanded||d.Parent.Group!=null&&d.Parent.Group.GetGroupMode()=="Collapsed"))){if(!(d.Parent!=null&&d.Parent.Expanded&&d.Parent.ForceExpGroup)){b.style.display="none"}}}c.colSpan=g.length+(f.PreviewRowSettings.Expandable?1:0)}else{if(b.type=="CSRecord"){}else{if(b.type=="HierRow"){}}}if(typeof(e)!="undefined"){e.Append(b.outerHTML);return""}return b.outerHTML},RenderRecordRow:function(m,k,n,o,l){var f=m.Grid;WGRenderEngine.SetAttribute(n,"position",k.Position);WGRenderEngine.SetAttribute(n,"recordIndex",k.DataSourceIndex);WGRenderEngine.SetAttribute(n,"hasParent",WG50Engine.ToBoolString(k.Parent!=null));WGRenderEngine.SetAttribute(n,"parentGroupIndex",(k.Parent!=null&&k.Parent.Group!=null?k.Parent.Group.Index.toString():"0"));if(k.KeyValue!=null){WGRenderEngine.SetAttribute(n,"keyValue",k.KeyValue)}else{if(k.KeyValues!=null){for(var h=0;h<k.KeyValues.length;h++){WGRenderEngine.SetAttribute(n,"keyValue"+h,k.KeyValues[h])}}}var c=n.cells;var b=c.length;var j=0;for(var h=0;h<b;h++){var a=c[h];WG50Engine.EmulateAttributes(a);if(a.type=="Cell"){var e;if(m.IsUseColumnSet){e=m.GetColNameByRowLayout(a.cs,a.r,a.c)}else{e=o[j]}if(e){var g=k.Cells.GetNamedItem(e);var d=g.Column;WGRenderEngine.RenderCell(d,g,a)}j++}}if(n.style.display=="none"){n.style.display=""}if(k.IsSelfRefChildRow){n.style.display="none"}else{if(k.Parent!=null){if(k.Parent.HasCollapsedParents()||(k.Parent!=null&&(!k.Parent.Expanded||(k.Parent.Group!=null&&k.Parent.Group.GetGroupMode()=="Collapsed")))){if(!(k.Parent!=null&&k.Parent.Expanded&&k.Parent.ForceExpGroup)){n.style.display="none"}}}}if(typeof(l)!="undefined"){l.Append(n.outerHTML);return""}return n.outerHTML},RenderCell:function(c,f,a,g){var i=c.Table;var e=i.Grid;var h=f.Row;var b=f.Text;if(g){WGRenderEngine.RenderCellContent(c,f,a)}if(c.ColumnType=="CheckBox"){if(a.children.length>0){if(IS.ie&&!IS.IsHTML5DocType()){a.children[0].checked=f.Value}else{if(f.Value){a.children[0].setAttribute("checked","true")}else{a.children[0].removeAttribute("checked")}}}}else{if(b==null||b==""||b==" "){if(c.NullText==""){b="&nbsp;"}else{b=c.NullText}}else{if(c.AllowMultiLine){b=b.replace(/\r\n/ig,"<br>");b=b.replace(/\n\r/ig,"<br>")}else{if(!IS.ie){try{b=b.replace(/\r\n/ig,"")}catch(d){}}}}if(!e.IsClientBinding("Server")&&c.DataFormatString!=""){b=ISDataEngine.FormatString(e.CultureInfo,c.DataFormatString,f.Value,e.ValEngine)}if(c.PreserveWhitespace){b=b.replace(/[ ]/g,"&nbsp;")}switch(c.ColumnType){case"Text":if(a.children.length>0&&a.children[0].tagName=="NOBR"){if(b=="&nbsp;"||c.PreserveWhitespace){a.children[0].innerHTML=b}else{a.children[0].innerText=b}}else{if(b=="&nbsp;"||c.PreserveWhitespace){a.innerHTML=b}else{a.innerText=b}}break;default:a.innerHTML=WGRenderEngine.RenderCellInnerText(f,null,true);break}}if(f.Value!=f.Text||c.EditType=="DropdownList"){WGRenderEngine.SetAttribute(a,"cellValue",f.Value)}if(!a.additionalClass){a.additionalClass=a.className.replace(e.LayoutSettings.RowClass,"")}if(e.LayoutSettings.AlternatingColors){if(h.Position%2!=0){a.className=e.LayoutSettings.AlternatingRowClass+a.additionalClass}else{a.className=e.LayoutSettings.RowClass+a.additionalClass}}},RenderCellContent:function(b,c,a){var d=new IS.StringBuilder();WGRenderEngine.RenderCellPreText(c,d);WGRenderEngine.RenderCellText(c,d);WGRenderEngine.RenderCellPostText(c,d);a.innerHTML=d.ToString()},RenderCellPreText:function(a,f){var g=a.Column.Table;var b=g.Grid;var c=b.LayoutSettings;var h=function(i){f.Append(i)};if(g.SelfReferencingSettings.Enabled&&g.SelfReferencingSettings.ExpandColumnMember!=""){if(g.SelfReferencingSettings.ExpandColumnMember==a.Column.Name){var d=a.Row.SelfRefLevel*14;var e=a.Row;h("<nobr>");h('<span style="height:100%; vertical-align:middle; padding: 1 4 0 '+d.toString());if(e.SelfRefChildNotExpandable||(!g.SelfReferencingSettings.LoadOnDemand&&e.SelfRefChildren.length==0)){h(";visibility: hidden")}h('">');h('<img align="absmiddle" onclick="WGUI.TGSRR(this)" src="'+b.ResolveImagePathEx(e.ForceExpSelfRefRow?c.ImageSettings.CollapseImage:c.ImageSettings.ExpandImage)+'" />');h("</span>")}}},RenderCellText:function(a,f){var g=a.Column.Table;var c=g.Grid;var e=c.LayoutSettings;var b=a.Column;var d=false;var h=function(i){f.Append(i)};if(g.SelfReferencingSettings.Enabled&&g.SelfReferencingSettings.ExpandColumnMember==b.Name){d=true}if(b.MaxHeight!=null||d){h('<span content style="overflow-y:hidden;');if(IS.moz){h("overflow:hidden;")}if(b.MaxHeight!=null){if(IS.moz){h("display:block;")}h("height:"+b.MaxHeight.toString())}else{if(d){h("padding: "+g.SelfReferencingSettings.ExpandColumnInnerTextPadding.toString()+";")}}h('">')}WGRenderEngine.RenderCellInnerText(a,f);if(b.MaxHeight!=null||d){h("</span>")}},RenderCellInnerText:function(a,j,c){var k=a.Column.Table;var d=k.Grid;var b=a.Column;var i=!j;var g=false;var l=a.Text;var m=function(n){if(!j){j=new IS.StringBuilder()}j.Append(n)};if(k.SelfReferencingSettings.Enabled&&k.SelfReferencingSettings.ExpandColumnMember==b.Name){g=true}switch(b.ColumnType){case"Text":if(!b.AllowMultiLine&&!g){m("<nobr>")}if(!b.AllowMultiLine&&!g){m("</nobr>")}break;case"Image":if(c){var f=a.GetImage();if(f!=""){if(b.ImageFormatString!=""){f=ISDataEngine.FormatCompositeString(d.CultureInfo,b.ImageFormatString,[l])}m('<img align="absmiddle" src="'+f+'"');if(a.CustomObjectAttributes!=""){m(" "+a.CustomObjectAttributes+" ")}m("/>")}else{m("&nbsp;")}}break;case"ImageAndText":var f=a.GetImage();if(!b.AllowMultiLine&&!g){m("<nobr>")}if(f!=""){m('<span><img align="absmiddle" src="'+f+'"');if(a.CustomObjectAttributes!=""){m(" "+a.CustomObjectAttributes+" ")}m("/>&nbsp;</span>")}if(l!="&nbsp;"&&!b.AllowMultiLine){m(IS.EncodeHtml(l))}else{m(IS.EncodeHtml(l))}if(!b.AllowMultiLine&&!g){m("</nobr>")}break;case"Button":case"ButtonImage":m('<button class="'+d.LayoutSettings.ButtonClass+'" style="');m('"');if(a.CustomObjectAttributes!=""){m(" "+a.CustomObjectAttributes+" ")}if(b.Bound&&a.Value!=null){m(' keyValue="'+a.Value.toString()+'" ')}if(IS.moz||IS.safari){m(' onclick="return false" ')}m(">");if(b.ColumnType=="Button"){if(b.ButtonText!=""){m(b.ButtonText)}else{m(l)}}else{m("<img valign=absmiddle ");wsa("src",(a.ButtonImage==""?b.ButtonImage:a.ButtonImage));m("/>")}m("</button>");break;case"CheckBox":m('<input type="checkbox" hideFocus="hideFocus" class="DefChkBox"');if(a.CustomObjectAttributes!=""){m(" "+a.CustomObjectAttributes+" ")}if(b.EditType=="NoEdit"&&!b.IsRowChecker){m(' disabled="disabled" ')}if(a.ForceNoEdit||(a.Row.ForceNoEdit&&!b.IsRowChecker)){m(' disabled="disabled" ')}if(b.IsRowChecker){m(' rowChecker="1" ');if(a.Row.Checked){a.Value=true}}if(a.Value!=null){if(a.Value){m(" checked ")}}m(">");break;case"Custom":if(c){m(l)}break;case"HyperLink":if(!b.AllowMultiLine&&!g){m("<nobr>")}if((l==""||l==" "||l=="&nbsp;")&&b.HyperlinkDisplayText==""){m(l)}else{m('<a class="'+d.LayoutSettings.HyperlinkClass+'" style="');m('" ');if(a.CustomObjectAttributes!=""){m(" "+a.CustomObjectAttributes+" ")}m('href="');var h=a.Value;var e="";if(h==null){e=""}else{e=h.toString()}if(b.HyperlinkFormatString!=""){m(ISDataEngine.FormatCompositeString(d.CultureInfo,b.HyperlinkFormatString,[e]))}else{m(e)}m('" ');if(b.HyperlinkTarget!="UseBase"){m('target="');if(b.HyperlinkTarget!="Custom"){m("_"+b.HyperlinkTarget.toLowerCase())}else{m(b.HyperlinkCustomTarget)}m('"')}m(">");if(l==" "||l=="&nbsp"){l=""}if(b.HyperlinkDisplayText!=""){m(b.HyperlinkDisplayText)}else{m(IS.EncodeHtml(l))}m("</a>")}if(!b.AllowMultiLine&&!g){m("</nobr>")}break;case"Template":if(b.CellTemplate){m(b.CellTemplate)}break}if(i){return j.ToString()}},RenderCellPostText:function(a,b){var c=a.Column.Table;var d=function(e){b.Append(e)};if(c.SelfReferencingSettings.Enabled&&c.SelfReferencingSettings.ExpandColumnMember!=""){if(c.SelfReferencingSettings.ExpandColumnMember==a.Column.Name){d("</nobr>")}}},SetAttribute:function(a,b,c){a.setAttribute(b,c)},RenderAggregateFunction:function(l,a,g,p,f){var r="";var o=null;var d=a.Table.Grid;var b=d.CultureInfo;var u=d.ValEngine;var n=new Object();var w=function(e){if(p){p.Append(e)}else{n.ColumnName=a.Name;n.FormattedValue=e}};if(a.DataType==null){return}if(g==null){o=l;r="ColumnTotal"}else{o=new ISArray();WGGroupingEngine.UngroupRows(g,o);r="GroupTotal"}if(!o||o.length==0){if(f!=null&&d.ClientBindingSettings.PreloadGroupTotals){if(f.VirtualGroupTotals){for(var h=0;h<f.VirtualGroupTotals.length;h++){var v=f.VirtualGroupTotals[h];if(v.Name==a.Name){if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,v.Value,u))}else{w(v.Value.toString())}return v.Value}}}}}if(a.AggregateFunction=="Count"){w(o.length.toString());return n}switch(a.AggregateFunction){case"Custom":var m=ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnCustomAggregate,d.Id,a,o,r);if(r=="ColumnTotal"){a.CustomAggregateResult=m}else{if(g.ParentRow!=null){g.ParentRow.CustomAggregateResult=m}}if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,m,u))}else{if(m!=null){w(m.toString())}}break;case"Sum":var q=0;for(var h=0;h<o.length;h++){var t=o[h].Cells[a.Position].Value;if(t==null||typeof(t)=="undefined"){continue}q+=t}if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,q,u))}else{w(q.toString())}break;case"Avg":var q=0;for(var h=0;h<o.length;h++){var t=o[h].Cells[a.Position].Value;if(t==null||typeof(t)=="undefined"){continue}q+=t}try{q/=o.length}catch(c){q=0}if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,q,u))}else{w(q.toString())}break;case"Max":var j=0;for(var h=0;h<o.length;h++){var t=o[h].Cells[a.Position].Value;if(t==null||typeof(t)=="undefined"){continue}j=Math.max(j,t)}if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,j,u))}else{w(j.toString())}break;case"Min":var k=null;for(var h=0;h<o.length;h++){var t=o[h].Cells[a.Position].Value;if(t==null||typeof(t)=="undefined"){continue}if(k==null){k=t}k=Math.min(k,t)}if(a.DataFormatString!=""){w(ISDataEngine.FormatString(b,a.DataFormatString,k,u))}else{w(k.toString())}break}return n}};var pGrid=WebGrid.prototype;pGrid.SetDataSource=function(a,b){if(!b){b=this.RootTable.Name}this.DataSourceInternal=ISDataEngine.GetDataSet(a,b);this.DataSource=a;ISEvent.Raise(this.LayoutSettings.ClientSideEvents.OnDataSourceChanged,this.Id)};pGrid.GetConvertedDataSource=function(){if(this.DataSourceInternal!=null){return this.DataSourceInternal}return this.DataSource};pGrid.DataBind=function(){this.RootTable.DataBind()};pGrid.LoadData=function(){switch(this.ClientBindingSettings.DataSourceType){case"ServerDataSource":WG50Engine.ExecuteFlyPostback(this.Id,"LoadData");break;case"WebService":case"WcfService":case"AdoDataService":WG50Engine.ExecuteFlyPostback(this.Id,"ClientService_Select",null,"LoadData");break}};pGrid.Render=function(){this.RootTable.Render()};pGrid.RestoreSelection=function(d){if(!d){d=this.GetSelectedObject()}if(d!=null){var e=this.Tables[d.tblName];if(e.IsRootTable){var c=d.ToRowObject();if(c==null){c=d.Row}if(c!=null&&c.Type=="Record"){var b=e.GetRowByKeyValues(c.GetKeyValueString());if(b!=null){if(e.GroupedColumns.length>0){b.ExpandGroupRowsToThisRow()}if(d.type=="Row"){b.Select()}else{for(var a=0;a<b.Cells.length;a++){if(b.Cells[a].GetElement().cellIndex==(d.cellIndex+1)){b.Cells[a].Select(true);break}}}}}}}};pGrid.SaveSelection=function(){if(this.LastSelObj!=null){this.LastSelObj.Row=this.LastSelObj.ToRowObject()}};pGrid.RebindData=function(c,d){var b=this.GetSelectedObject();this.SaveSelection();if(c){this.SetDataSource(c)}else{if(!d){var a=this.RootTable.DispatchDataTable();if(a!=null){a.DefaultView=null}}}this.DataBind();this.Render();this.RestoreSelection(b)};pGrid.SetTotalRows=function(a){this.TotalRows=a;WGBindingEngine.PostDataBound(this.RootTable,true)};var pTable=WebGridTable.prototype;pTable.InsertData=function(e,c){var a=ISDataEngine.GetDataSet(e);if(a!=null&&a.Tables){var b=a.Tables[0].GetDefaultView();var d=WGBindingEngine._PopulateRows(this,b);if(d.length>0){this.InsertRows(d,c)}}return d};pTable.InsertRows=function(g,e){var l=e.GetElement();var j=this.GetElement(WG40.BODY,WG40.HTMLTABLE,l);var k=j.tBodies[j.tBodies.length-1];var b=WGRenderEngine.RenderRows(this,this.GetView(),g);if(b!=""){WGUIEngine.SetTempContent("<table>"+b+"</table>");var h=WGUIEngine.GetTempContent();var a=0;var m=h.rows.length;var c=h.rows[0];for(var d=0;d<m;d++){var f=k.appendChild(h.rows[0]);j.moveRow(f.rowIndex,l.rowIndex+d+1);WG50Engine.EmulateAttributes(f)}this._PartialRows=g;WG50Engine.OnOperationCompleted(this,"InsertRow",c);ISEvent.Raise(this.Grid.LayoutSettings.ClientSideEvents.OnRenderCompleted,this.Grid.Id,this,g)}WGUIEngine.ClearTempContent()};pTable.GetUngroupedRows=function(){return(this.UngroupedRows!=null?this.UngroupedRows:this.Rows)};pTable.GetRowByKeyValues=function(b){if(this.IsRootTable){var d=this.GetUngroupedRows();for(var a=0;a<d.length;a++){var c=d[a];if(b==c.GetKeyValueString()){return c}}}return null};pTable.DispatchDataTable=function(){var b=this.Grid;var a=b.GetConvertedDataSource();if(a!=null&&a.Tables){return a.Tables.GetNamedItem(this.Name)}return null};pTable.GetView=function(){var a=this.DispatchDataTable();if(a!=null){return a.GetDefaultView()}return null};pTable.DataBind=function(){var b=this.Grid;var a=this.GetView();if(a!=null){this.Rows=null;this.UngroupedRows=null;if(b.IsClientOperation()){var d=this.GetSortExpression();var c=this.GetFilterExpression();if(!a.Table.UserDefinedSort){a.Sort=d}else{a.Sort=a.Table.UserDefinedSort}if(!a.Table.UserDefinedRowFilter){a.RowFilter=c}else{a.RowFilter=a.Table.UserDefinedRowFilter}if((a.Sort!=""&&a.Sort!=null)||(a.RowFilter!=""&&a.RowFilter!=null)){a.Refresh()}}WGBindingEngine.EnsureDataBound(this,a)}else{this.Rows=new ISArray();this.UngroupedRows=null;this.TotalLoadedRows=0;this.TotalRows=0;WGBindingEngine.PostDataBound(this,true)}};pTable.FillDataSourceArguments=function(a,j,d,h,k,c){a.ViewName=this.DataMember;if(j){a.SortExpression=this.GetSortExpression();if(this.Grid.ClientBindingSettings.IncludeJsonState){a.SortedColumns=this.GetSortExpression(true)}}if(d){a.FilterExpression=this.GetFilterExpression();if(this.Grid.ClientBindingSettings.IncludeJsonState){a.FilteredColumns=this.GetFilterExpression(true)}}if(k){var f="";var g=this.ToRowObject(c);if(a.FilterExpression!=""){a.FilterExpression+" and ("}else{a.FilterExpression="("}while(g!=null){var i="";var b=g.Group.Column;switch(b.DataType){case"System.String":case"System.Guid":i="'";break;case"System.DateTime":i="#";break}if(f!=""){f+=" and "}f+="["+b.DataMember+"] = "+i+g.Cells[0].Value.toString()+i;g=g.Parent}a.FilterExpression+=f+")"}if(h){var e=this.Grid;if(e.LayoutSettings.PagingMode=="None"){a.StartRowIndex=0;a.MaximumRows=0}else{if(e.IsClassicPaging()){a.StartRowIndex=(e.GetCurrentPage()-1)*e.LayoutSettings.PagingSize;a.MaximumRows=a.StartRowIndex+e.LayoutSettings.PagingSize}else{if(this.GroupedColumns.length==0){a.StartRowIndex=0;a.MaximumRows=e.LayoutSettings.VirtualPageSize}else{a.GroupByExpression=this.GetGroupByExpression();if(k&&e.ClientBindingSettings.EnableGroupRowPaging){a.StartRowIndex=typeof(c.loadedRows)=="undefined"?0:c.loadedRows;a.MaximumRows=a.StartRowIndex+e.ClientBindingSettings.GroupRowPageSize}}}}}return a};pTable.GetGroupByExpression=function(){var a="";for(var b=0;b<this.GroupedColumns.length;b++){a+=this.GroupedColumns[b].Column.DataMember+","}if(a!=""){a=a.substring(0,a.length-1)}return a};pTable.GetSortExpression=function(e){var f="";var g=[];for(var d=0;d<this.GroupedColumns.length;d++){var b=this.GroupedColumns[d];var a=this.Columns.GetNamedItem(b.ColumnMember);var c="";if(a.ValueList.IsValid()&&a.Get("UseValueListForSorting")=="Yes"){c=a.ValueList.DataTextField}else{c=b.ColumnMember}f+=c+(b.SortOrder!="None"?" "+(b.SortOrder=="Ascending"?"asc":"desc"):"")+",";if(b.SortOrder!="None"){g.push({PropertyName:c,Direction:b.SortOrder})}}for(var d=0;d<this.SortedColumns.length;d++){var h=this.SortedColumns[d];var a=this.Columns.GetNamedItem(h.ColumnMember);var j=h.ColumnMember;if(!this.GroupedColumns.GetNamedItem(h.ColumnMember)){if(a.ValueList.IsValid()&&a.Get("UseValueListForSorting")=="Yes"){j=a.ValueList.DataTextField}else{if(a.SortKeyField){j=a.SortKeyField}}f+=j+(h.SortOrder!="None"?" "+(h.SortOrder=="Ascending"?"asc":"desc"):"")+",";if(h.SortOrder!="None"){g.push({PropertyName:j,Direction:h.SortOrder})}}}if(f!=""){f=f.substring(0,f.length-1)}if(e){f=ISJsonEngine.Serialize(g)}return f};pTable.GetFilterExpression=function(r){var g="";var h=[];var n={GreaterThanOrEqualTo:">=",GreaterThan:">",EqualTo:"=",LessThanOrEqualTo:"<=",LessThan:"<",Like:"like",NotLike:"like",NotEqualTo:"<>",IsNull:"=",NotIsNull:"<>",IsEmpty:"=",NotIsEmpty:"<>",Contain:"contains",NotContain:"contains"};for(var l=0;l<this.FilteredColumns.length;l++){var j=this.FilteredColumns[l];var t=j.FilterType;if(t!="NotSet"&&t!="NoFilter"){var b=false;var a=false;var p="";var o="";var q="";var c=this.Columns.GetNamedItem(j.ColumnMember);var k=j.FilterText;var e=this.GetView();var d=j.ColumnMember;if(c.FilterKeyField){d=c.FilterKeyField}h.push({ColumnMember:d,FilterText:j.FilterText,FilterType:j.FilterType});switch(c.DataType){case"System.String":if(e==null||!e.CaseSensitive){k=k.toLowerCase()}case"System.Guid":q="'";break;case"System.Boolean":if(k==""){k="false"}break;case"System.DateTime":q="";if(t!="Between"&&t!="NotBetween"){var f=new Date(k);if(isNaN(f)){throw new Error(k+" is not a valid date time input.")}k="#"+k+"#"}break}if(t=="NotLike"||t=="NotBetween"||t=="NotContain"){b=true;a=true}else{if(t=="Between"){a=true}}if(b){p="!(";o=")"}else{if(a&&!b){p="(";o=")"}}if(t=="Between"||t=="NotBetween"){if(k.match(/and/)){var m=RegExp.leftContext;var s=RegExp.rightContext;if(c.DataType=="System.DateTime"){m="#"+m.replace(/\s*/g,"")+"#";s="#"+s.replace(/\s*/g,"")+"#"}g+=p+"["+j.ColumnMember+"] >= "+q+m+q+" && ["+j.ColumnMember+"] <= "+q+s+q+o}}else{if(t=="IsNull"||t=="NotIsNull"){q="";k="null"}else{if(t=="IsEmpty"||t=="NotIsEmpty"){k=""}}g+=p+"["+j.ColumnMember+"] "+n[t]+" "+q+k+q+o}if(g!=""&&l<this.FilteredColumns.length-1){g+=" and "}}}if(r){g=ISJsonEngine.Serialize(h)}return g};pTable.Render=function(f){var d=this.Grid;var b=this.DispatchDataTable();if(this.HtmlTemplate==null){WGBindingEngine.PrepareTemplate(d)}var a=WGRenderEngine.RenderTableBody(this,b);if(this.IsRootTable){WG50Engine.UnregisterGridBody(d);var c=this.GetElement(WG40.BODY,WG40.HTMLDIV);IS.SetOuterHTML(c,a);WG50Engine.RegisterRootTableBehaviour(d);WG50Engine.OnViewChanged(this,"LoadData");this.UpdateDataStatus();d.ClearChildTables();if(IS.ie){d.NeedHeightResize=true;WGUIEngine.OnGridResize(d)}}else{throw new Error("Not supported in this version.")}ISEvent.Raise(d.LayoutSettings.ClientSideEvents.OnRenderCompleted,d.Id,this);if((this.IsRootTable||d.LastSelObj&&table.Id==d.LastSelObj.tblName)){var e=null;if(this.LastSelObj!=null){e=this.LastSelObj.GetRowElement()}if(e!=null&&e.type!="FilterRow"){d.ActiveEditCell=d.LastSelObj=null}}if(d.FromContextMenu){d.FromContextMenu=false;WGUIEngine.AutoFitColumns(d.Name)}};pTable.UpdateDataStatus=function(){var c=this.Grid;var a=this.DispatchDataTable();var b=null;var d=0;var e=0;if(a!=null){b=a.GetDefaultView()}if(this.UngroupedRows){d=this.UngroupedRows.length}else{d=this.Rows.length}if(b!=null){e=b.GetCount()}else{if(a!=null){e=a.Rows.length}}if(c.IsClientBinding("ClientService")&&!c.IsClientOperation()){e=c.TotalRows}WGUIEngine.UpdateDataStatus(c,null,true,[d,e]);if(c.IsClientBinding("ClientService")&&!c.IsClientOperation()){if(d==0&&this.Rows.length>0){WGUIEngine.HideNoDataBox(c)}}};pTable.ShouldInsertNewRow=function(b,a){var c=this.Grid;var d=c.LayoutSettings;var e=false;if(d.PagingMode=="None"){e=true}else{if(d.PagingMode=="VirtualLoad"){if(this.Rows.length<d.VirtualPageSize){e=true}}else{if(d.PagingMode=="ClassicPaging"){e=true}}}return e};pTable.AddRow=function(f,c,i){var d=this.Grid;var g="";var n=null;var p=this.GetVisibleColumnNames();var h=[];this.Rows.Add(f);f.Parent=null;this.HtmlTemplate.SetTempRow(this.HtmlTemplate.GetRowTemplateWithGroupHeader());n=this.HtmlTemplate.GetTempRow();g=WGRenderEngine.RenderRow(this,f,n,p);WGUIEngine.SetTempContent("<table>"+g+"</table>");var k=WGUIEngine.GetTempContent();var l=null;if(this.IsRootTable){l=this.GetElement(WG40.BODY,WG40.HTMLTABLE)}else{l=i.GetElement(WG40.BODY,WG40.HTMLTABLE)}var m=null;var o;var b;if(l.tBodies.length>0){m=l.tBodies[l.tBodies.length-1]}else{m=document.createElement("TBODY");l.appendChild(m)}WGUIEngine.FormatFreezeRows(d,k.rows);b=k.rows[0];o=k.rows.length;for(var e=0;e<o;e++){h.push(k.rows[0]);m.appendChild(k.rows[0])}WGBindingEngine.SynchronizeElements(this,[f],b);if(c){var a=wgGetCellByPosition(b,0);if(a!=null){if(d.HasFocus()){a.setActive()}WGEventEngine.EnsureCellVisible(d,a)}}return h};pTable.RemoveRow=function(d){var b=this.Grid;var f=WG50Engine.GetTable(d.GetElement());if(d.DataRow){var a=d.DataRow;var c=a.ObjectContext;var e=a.Table.Rows;e.Remove(a);c=null}this.Rows.splice(d.Position,1);this.Rows.ReindexPosition();WGEditEngine.DeleteRowGeneric(b,this,f,d.GetElement())};pTable.GetGroupRowByPath=function(e,f){var g=this.Rows;var b=null;var a=e;var d=e.split("_");if(a!=""){for(var c=0;c<d.Length;c++){if(c==0){b=g[parseInt(d[c])]}else{b=b.Children[parseInt(d[c])]}}b=b.Children[f]}else{b=g[f]}return b};pTable.CreateDataTable=function(){var c=new ISDataTable();c.TableName=c.Name=this.Name;c.DataSet=null;for(var d=0;d<this.Columns.length;d++){var b=new ISDataColumn(c);var a=this.Columns[d];b.Name=b.ColumnName=a.Name;b.DataType=b.DataType;c.Columns.Add(b)}return c};var pRow=WebGridRow.prototype;pRow.GetGroupRowLevel=function(){var c=this.Parent;var a=new Array();var d="";while(c!=null){a.push(c.Position);c=c.Parent}a.reverse();for(var b=0;b<a.length;b++){d+=a[b]+"_"}if(d!=""){d=d.substring(0,d.length-1)}return d};pRow.HasCollapsedParents=function(){var c=null;var a=false;var b=this;if(b.Type=="GroupHeader"){c=b.Parent;if(c!=null&&c.Group!=null&&c.Group.GetGroupMode()=="Collapsed"){return true}while(c!=null){c=c.Parent;if(c!=null&&c.Group!=null&&c.Group.GetGroupMode()=="Collapsed"){return true}}}return a};pRow.HasGrouppedChilds=function(){return this._HasGrouppedChilds(this.Children)};pRow.HasExpandedChilds=function(){return this._HasExpandedChilds(this.Children)};pRow._HasExpandedChilds=function(a){var a=a;var b=false;if(a!=null){if(a.length>0){var c=a[0];if(c.Group!=null&&c.Group.GetGroupMode()=="Expanded"){return true}if(c.Group!=null){return _HasExpandedChilds(c.Children)}}}return b};pRow._HasGrouppedChilds=function(a){var b=false;if(a!=null){if(a.length>0){var c=a[0];if(c.Group!=null){b=true}}}return b};pRow.ExpandGroupRowsToThisRow=function(){var a=this.Parent;while(a!=null){a.ExpandGroupRow();a=a.Parent}};pRow.CopyTo=function(g,f,d){var b=this.Cells;if(b==null){b=this.GetCells()}if(!d){for(var e=0;e<b.length;e++){var a=b[e];var c=a.Column;if(c!=null&&c.Bound){if(f){if(a.Modified){g[c.DataMember]=a.Value}}else{g[c.DataMember]=a.Value}}}}else{for(var h in g){var a=b.GetNamedItem(h);if(a!=null){if(f){if(a.Modified){g[h]=a.Value}}else{g[h]=a.Value}}}}};pGrid=null;pRow=null;pTable=null;