var DataViewRowState={Added:0,CurrentRows:1,Deleted:2,ModifiedCurrent:3,ModifiedOriginal:4,None:5,OriginalRows:6,Unchanged:7};function ISDataView(a,c,d,b){this._Type="ISDataView";ISObject.call(this);this.AllowDelete=true;this.AllowEdit=true;this.AllowNew=true;this.ApplyDefaultSort=true;this.DataViewManager=null;this.RowFilter=null;this.RowStateFilter=DataViewRowState.None;this.Sort=null;this.Table=a;this.Items=new ISArray();this.__getter=function(e){return ISDataViewEngine.__getter(this,e)};this.__setter=function(f,g,e){return ISDataViewEngine.__setter(this,f,g,e)};ISDataViewEngine.CreateDataViewRows(this)}var pISView=ISDataView.prototype;pISView.GetCount=function(){return ISDataViewEngine.GetCount(this)};pISView.GetItem=function(a){return ISDataViewEngine.GetItem(this,a)};pISView.AddNew=function(){return ISDataViewEngine.AddNew(this)};pISView.CopyTo=function(a,b){return ISDataViewEngine.CopyTo(this,a,b)};pISView.Delete=function(a){return ISDataViewEngine.Delete(this,a)};pISView.Find=function(b,a){return ISDataViewEngine.Find(this,b,a)};pISView.FindRows=function(a){return ISDataViewEngine.FindRows(this,a)};pISView.ToTable=function(c,b,a){return ISDataViewEngine.ToTable(this,c,b,a)};var ISDataViewEngine={__getter:function(a,b){return a[b]},__setter:function(b,c,d,a){switch(c){case"RowFilter":ISDataViewEngine.SetRowFilter(b,d);break;case"RowStateFilter":ISDataViewEngine.SetRowStateFilter(b,d);break;case"Sort":ISDataViewEngine.SetSort(b,d);break;default:break}},CreateDataViewRows:function(b){if(b.Table==null){return}var l,h,a,m,g,b,d;l=ADOQueryEngine.SelectRowsId(b.Table,b.RowFilter,b.Sort);h=b.Table.Rows;m=b.Table.TableName;b.Items.Clear();for(var c=0;c<l.length;c++){a=parseFloat(l[c].replace(m,""));if(isNaN(a)){continue}for(var e=0;e<h.length;e++){g=h[e];if(g._DataId==a){d=false;for(var f=0;f<b.Items.length;f++){if(b.Items[f].Row._DataId==a){d=true;break}}if(d==false){ISDataViewEngine.CreateDataViewRow(b,g)}break}}}},CreateDataViewRow:function(b,e){var a,f,d;a=new ISDataRowView(b,e);f=b.RowStateFilter.toString().split("|");d=false;for(var c=0;c<f.length;c++){switch(f[c]){case"0":if(e._RowState==DataRowState.Added){ISDataRowViewEngine.SetCells(a,e._RowVersion.Proposed);d=true}break;case"1":if(e.HasVersion(DataRowVersion.Current)){ISDataRowViewEngine.SetCells(a,e._RowVersion.Current);d=true}break;case"2":if(e._RowState==DataRowState.Deleted){ISDataRowViewEngine.SetCells(a,e._RowVersion.Current);d=true}break;case"3":if(e._RowState==DataRowState.Modified){ISDataRowViewEngine.SetCells(a,e._RowVersion.Current);d=true}break;case"4":if(e._RowState==DataRowState.Modified){ISDataRowViewEngine.SetCells(a,e._RowVersion.Original);d=true}break;case"5":if(e.HasVersion(DataRowVersion.Default)){ISDataRowViewEngine.SetCells(a,e.GetRow(DataRowVersion.Default));d=true}break;case"6":if(e.HasVersion(DataRowVersion.Original)){ISDataRowViewEngine.SetCells(a,e._RowVersion.Original);d=true}break;case"7":if(e._RowState==DataRowState.Unchanged){ISDataRowViewEngine.SetCells(a,e._RowVersion.Original);d=true}break}if(d){break}}if(d){b.Items.Add(a)}},SetRowFilter:function(a,b){a.RowFilter=b;ISDataViewEngine.CreateDataViewRows(a)},SetRowStateFilter:function(a,b){a.RowStateFilter=b;ISDataViewEngine.CreateDataViewRows(a)},SetSort:function(a,b){a.Sort=b;ISDataViewEngine.CreateDataViewRows(a)},GetCount:function(a){return a.Items.length},GetItem:function(a,b){if(typeof(b)=="string"){return a.Items.GetNamedItem(b)}else{return a.Items[b]}},AddNew:function(a){if(a.AllowNew){return ISDataRowViewEngine.CreateNewDataRowView(a)}else{throw new ISDataException("Cannot call AddNew where AllowNew is false.")}},CopyTo:function(b,a,d){if(a!=null){var e=b.Items;if(d==null){d=0}for(var c=d;c<e.length;c++){a[a.length]=e[c]}}},Delete:function(a,b){a.GetItem(b).Delete()},Find:function(d,m,g){if(m!=null){var o,c,l,a,b,n,h,f;o=d.Sort;o=o.substr(0,o.lastIndexOf(" "));c=o.replace(new RegExp("\\s+","g"),"").split(",");l=c[c.length-1].toLowerCase();if(l=="asc"||l=="desc"){delete c[c.length-1]}if(m.concat==undefined){a=new Array();a[0]=m}else{a=m}b=new Array(a.length);for(var e=0;e<d.Items.length;e++){h=d.Items[e];for(var k=0;k<b.length;k++){b[k]=false}for(var k=0;k<a.length;k++){if(a[k]==h.Cells.GetNamedItem(c[k]).GetValue()){b[k]=true}}f=true;for(var k=0;k<b.length;k++){if(b[k]==false){f=false;break}}if(f){if(g==true){if(n==null){n=new Array()}n[n.length]=h}else{n=h;break}}}return n}return null},FindRows:function(a,b){return a.Find(b,true)}};function ISDataRowView(a,b){this._Type="ISDataRowView";ISObject.call(this);this.Index=-1;this.DataView=a;this.IsEdit=false;this.IsNew=false;this.Row=b;this.RowVersion=DataRowVersion.Default;this.Cells=new ISArray();this._IsEdit=false;this._IsNew=false;this.__getter=function(c){return ISDataRowViewEngine.__getter(this,c)};this.__setter=function(d,e,c){return ISDataRowViewEngine.__setter(this,d,e,c)}}var pISRowView=ISDataRowView.prototype;pISRowView.BeginEdit=function(){ISDataRowViewEngine.BeginEdit(this)};pISRowView.CancelEdit=function(){ISDataRowViewEngine.CancelEdit(this)};pISRowView.CreateChildView=function(){return ISDataRowViewEngine.CreateChildView(this)};pISRowView.Delete=function(){ISDataRowViewEngine.Delete(this)};pISRowView.EndEdit=function(){ISDataRowViewEngine.EndEdit(this)};var ISDataRowViewEngine={__getter:function(a,b){var c;switch(b){case"IsEdit":case"IsNew":c=a["_"+b];break;default:c=a[b];break}return c},__setter:function(b,c,d,a){switch(c){case"IsEdit":case"IsNew":break;default:b[c]=d;break}},CreateNewDataRowView:function(b){var a=new ISDataRowView(b);a.IsNew=a._IsNew=true;ISDataRowViewEngine.InitNewDataRowView(a);return a},InitNewDataRowView:function(a){var b=a.DataView;if(b!=null){var c=b.Table;if(c!=null){a.Row=c.NewRow();ISDataRowViewEngine.SetCells(a,a.Row._RowVersion.Proposed)}}},BeginEdit:function(a){a.Row.BeginEdit()},CancelEdit:function(a){a.Row.CancelEdit();if(a.Get("IsEdit")==true){a.IsEdit=a._IsEdit=false}},CreateChildView:function(a){},Delete:function(a){if(a.DataView.AllowDelete){a.Row.Delete();a.DataView.Items.Remove(a)}else{throw new ISDataException("Cannot call Delete where AllowDelete is false.")}},EndEdit:function(a){if(a.Get("IsNew")==true){a.DataView.Table.Rows.Add(a.Row);a.IsNew=a._IsNew=false}a.Row.AcceptChanges()},SetCells:function(b,a){var d;b.Cells.Clear();for(var c=0;c<a.length;c++){b.Cells.Add(new ISDataCellView(b,a[c]))}}};function ISDataCellView(b,a){this._Type="ISDataCellView";ISObject.call(this);this.Index=-1;this.Name=a.Column.ColumnName;this.Cell=a;this.RowView=b}var pISViewCell=ISDataCellView.prototype;pISViewCell.SetValue=function(b,a){ISDataCellViewEngine.SetValue(this,b,a)};pISViewCell.GetValue=function(){return ISDataCellViewEngine.GetValue(this)};var ISDataCellViewEngine={GetValue:function(a){return a.Cell.GetValue()},SetValue:function(a,d,c){var b=a.RowView;if(b.DataView.AllowEdit){b._IsEdit=b.IsEdit=b._IsNew==false;a.Cell.SetValue(d)}else{throw new ISDataException("Cannot edit on a DataSource where AllowEdit is false.")}}};