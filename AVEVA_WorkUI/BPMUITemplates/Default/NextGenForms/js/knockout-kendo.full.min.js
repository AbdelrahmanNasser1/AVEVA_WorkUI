/*!
 * knockout-kendo 0.10.0
 * Copyright © 2017 Ryan Niemeyer & Telerik
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 * 
 * Modifications done from the original version:
 * - Added support for custom functionality useKoTemplates for the kendoGrid control.
 * - Added code to set the default value for the kendoColor control as #1b1b1b.
 * - Commented out the code in the extendAndRedraw method where value assignment is 
 *   done by adding 0.001, as the KendoRadialGauge control does a completed redraw when 
 *   there is no value change.
 * - Corrected min and max methods for the kendoNumericTextbox
 * - Added readOnly bindings for the below controls:
 *   - kendoDatePicker
 *   - kendoDateTimePicker
 *   - kendoEditor
 *   - kendoNumericTextBox
 *   - kendoTimePicker
 */
(function(n){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("knockout"),require("jquery"),require("kendo")):typeof define=="function"&&define.amd?define(["knockout","jquery","kendo"],n):n(window.ko,window.jQuery,window.kendo)})(function(n,t,i,r){var h,k,it;i=i||window.kendo;n.kendo=n.kendo||{};h=n.utils.unwrapObservable;n.kendo.BindingFactory=function(){var u=this,f;this.createBinding=function(f){if(t()[f.parent||f.name]){var e={};e.init=function(n,t,i,r,o){var s=u.buildOptions(f,t);if(s.async===!0||f.async===!0&&s.async!==!1){setTimeout(function(){e.setup(n,s,o)},0);return}return e.setup(n,s,o),s&&s.useKOTemplates?{controlsDescendantBindings:!0}:void 0};e.setup=function(e,o,s){var h,c=t(e);u.setupTemplates(f.templates,o,e,s);o.useKOTemplates===!0&&o.data!==r&&(o.dataSource=o.data);h=u.getWidget(f,o,c);u.handleEvents(o,f,e,h,s);u.watchValues(h,o,f,e);h.destroy&&n.utils.domNodeDisposal.addDisposeCallback(e,function(){h.element&&(typeof i.destroy=="function"?i.destroy(h.element):h.destroy())})};e.options={};e.widgetConfig=f;n.bindingHandlers[f.bindingName||f.name]=e}};this.buildOptions=function(t,r){var f=t.defaultOption,e=n.utils.extend({},n.bindingHandlers[t.name].options),u=h(r());return u instanceof i.data.DataSource||typeof u!="object"||u===null||f&&!(f in u)?e[f]=r():n.utils.extend(e,u),e};f=function(t,i){return function(r){return n.renderTemplate(t,i.createChildContext(r._raw&&r._raw()||r))}};this.setupTemplates=function(t,i,r,u){var e,h,o,s;if(t&&i&&i.useKOTemplates){for(e=0,h=t.length;e<h;e++)o=t[e],i[o]&&(i[o]=f(i[o],u));s=i.dataBound;i.dataBound=function(){n.memoization.unmemoizeDomNodeAndDescendants(r);s&&s.apply(this,arguments)}}};this.unwrapOneLevel=function(n){var t,r={};if(n)if(n instanceof i.data.DataSource)r=n;else if(typeof n=="object")for(t in n)r[t]=h(n[t]);return r};this.getWidget=function(t,i,r){var u,f;return t.parent?(f=r.closest("[data-bind*='"+t.parent+":']"),u=f.length?f.data(t.parent):null):u=r[t.name](this.unwrapOneLevel(i)).data(t.name),n.isObservable(i.widget)&&i.widget(u),u};this.watchValues=function(n,t,i,r){var f,e=i.watch;if(e)for(f in e)e.hasOwnProperty(f)&&u.watchOneValue(f,n,t,i,r)};this.watchOneValue=function(i,u,f,e,o){var s=n.computed({read:function(){var a,l,n=e.watch[i],s=h(f[i]),c=e.parent?[o]:[];t.isArray(n)?n=u[s?n[0]:n[1]]:typeof n=="string"?n=u[n]:l=!0;n&&f[i]!==r&&(l?c.push(s,f):(a=n.apply(u,c),e.name!=="kendoColorPicker"||i!=="value"||s||(s="#1b1b1b"),c.push(s)),(l||a!==s)&&n.apply(u,c))},disposeWhenNodeIsRemoved:o}).extend({throttle:f.throttle||f.throttle===0?f.throttle:1});n.isObservable(f[i])||s.dispose()};this.handleEvents=function(n,t,i,r,f){var o,e,s=t.events;if(s)for(o in s)s.hasOwnProperty(o)&&(e=s[o],typeof e=="string"&&(e={value:e,writeTo:e}),u.handleOneEvent(o,e,n,i,r,t.childProp,f))};this.handleOneEvent=function(t,i,r,u,f,e,o){var s=typeof i=="function"?i:r[i.call];typeof i=="function"?s=s.bind(o.$data,r):i.call&&typeof r[i.call]=="function"?s=r[i.call].bind(o.$data,o.$data):i.writeTo&&n.isWriteableObservable(r[i.writeTo])&&(s=function(n){var t,f;e&&n[e]&&n[e]!==u||(t=i.value,f=typeof t=="string"&&this[t]?this[t](e&&u):t,r[i.writeTo](f))});s&&f.bind(t,s)}};n.kendo.bindingFactory=new n.kendo.BindingFactory;n.kendo.setDataSource=function(t,r,u){var f,e;if(r instanceof i.data.DataSource){t.setDataSource(r);return}u&&u.useKOTemplates||(f=n.mapping&&r&&r.__ko_mapping__,e=r&&f?n.mapping.toJS(r):n.toJS(r));t.dataSource.data(e||r)},function(){var n=i.data.ObservableArray.fn.wrap;i.data.ObservableArray.fn.wrap=function(t){if(t!==null){var i=n.apply(this,arguments);return i._raw=function(){return t},i}}}();var l=function(t){return function(i){i&&(n.utils.extend(this.options[t],i),this.redraw())}},d=function(n,i){n?this.open(typeof i.target=="string"?t(h(i.target)):i.target):this.element.parent().is(":visible")&&this.close()},u=n.kendo.bindingFactory.createBinding.bind(n.kendo.bindingFactory),p="clicked",s="close",g="collapse",a="data",e="enable",nt="expand",v="expanded",st="error",ht="info",o="isOpen",w="max",b="min",c="open",y="readonly",rt="search",ut="select",ft="selected",et="size",ct="success",ot="title",f="value",tt="values",lt="warning";u({name:"kendoAutoComplete",events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{enabled:e,search:[rt,s],data:function(t){n.kendo.setDataSource(this,t)},value:f}});u({name:"kendoButton",defaultOption:p,events:{click:{call:p}},watch:{enabled:e}});u({name:"kendoCalendar",defaultOption:f,events:{change:f},watch:{max:w,min:b,value:f}});u({name:"kendoColorPicker",events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{enabled:e,value:f,color:f,palette:"palette"}});u({name:"kendoComboBox",events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{enabled:e,isOpen:[c,s],data:function(t){n.kendo.setDataSource(this,t)},value:f}});u({name:"kendoDatePicker",defaultOption:f,events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{readOnly:y,enabled:e,max:w,min:b,value:f,isOpen:[c,s]}});u({name:"kendoDateTimePicker",defaultOption:f,events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{readOnly:y,enabled:e,max:w,min:b,value:f,isOpen:[c,s]}});u({name:"kendoDropDownList",events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{enabled:e,isOpen:[c,s],data:function(t){n.kendo.setDataSource(this,t);t.length&&this.options.optionLabel&&this.select()<0&&this.select(0)},value:f}});u({name:"kendoEditor",defaultOption:f,events:{change:f},watch:{readOnly:y,enabled:e,value:f}});u({name:"kendoGantt",defaultOption:a,watch:{data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoGrid",defaultOption:a,watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)}},templates:["rowTemplate","altRowTemplate"]});u({name:"kendoListView",defaultOption:a,watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)}},templates:["template"]});u({name:"kendoPager",defaultOption:a,watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)},page:"page"},templates:["selectTemplate","linkTemplate"]});u({name:"kendoMaskedTextBox",defaultOption:f,events:{change:f},watch:{enabled:e,isReadOnly:y,value:f}});u({name:"kendoMap",events:{zoomEnd:function(t,i){n.isWriteableObservable(t.zoom)&&t.zoom(i.sender.zoom())},panEnd:function(t,i){var r;n.isWriteableObservable(t.center)&&(r=i.sender.center(),t.center([r.lat,r.lng]))}},watch:{center:"center",zoom:"zoom"}});u({name:"kendoMenu",async:!0});u({name:"kendoMenuItem",parent:"kendoMenu",watch:{enabled:e,isOpen:[c,s]},async:!0});u({name:"kendoMobileActionSheet",events:{open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{isOpen:d},async:!0});u({name:"kendoMobileButton",defaultOption:p,events:{click:{call:p}},watch:{enabled:e}});u({name:"kendoMobileButtonGroup",events:{select:function(t,i){n.isWriteableObservable(t.selectedIndex)&&t.selectedIndex(i.sender.current().index())}},watch:{enabled:e,selectedIndex:ut}});u({name:"kendoMobileDrawer",events:{show:{writeTo:o,value:!0},hide:{writeTo:o,value:!1}},watch:{isOpen:function(n){this[n?"show":"hide"]()}},async:!0});u({name:"kendoMobileListView",defaultOption:a,events:{click:{call:p}},watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)}},templates:["template"]});u({name:"kendoMobileModalView",events:{open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{isOpen:d},async:!0});u({name:"kendoMobileNavBar",watch:{title:ot}});u({name:"kendoMobilePopOver",events:{open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{isOpen:d},async:!0});u({name:"kendoMobileScroller",events:{pull:function(n,t){var i=t.sender.pullHandled.bind(t.sender);typeof n.pulled=="function"&&n.pulled.call(this,this,t,i)}},watch:{enabled:[e,"disable"]}});u({name:"kendoMobileScrollView",events:{change:function(t,i){(i.page||i.page===0)&&n.isWriteableObservable(t.currentIndex)&&t.currentIndex(i.page)}},watch:{currentIndex:"scrollTo",data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoMobileSwitch",events:{change:function(t,i){n.isWriteableObservable(t.checked)&&t.checked(i.checked)}},watch:{enabled:e,checked:"check"}});u({name:"kendoMobileTabStrip",events:{select:function(t,i){n.isWriteableObservable(t.selectedIndex)&&t.selectedIndex(i.item.index())}},watch:{selectedIndex:function(n){(n||n===0)&&this.switchTo(n)}}});u({name:"kendoMultiSelect",events:{change:f,open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{enabled:e,search:[rt,s],data:function(t){n.kendo.setDataSource(this,t)},value:function(n){this.dataSource.filter({});this.value(n)}}});k=function(n,t){t||t===0?this.show(t,n):this.hide()};u({name:"kendoNotification",watch:{error:function(n){k.call(this,st,n)},info:function(n){k.call(this,ht,n)},success:function(n){k.call(this,ct,n)},warning:function(n){k.call(this,lt,n)}}});u({name:"kendoNumericTextBox",defaultOption:f,events:{change:f,spin:f},watch:{readOnly:y,enabled:e,value:f,max:function(n){this.options.max=n},min:function(n){this.options.min=n}}});u({name:"kendoPanelBar",async:!0});u({name:"kendoPanelItem",parent:"kendoPanelBar",watch:{enabled:e,expanded:[nt,g],selected:[ut]},childProp:"item",events:{expand:{writeTo:v,value:!0},collapse:{writeTo:v,value:!1},select:{writeTo:ft,value:f}},async:!0});u({name:"kendoPivotGrid",watch:{data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoProgressBar",defaultOption:f,events:{change:f},watch:{enabled:e,value:f}});u({name:"kendoRangeSlider",defaultOption:tt,events:{change:tt},watch:{values:tt,enabled:e}});it=function(t){return function(i,r){var e=h(i.data||i.dataSource),f=h(i.idField)||"id",u=n.utils.arrayFirst(e,function(n){return h(n[f])===r.event[f]}),o=function(t){var i,f,r;for(i in u)t.hasOwnProperty(i)&&u.hasOwnProperty(i)&&(f=t[i],r=u[i],n.isWriteableObservable(r)&&r(f))};u&&t(i,r,u,o)}};u({name:"kendoScheduler",events:{moveEnd:it(function(n,t,i,r){r(t);r(t.resources)}),save:it(function(n,t,i,r){r(t.event)}),remove:function(t,i){var u,r=t.data||t.dataSource,f=n.unwrap(r);f&&f.length&&(u=n.utils.arrayFirst(n.unwrap(r),function(n){return n.uuid===i.event.uuid}),u&&(n.utils.arrayRemoveItem(f,u),n.isWriteableObservable(r)&&r.valueHasMutated()))}},watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)},date:"date"},async:!0});u({name:"kendoSlider",defaultOption:f,events:{change:f},watch:{value:f,enabled:e}});u({name:"kendoSortable",defaultOption:a,events:{end:function(t,i){var r="__ko_kendo_sortable_data__",u=i.action!=="receive"?n.dataFor(i.item[0]):i.draggableEvent[r],e=t.data,f=t.data;(i.action==="sort"||i.action==="remove")&&(f.splice(i.oldIndex,1),i.action==="remove"&&(i.draggableEvent[r]=u));(i.action==="sort"||i.action==="receive")&&(f.splice(i.newIndex,0,u),delete i.draggableEvent[r],i.sender.placeholder.remove());e.valueHasMutated()}}});u({name:"kendoSplitter",async:!0});u({name:"kendoSplitterPane",parent:"kendoSplitter",watch:{max:w,min:b,size:et,expanded:[nt,g]},childProp:"pane",events:{collapse:{writeTo:v,value:!1},expand:{writeTo:v,value:!0},resize:et},async:!0});u({name:"kendoTabStrip",async:!0});u({name:"kendoTab",parent:"kendoTabStrip",watch:{enabled:e},childProp:"item",async:!0});u({name:"kendoToolBar"});u({name:"kendoTooltip",events:{},watch:{content:function(n){this.options.content=n;this.refresh()},filter:"filter"}});u({name:"kendoTimePicker",defaultOption:f,events:{change:f},watch:{readOnly:y,max:w,min:b,value:f,enabled:e,isOpen:[c,s]}});u({name:"kendoTreeMap",watch:{data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoTreeView",watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)}},events:{change:function(t,i){if(n.isWriteableObservable(t.value)){var r=i.sender;t.value(r.dataItem(r.select()))}}},async:!0});u({name:"kendoDropDownTree",events:{change:f},watch:{data:function(t,i){n.kendo.setDataSource(this,t,i)},value:f},templates:["valueTemplate","template"]});u({name:"kendoTreeItem",parent:"kendoTreeView",watch:{enabled:e,expanded:[nt,g],selected:function(n,t){t?this.select(n):this.select()[0]==n&&this.select(null)}},childProp:"node",events:{collapse:{writeTo:v,value:!1},expand:{writeTo:v,value:!0},select:{writeTo:ft,value:!0}},async:!0});u({name:"kendoUpload",watch:{enabled:e}});u({name:"kendoWindow",events:{open:{writeTo:o,value:!0},close:{writeTo:o,value:!1}},watch:{content:"content",title:ot,isOpen:[c,s]},async:!0});u({name:"kendoBarcode",watch:{value:f}});u({name:"kendoChart",watch:{data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoLinearGauge",defaultOption:f,watch:{value:f,gaugeArea:l("gaugeArea"),pointer:l("pointer"),scale:l("scale")}});u({name:"kendoQRCode",watch:{value:f}});u({name:"kendoRadialGauge",defaultOption:f,watch:{value:f,gaugeArea:l("gaugeArea"),pointer:l("pointer"),scale:l("scale")}});u({name:"kendoSparkline",watch:{data:function(t){n.kendo.setDataSource(this,t)}}});u({name:"kendoStockChart",watch:{data:function(t){n.kendo.setDataSource(this,t)}}})})