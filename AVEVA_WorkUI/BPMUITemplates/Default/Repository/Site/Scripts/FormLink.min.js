var FormLink=function(){var n,t=function(){var n="FormLinkData",t=function(){var i=sessionStorage.getItem(n),t;if(i!==null)return t=JSON.parse(i),!Array.isArray(t.FP)&&typeof t.FP=="object"?{FP:[t.FP]}:t},i=function(t){sessionStorage.setItem(n,JSON.stringify(t))},f=function(){sessionStorage.removeItem(n)},r=function(n){n===!0?($("#formParametersContainer").parent().parent().css("display","table-row"),$("#formParametersContainer").find("iframe").attr("src","FormParametersTemplate.html")):($("#formParametersContainer").parent().parent().css("display","none"),$("#formParametersContainer").find("iframe").removeAttr("src"))},u=function(n){i(n);var u=t();r(u.FP&&u.FP.length>0)},o=function(){var n=$("#formParametersFrame")[0].contentWindow.ko,t=$("#formParametersFrame")[0].contentWindow.vm,i=n.toJSON(t.formParameters),r=JSON.parse(i),u=e(r);$("#formParametersField").val(u)},s=function(){var n=$("#formParametersField").val(),t=skeltaUtils.getJSONObjectFromXml(n),r={FP:t.FormParameters.Parameter};i(r)},h=function(){var n,t=skeltaUtils.createJsonRequestHelper({f:form,app:app});return skeltaUtils.callServerMethod("GET","../../NextGenForms/NextGenFormService.aspx/GetFormParametersForFormLink","application/json; charset=utf-8",t,"json",function(t){if(t.d){var i=JSON.parse(t.d);n=i.FP}},null,null,!1),n},e=function(n){return n?skeltaUtils.getXmlFromJSONObject({FormParameters:{Parameter:n}}):n},c=function(){var n=h(),o=t(),i=o&&o.FP?o.FP:undefined,s=[],c;$("#formParametersField").val("");r(!1);n&&n.length>0&&i&&i.length>0?($.each(n,function(n,t){var r=t;$.each(i,function(n,i){t.Name===i.Name&&t.Type===i.Type&&(r.Value=i.Value)});s.push(r)}),u({FP:s}),c=e(s),$("#formParametersField").val(c)):i&&(!n||n.length===0)?f():(!i||i.length===0)&&n&&u({FP:n})},l=function(n){var t=window.localeParameterType;return t[n]};return{getFormLinkData:t,setFormLinkData:i,loadFormParameters:u,showFormParameters:r,updateFormParametersValue:o,removeFormLinkData:f,updateFormLinkData:s,getLocalizedString:l,reloadFormParameter:c}};return{getInstance:function(){return n||(n=t()),n}}}();